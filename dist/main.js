/*! For license information please see main.js.LICENSE.txt */
(()=>{var e={877:e=>{e.exports="data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 2000 3000'%3e%3cg fill='none' stroke='%23000' stroke-linecap='round'%3e%3cpath d='M522.074-47.572v-46.75m0 121v-46.75m-653.125-239.25h-61.875m116.875 0h-55m426.25 0h-55m116.875 0h-61.875m-488.125 451h550m-550-451c-91.127 0-165 73.873-165 165m0 0v46.75m-24.75 0h24.75m-24.75 0v27.5m0 0h24.75m0 0v46.75m0 0c0 91.127 73.873 165 165 165m550 0c91.127 0 165-73.873 165-165m0-46.75h24.75m0-27.5v27.5m-24.75-27.5h24.75m-24.75-46.75c0-91.127-73.873-165-165-165m-433.125-52.25v52.25m316.25 0v-52.25m0 0h-316.25m144.375 379.5h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m0-121h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m-247.5-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m96.25-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m68.75 0h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m96.25-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m165-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m68.75 121h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m-316.25-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m68.75 0h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m96.25-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m165-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m-343.75 0h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m412.5-121h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m96.25-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m96.25-17.6h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m-41.25 103.4h-27.5m0 17.6h27.5m0 0v-17.6m-27.5 0v17.6m68.75 0h27.5m0-17.6h-27.5m27.5 17.6v-17.6m-27.5 0v17.6m361.771 66h168.42m-168.42 16.5v-16.5m168.42 0v16.5m0 0h-168.42m325.195-9.68v-442.151m0 0v-34.925m-2062.32 34.925v-34.925m34.921-34.925H995.362m34.928 302.451h292.25m0 0H1397M995.362-371.253c19.288 0 34.928 15.637 34.928 34.925M-1032.03-200.84v4.212m34.921-174.625c-19.291 0-34.921 15.637-34.921 34.925m-290.51 267.526h290.51m-364.97 0h74.46m2352.83 209.55v90.805m0 0v69.85m0 69.85h292.25m-309.72 0h17.47m-17.46 0h-17.467M-1032.03 140.748v90.805m2062.32 69.85v34.925m-2043.11 34.925h15.711m1992.472 0H-997.109m2319.649 0H1397m-2429.03-139.7v69.85m2027.392 69.85c19.288 0 34.928-15.637 34.928-34.925m-2062.32 34.925h19.21m-309.72 0h290.51m0-69.85v34.925M-1397 371.253h74.46m325.431 0c-19.291 0-34.921-15.637-34.921-34.925m0-195.58V-200.84m0 0v-100.563m0 0v-34.925M1397-68.802v209.55m-2794-209.55v209.55m2794 0v230.505m-2794-230.505v230.505m2064.755-219.45v-19.25m0 0c0-17.922 14.528-32.45 32.45-32.45m0 0h178.2m0 0c17.922 0 32.45 14.528 32.45 32.45m0 0v19.25m0 0c0 17.921-14.528 32.45-32.45 32.45m0 0h-178.2m0 0c-17.922 0-32.45-14.529-32.45-32.45' style='stroke-width:20' transform='rotate(-90 1257.48 247.162)'/%3e%3cpath d='M995.362 371.253c19.288 0 34.928-15.637 34.928-34.925m-2027.399 34.925c-19.291 0-34.921-15.637-34.921-34.925' style='stroke-width:20' transform='rotate(-90 1257.48 247.162)'/%3e%3c/g%3e%3c/svg%3e"},890:(e,t,i)=>{!function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(t||(t="undefined"==typeof window?i.g:window),void 0!==t[e])return t[e];for(var n=["webkit","moz","ms","o"],a=0,s=n.length,l=e.charAt(0).toUpperCase()+e.substr(1);a<s;a++){var r=t[n[a]+l];if(void 0!==r)return r}return null}function r(e,t,i,n,a,s,l){if("function"!=typeof n)throw new TypeError("Invalid animation rule:",n);var o=e-i,u=o/a,h=0;u>1&&(u=1),1!==u&&(h=n(u),isFinite(h)&&!isNaN(h)&&(u=h)),t&&t(u),o<a?l.frame=q((function(e){return r(e,t,i,n,a,s,l)})):(s&&s(),l.inProgress=!1)}function o(){Array.prototype.constructor.apply(this,arguments)}function u(e,t,i,n,a,s){e.beginPath(),e.moveTo(t+s,i),e.lineTo(t+n-s,i),e.quadraticCurveTo(t+n,i,t+n,i+s),e.lineTo(t+n,i+a-s),e.quadraticCurveTo(t+n,i+a,t+n-s,i+a),e.lineTo(t+s,i+a),e.quadraticCurveTo(t,i+a,t,i+a-s),e.lineTo(t,i+s),e.quadraticCurveTo(t,i,t+s,i),e.closePath()}function h(e,t){var i,n=t.valueDec,a=t.valueInt,s=0,l=void 0,r=void 0;if(i=(e=parseFloat(e))<0,e=Math.abs(e),n>0){for(l=a-(r=e.toFixed(n).toString().split("."))[0].length;s<l;++s)r[0]="0"+r[0];r=(i?"-":"")+r[0]+"."+r[1]}else{for(l=a-(r=Math.round(e).toString()).length;s<l;++s)r="0"+r;r=(i?"-":"")+r}return r}function d(e,t,i){return e["font"+t+"Style"]+" "+e["font"+t+"Weight"]+" "+e["font"+t+"Size"]*i+"px "+e["font"+t]}function c(e){e.shadowOffsetX=null,e.shadowOffsetY=null,e.shadowBlur=null,e.shadowColor="",e.strokeStyle=null,e.lineWidth=0,e.save()}function p(e,t,i,n){t.valueTextShadow&&(e.shadowOffsetX=i,e.shadowOffsetY=i,e.shadowBlur=n,e.shadowColor=t.colorValueTextShadow)}function m(e,t,i,n,a){i.beginPath(),i.arc(0,0,ie(e),0,2*re,!0),i.lineWidth=t,i.strokeStyle=a?le.linearGradient(i,n,a,e):n,i.stroke(),i.closePath()}function v(e,t){var i=K.pixelRatio;return e.maxRadius||(e.maxRadius=e.max-t.borderShadowWidth-t.borderOuterWidth*i-t.borderMiddleWidth*i-t.borderInnerWidth*i+(t.borderOuterWidth?.5:0)+(t.borderMiddleWidth?.5:0)+(t.borderInnerWidth?.5:0)),e.maxRadius}function f(e,t){var i=K.pixelRatio,n=t.borderShadowWidth*i,a=e.max-n-t.borderOuterWidth*i/2,s=a-t.borderOuterWidth*i/2-t.borderMiddleWidth*i/2+.5,l=s-t.borderMiddleWidth*i/2-t.borderInnerWidth*i/2+.5,r=v(e,t),o=void 0,u=!1;e.save(),t.borderOuterWidth&&(u=le.drawShadow(e,t,u),m(a,t.borderOuterWidth*i,e,t.colorBorderOuter,t.colorBorderOuterEnd)),t.borderMiddleWidth&&(u=le.drawShadow(e,t,u),m(s,t.borderMiddleWidth*i,e,t.colorBorderMiddle,t.colorBorderMiddleEnd)),t.borderInnerWidth&&(u=le.drawShadow(e,t,u),m(l,t.borderInnerWidth*i,e,t.colorBorderInner,t.colorBorderInnerEnd)),le.drawShadow(e,t,u),e.beginPath(),e.arc(0,0,ie(r),0,2*re,!0),t.colorPlateEnd?((o=e.createRadialGradient(0,0,r/2,0,0,r)).addColorStop(0,t.colorPlate),o.addColorStop(1,t.colorPlateEnd)):o=t.colorPlate,e.fillStyle=o,e.fill(),e.closePath(),e.restore()}function g(e,t){var i=e.max*(parseFloat(t.highlightsWidth)||0)/100;if(i){var n=ie(b(e,t)-i/2),a=0,s=t.highlights.length,l=(t.maxValue-t.minValue)/t.ticksAngle;for(e.save();a<s;a++){var r=t.highlights[a];e.beginPath(),e.rotate(oe),e.arc(0,0,n,le.radians(t.startAngle+(r.from-t.minValue)/l),le.radians(t.startAngle+(r.to-t.minValue)/l),!1),e.strokeStyle=r.color,e.lineWidth=i,e.lineCap=t.highlightsLineCap,e.stroke(),e.closePath(),e.restore(),e.save()}}}function y(e,t){var i=b(e,t),n=void 0,a=void 0,s=void 0,l=0,r=0,o=Math.abs(t.minorTicks)||0,u=t.ticksAngle/(t.maxValue-t.minValue);for(e.lineWidth=K.pixelRatio,e.strokeStyle=t.colorMinorTicks||t.colorStrokeTicks,e.save(),t.exactTicks?(a=t.maxValue-t.minValue,n=o?a/o:0,r=(ae.mod(t.majorTicks[0],o)||0)*u):n=o*(t.majorTicks.length-1);l<n;++l)(s=t.startAngle+r+l*(t.ticksAngle/n))<=t.ticksAngle+t.startAngle&&(e.rotate(le.radians(s)),e.beginPath(),e.moveTo(0,i),e.lineTo(0,i-.075*e.max),U(e))}function b(e,t){var i=e.max/100;return v(e,t)-5*i-(t.barWidth?2*(parseFloat(t.barStrokeWidth)||0)+((parseFloat(t.barWidth)||0)+5)*i:0)}function x(e,t){le.prepareTicks(t);var i,n=ie(b(e,t)),a=void 0,s=t.majorTicks.length,l=K.pixelRatio;for(e.lineWidth=2*l,e.save(),i=t.colorMajorTicks instanceof Array?t.colorMajorTicks:new Array(s).fill(t.colorStrokeTicks||t.colorMajorTicks),a=0;a<s;++a)e.strokeStyle=i[a],e.rotate(le.radians(E(t,t.exactTicks?t.majorTicks[a]:a,s))),e.beginPath(),e.moveTo(0,n),e.lineTo(0,n-.15*e.max),U(e);t.strokeTicks&&(e.strokeStyle=t.colorStrokeTicks||i[0],e.rotate(oe),e.beginPath(),e.arc(0,0,n,le.radians(t.startAngle),le.radians(t.startAngle+t.ticksAngle),!1),U(e))}function E(e,t,i){if(e.exactTicks){var n=e.ticksAngle/(e.maxValue-e.minValue);return e.startAngle+n*(t-e.minValue)}return e.startAngle+t*(e.ticksAngle/(i-1))}function U(e){e.stroke(),e.restore(),e.closePath(),e.save()}function w(e,t){var i=b(e,t)-.15*e.max,n={},a=0,s=t.majorTicks.length,l="needle"!==t.animationTarget,r=t.colorNumbers instanceof Array?t.colorNumbers:new Array(s).fill(t.colorNumbers),o=l?-(t.value-t.minValue)/(t.maxValue-t.minValue)*t.ticksAngle:0;for(l&&(e.save(),e.rotate(-le.radians(o))),e.font=le.font(t,"Numbers",e.max/200),e.lineWidth=0,e.textAlign="center",e.textBaseline="middle";a<s;++a){var u=o+E(t,t.exactTicks?t.majorTicks[a]:a,s),h=e.measureText(t.majorTicks[a]).width,d=t.fontNumbersSize,c=Math.sqrt(h*h+d*d)/2,p=le.radialPoint(i-c-t.numbersMargin/100*e.max,le.radians(u));360===u&&(u=0),n[u]||(n[u]=!0,e.fillStyle=r[a],e.fillText(t.majorTicks[a],p.x,p.y))}l&&e.restore()}function V(e,t){t.title&&(e.save(),e.font=le.font(t,"Title",e.max/200),e.fillStyle=t.colorTitle,e.textAlign="center",e.fillText(t.title,0,-e.max/4.25,.8*e.max),e.restore())}function A(e,t){t.units&&(e.save(),e.font=le.font(t,"Units",e.max/200),e.fillStyle=t.colorUnits,e.textAlign="center",e.fillText(le.formatContext(t,t.units),0,e.max/3.25,.8*e.max),e.restore())}function I(e,t){if(t.needle){var i=t.ticksAngle<360?le.normalizedValue(t).indented:t.value,n=c?t.startAngle:t.startAngle+(i-t.minValue)/(t.maxValue-t.minValue)*t.ticksAngle;"right"===t.barStartPosition&&(n=t.startAngle+t.ticksAngle-(i-t.minValue)/(t.maxValue-t.minValue)*t.ticksAngle);var a=v(e,t),s=ie(a/100*t.needleCircleSize),l=ie(a/100*t.needleCircleSize*.75),r=ie(a/100*t.needleEnd),o=ie(t.needleStart?a/100*t.needleStart:0),u=a/100*t.needleWidth,h=a/100*t.needleWidth/2,d=K.pixelRatio,c="needle"!==t.animationTarget;e.save(),le.drawNeedleShadow(e,t),e.rotate(le.radians(n)),e.fillStyle=le.linearGradient(e,t.colorNeedle,t.colorNeedleEnd,r-o),"arrow"===t.needleType?(e.beginPath(),e.moveTo(-h,-o),e.lineTo(-u,0),e.lineTo(-1*d,r),e.lineTo(d,r),e.lineTo(u,0),e.lineTo(h,-o),e.closePath(),e.fill(),e.beginPath(),e.lineTo(-.5*d,r),e.lineTo(-1*d,r),e.lineTo(-u,0),e.lineTo(-h,-o),e.lineTo(h/2*d-2*d,-o),e.closePath(),e.fillStyle=t.colorNeedleShadowUp,e.fill()):(e.beginPath(),e.moveTo(-h,r),e.lineTo(-h,o),e.lineTo(h,o),e.lineTo(h,r),e.closePath(),e.fill()),t.needleCircleSize&&(e.restore(),le.drawNeedleShadow(e,t),t.needleCircleOuter&&(e.beginPath(),e.arc(0,0,s,0,2*re,!0),e.fillStyle=le.linearGradient(e,t.colorNeedleCircleOuter,t.colorNeedleCircleOuterEnd,s),e.fill(),e.closePath()),t.needleCircleInner&&(e.beginPath(),e.arc(0,0,l,0,2*re,!0),e.fillStyle=le.linearGradient(e,t.colorNeedleCircleInner,t.colorNeedleCircleInnerEnd,l),e.fill(),e.closePath()),e.restore())}}function T(e,t,i){le.drawValueBox(e,t,i,0,e.max-.33*e.max,e.max)}function C(e,t){var i=e.max/100,n=v(e,t)-5*i,a=parseFloat(t.barStrokeWidth+"")||0,s=(parseFloat(t.barWidth+"")||0)*i,l=n-2*a-s,r=(n-l)/2,o=l+r,u=a/o,h=t.startAngle,d=t.startAngle+t.ticksAngle;if(e.save(),e.rotate(oe),a&&(e.beginPath(),e.arc(0,0,o,le.radians(h)-u,le.radians(d)+u,!1),e.strokeStyle=t.colorBarStroke,e.lineWidth=2*r,e.stroke(),e.closePath()),s&&(e.beginPath(),e.arc(0,0,o,le.radians(h),le.radians(d),!1),e.strokeStyle=t.colorBar,e.lineWidth=s,e.stroke(),e.closePath(),t.barShadow&&(e.beginPath(),e.arc(0,0,n,le.radians(h),le.radians(d),!1),e.clip(),e.beginPath(),e.strokeStyle=t.colorBar,e.lineWidth=1,e.shadowBlur=t.barShadow,e.shadowColor=t.colorBarShadow,e.shadowOffsetX=0,e.shadowOffsetY=0,e.arc(0,0,n,le.radians(t.startAngle),le.radians(t.startAngle+t.ticksAngle),!1),e.stroke(),e.closePath(),e.restore(),e.rotate(oe)),t.barProgress)){var c=function(e){var t=e.startAngle,i=e.startAngle+e.ticksAngle,n=t,a=t+(le.normalizedValue(e).normal-e.minValue)/(e.maxValue-e.minValue)*e.ticksAngle;if("middle"===e.barStartPosition){var s=.5*(e.minValue+e.maxValue);e.value<s?(n=180-(s-le.normalizedValue(e).normal)/(e.maxValue-e.minValue)*e.ticksAngle,a=180):(n=180,a=180+(le.normalizedValue(e).normal-s)/(e.maxValue-e.minValue)*e.ticksAngle)}else"right"===e.barStartPosition&&(n=i-a+t,a=i);return{startAngle:n,endAngle:a}}(t),p=c.startAngle,m=c.endAngle;e.beginPath(),e.arc(0,0,o,le.radians(p),le.radians(m),!1),e.strokeStyle=t.colorBarProgress,e.lineWidth=s,e.stroke(),e.closePath()}e.restore()}function S(e){return e.options.animatedValue?e.options.value:e.value}function _(e,t,i,n,a,s,l,r,o){e.beginPath(),e.lineWidth=t,e.strokeStyle=o?le.linearGradient(e,r,o,l,!0,a):r,i>0?le.roundRect(e,n,a,s,l,i):e.rect(n,a,s,l),e.stroke(),e.closePath()}function L(e,t,i,n,a,s){var l=K.pixelRatio;e.save();var r=t.borderRadius*l,o=a-t.borderShadowWidth-t.borderOuterWidth*l,u=o-t.borderOuterWidth*l-t.borderMiddleWidth*l,h=u-t.borderMiddleWidth*l-t.borderInnerWidth*l,d=h-t.borderInnerWidth*l,c=s-t.borderShadowWidth-t.borderOuterWidth*l,p=c-t.borderOuterWidth*l-t.borderMiddleWidth*l,m=p-t.borderMiddleWidth*l-t.borderInnerWidth*l,v=m-t.borderInnerWidth*l,f=i-(u-o)/2,g=f-(h-u)/2,y=g-(d-h)/2,b=n-(p-c)/2,x=b-(m-p)/2,E=x-(v-m)/2,U=0,w=!1;return t.borderOuterWidth&&(w=le.drawShadow(e,t,w),_(e,t.borderOuterWidth*l,r,i+t.borderOuterWidth*l/2-U,n+t.borderOuterWidth*l/2-U,o,c,t.colorBorderOuter,t.colorBorderOuterEnd),U+=.5*l),t.borderMiddleWidth&&(w=le.drawShadow(e,t,w),_(e,t.borderMiddleWidth*l,r-=1+2*U,f+t.borderMiddleWidth*l/2-U,b+t.borderMiddleWidth*l/2-U,u+2*U,p+2*U,t.colorBorderMiddle,t.colorBorderMiddleEnd),U+=.5*l),t.borderInnerWidth&&(w=le.drawShadow(e,t,w),_(e,t.borderInnerWidth*l,r-=1+2*U,g+t.borderInnerWidth*l/2-U,x+t.borderInnerWidth*l/2-U,h+2*U,m+2*U,t.colorBorderInner,t.colorBorderInnerEnd),U+=.5*l),le.drawShadow(e,t,w),function(e,t,i,n,a,s,l,r){e.beginPath(),e.fillStyle=r?le.linearGradient(e,l,r,a>s?a:s,s>a,a>s?i:n):l,t>0?le.roundRect(e,i,n,a,s,t):e.rect(i,n,a,s),e.fill(),e.closePath()}(e,r,y,E,d+2*U,v+2*U,t.colorPlate,t.colorPlateEnd),e.restore(),[y,E,d,v]}function P(e,t,i,n,a,s,l){var r=function(e,t,i,n,a,s){var l=K.pixelRatio,r=s>=a,o=r?.85*a:s,u=r?s:a;i=r?te(i+(a-o)/2):i;var h=!!t.title,d=!!t.units,c=!!t.valueBox,p=void 0,m=void 0,v=void 0;r?(m=te(.05*u),p=te(.075*u),v=te(.11*u),h&&(u-=p,n+=p),d&&(u-=m),c&&(u-=v)):(m=p=te(.15*o),h&&(o-=p,n+=p),d&&(o-=m));var f=2*t.barStrokeWidth,g=t.barBeginCircle?te(o*t.barBeginCircle/200-f/2):0,y=te(o*t.barWidth/100-f),b=te(u*t.barLength/100-f),x=te((u-b)/2),E=te(i+(r?o/2:x+g)),U=te(n+(r?u-x-g+f/2:o/2)),w=!r||t.hasLeft&&t.hasRight?0:(t.hasRight?-1:1)*t.ticksWidth/100*o,V=r||t.hasLeft&&t.hasRight?0:(t.hasRight?-1:1)*t.ticksWidth/100*o;return e.barDimensions={isVertical:r,width:o,length:u,barWidth:y,barLength:b,strokeWidth:f,barMargin:x,radius:g,pixelRatio:l,barOffset:null,titleMargin:h?p:0,unitsMargin:d?m:0,get ticksLength(){return this.barLength-this.barOffset-this.strokeWidth},X:i+w,Y:n+V,x0:E+w,y0:U+V,baseX:i,baseY:n,ticksPadding:t.ticksPadding/100},e.barDimensions}(e,t,n,a,s,l),o=r.isVertical,u=r.width,h=r.barWidth,d=r.barLength,c=r.strokeWidth,p=r.barMargin,m=r.radius,v=r.x0,f=r.y0,g=r.X,y=r.Y,b=d;if(e.save(),e.beginPath(),t.barBeginCircle){var x=le.radians(o?270:0),E=Math.asin(h/2/m),U=Math.cos(E),w=Math.sin(E),V=v+(o?m*w:m*U-c/2),A=o?f-m*U:f+m*w,I=ie(o?A-f:V-v);e.barDimensions.barOffset=te(I+m);var T=o?te(v-m*w):V,C=o?A:te(f-m*w);"progress"===i&&(d=e.barDimensions.barOffset+(d-e.barDimensions.barOffset)*(le.normalizedValue(t).normal-t.minValue)/(t.maxValue-t.minValue));var S=te(V+d-e.barDimensions.barOffset+c/2),_=te(A-d+e.barDimensions.barOffset-c/2);e.arc(v,f,m,x+E,x-E),o?(e.moveTo(V,C),e.lineTo(V,_),e.lineTo(T,_),e.lineTo(T,C)):(e.moveTo(V,C),e.lineTo(S,C),e.lineTo(S,A),e.lineTo(V,A))}else{var L=te(o?g+(u-h)/2:g+p),P=te(o?y+d+p:y+(u-h)/2);"progress"===i&&(d*=(t.value-t.minValue)/(t.maxValue-t.minValue)),o?e.rect(L,P,h,-d):e.rect(L,P,d,h)}"progress"!==i&&t.barStrokeWidth&&(e.lineWidth=c,e.strokeStyle=t.colorBarStroke,e.stroke()),"progress"!==i&&t.colorBar?(e.fillStyle=t.colorBarEnd?le.linearGradient(e,t.colorBar,t.colorBarEnd,d,o,o?y:g):t.colorBar,e.fill()):"progress"===i&&t.colorBarProgress&&(e.fillStyle=t.colorBarProgressEnd?le.linearGradient(e,t.colorBarProgress,t.colorBarProgressEnd,b,o,o?y:g):t.colorBarProgress,e.fill()),e.closePath(),t.barBeginCircle&&(e.barDimensions.radius+=c),e.barDimensions.barWidth+=c,e.barDimensions.barLength+=c}function O(e,t,i,n,a,s){P(e,t,"",i,n,a,s)}function M(e,t){return t.needleSide!==e||t.tickSide!==e||t.numberSide!==e}function N(e,t,i,n,a,s){t.barProgress&&P(e,t,"progress",i,n,a,s)}function R(e,t,i,n,a){e.beginPath(),e.moveTo(t,i),e.lineTo(n,a),e.stroke(),e.closePath(),e.save()}function D(e,t,i,n,a,s,l,r,o){var u=e.barDimensions,h=u.isVertical,d=u.length,c=u.barWidth,p=u.barOffset,m=u.barMargin,v=u.pixelRatio,f=u.width,g=u.X,y=u.Y,b=u.ticksLength,x=u.ticksPadding,E=(f-c)/2,U=void 0,w=void 0,V=0,A=i.length,I=void 0,T=o*f,C=E-x*f,S=E+c+T+x*f,_=t instanceof Array?t:new Array(i.length).fill(t);e.lineWidth=r*v,e.save();for(var L=b/(a-n);V<A;V++)I=i[V],e.strokeStyle=_[V],h?(w=y+d-m-p+(n-I)*L,s&&R(e,U=g+C,w,te(U-T),w),l&&R(e,U=g+S,w,te(U-T),w)):(U=g+m+p-(n-I)*L,s&&R(e,U,w=y+C,U,te(w-T)),l&&R(e,U,te(w=y+S),U,w-T))}function k(e,t,i,n,a){e.beginPath(),e.moveTo(t,i),e.lineTo(n,a),e.stroke(),e.closePath()}function F(e,t,i,n){return t.colorNeedleEnd?le.linearGradient(e,n?t.colorNeedleEnd:t.colorNeedle,n?t.colorNeedle:t.colorNeedleEnd,i,!e.barDimensions.isVertical):t.colorNeedle}function B(e,t,i,n,a,s,l,r){e.lineWidth=t.needleWidth,e.strokeStyle=F(e,t,l,r),e.beginPath(),e.moveTo(i,n),e.lineTo(a,s),e.stroke(),e.closePath()}function j(e,t,i,n,a,s,l,r){var o=l-te(.4*l),u=i===a,h=t.needleWidth/2;e.fillStyle=F(e,t,l,r),e.beginPath(),u?(n>s&&(o*=-1),e.moveTo(i-h,n),e.lineTo(i+h,n),e.lineTo(i+h,n+o),e.lineTo(i,s),e.lineTo(i-h,n+o),e.lineTo(i-h,n)):(i>a&&(o*=-1),e.moveTo(i,n-h),e.lineTo(i,n+h),e.lineTo(i+o,n+h),e.lineTo(a,n),e.lineTo(i+o,n-h),e.lineTo(i,n-h)),e.fill(),e.closePath()}function W(e,t,i,n,a,s,l){var r=(parseFloat(t.fontValueSize)||0)*s/200,o=(.11*l-r)/2;e.barDimensions.isVertical&&le.drawValueBox(e,t,i,n+s/2,a+l-r-o,s)}var G=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,a=!1,s=void 0;try{for(var l,r=e[Symbol.iterator]();!(n=(l=r.next()).done)&&(i.push(l.value),!t||i.length!==t);n=!0);}catch(e){a=!0,s=e}finally{try{!n&&r.return&&r.return()}finally{if(a)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},Y=function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in a)return a.value;var l=a.get;return void 0!==l?l.call(n):void 0},z=function e(t,i,n,a){var s=Object.getOwnPropertyDescriptor(t,i);if(void 0===s){var l=Object.getPrototypeOf(t);null!==l&&e(l,i,n,a)}else if("value"in s&&s.writable)s.value=n;else{var r=s.set;void 0!==r&&r.call(a,n)}return n},X=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();Object.assign||Object.defineProperty(Object,"assign",{enumerable:!1,configurable:!0,writable:!0,value:function(e,t){if(null==e)throw new TypeError("Cannot convert first argument to object");for(var i=Object(e),n=1;n<arguments.length;n++){var a=arguments[n];if(null!=a)for(var s=Object.keys(Object(a)),l=0,r=s.length;l<r;l++){var o=s[l],u=Object.getOwnPropertyDescriptor(a,o);void 0!==u&&u.enumerable&&(i[o]=a[o])}}return i}}),Array.prototype.indexOf||Object.defineProperty(Array.prototype,"indexOf",{value:function(e,t){var i;if(null===this)throw new TypeError('"this" is null or not defined');var n=Object(this),a=n.length>>>0;if(0===a)return-1;var s=+t||0;if(Math.abs(s)===1/0&&(s=0),s>=a)return-1;for(i=Math.max(s>=0?s:a-Math.abs(s),0);i<a;){if(i in n&&n[i]===e)return i;i++}return-1}}),Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null===this)throw new TypeError("this is null or not defined");for(var t=Object(this),i=t.length>>>0,n=arguments[1]|0,a=n<0?Math.max(i+n,0):Math.min(n,i),s=arguments[2],l=void 0===s?i:s|0,r=l<0?Math.max(i+l,0):Math.min(l,i);a<r;)t[a]=e,a++;return t}}),"undefined"==typeof window&&(window=void 0===i.g?{}:i.g);var H=function(){function e(){s(this,e),this._events={},this.addListener=this.on,this.removeListener=this.off}return X(e,[{key:"emit",value:function(e){if(this._events[e]){for(var t=0,i=this._events[e].length,n=arguments.length,a=Array(n>1?n-1:0),s=1;s<n;s++)a[s-1]=arguments[s];for(;t<i;t++)this._events[e][t]&&this._events[e][t].apply(this,a)}}},{key:"once",value:function(e){for(var t=arguments.length,i=Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];for(var a=0,s=i.length,l=this;a<s;a++)!function(){var t=i[a];i[a]=function i(){l.off(e,i),t.apply(l,arguments)}}();this.on.apply(this,[e].concat(i))}},{key:"on",value:function(e){this._events[e]||(this._events[e]=[]);for(var t=0,i=arguments.length<=1?0:arguments.length-1;t<i;t++)this._events[e].push(arguments.length<=t+1?void 0:arguments[t+1])}},{key:"off",value:function(e){if(this._events[e])for(var t=0,i=arguments.length<=1?0:arguments.length-1;t<i;t++)for(var n=arguments.length<=t+1?void 0:arguments[t+1],a=void 0;~(a=this._events[e].indexOf(n));)this._events[e].splice(a,1)}},{key:"removeAllListeners",value:function(e){delete this._events[e]}},{key:"listeners",get:function(){return this._events}}]),e}(),q=l("requestAnimationFrame")||function(e){return setTimeout((function(){return e((new Date).getTime())}),1e3/60)},$={linear:function(e){return e},quad:function(e){return Math.pow(e,2)},dequad:function(e){return 1-$.quad(1-e)},quint:function(e){return Math.pow(e,5)},dequint:function(e){return 1-Math.pow(1-e,5)},cycle:function(e){return 1-Math.sin(Math.acos(e))},decycle:function(e){return Math.sin(Math.acos(1-e))},bounce:function(e){return 1-$.debounce(1-e)},debounce:function(e){for(var t=0,i=1;;t+=i,i/=2)if(e>=(7-4*t)/11)return-Math.pow((11-6*t-11*e)/4,2)+Math.pow(i,2)},elastic:function(e){return 1-$.delastic(1-e)},delastic:function(e){return Math.pow(2,10*(e-1))*Math.cos(20*Math.PI*1.5/3*e)}},Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"linear",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:250,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};if(s(this,e),this.duration=i,this.rule=t,this.draw=n,this.end=a,"function"!=typeof this.draw)throw new TypeError("Invalid animation draw callback:",n);if("function"!=typeof this.end)throw new TypeError("Invalid animation end callback:",a)}return X(e,[{key:"animate",value:function(e,t){var i=this;this.frame&&this.cancel();var n=window.performance&&window.performance.now?window.performance.now():l("animationStartTime")||Date.now();e=e||this.draw,t=t||this.end,this.draw=e,this.end=t,this.frame=q((function(a){return r(a,e,n,$[i.rule]||i.rule,i.duration,t,i)}))}},{key:"cancel",value:function(){this.frame&&((l("cancelAnimationFrame")||function(e){})(this.frame),this.frame=null)}},{key:"destroy",value:function(){this.cancel(),this.draw=null,this.end=null}}]),e}();Z.rules=$;var J=function(){function t(i,n,a){s(this,t),this.options=i,this.element=n.toLowerCase(),this.type=t.toDashed(a),this.Type=e[a],this.mutationsObserved=!1,this.isObservable=!!window.MutationObserver,window.GAUGES_NO_AUTO_INIT||t.domReady(this.traverse.bind(this))}return X(t,[{key:"isValidNode",value:function(e){return!(!e.tagName||e.tagName.toLowerCase()!==this.element||e.getAttribute("data-type")!==this.type)}},{key:"traverse",value:function(){for(var e=document.getElementsByTagName(this.element),t=0,i=e.length;t<i;t++)this.process(e[t]);this.isObservable&&!this.mutationsObserved&&(new MutationObserver(this.observe.bind(this)).observe(document.body,{childList:!0,subtree:!0,attributes:!0,characterData:!0,attributeOldValue:!0,characterDataOldValue:!0}),this.mutationsObserved=!0)}},{key:"observe",value:function(e){for(var t=0,i=e.length;t<i;t++){var n=e[t];if("attributes"===n.type&&"data-type"===n.attributeName&&this.isValidNode(n.target)&&n.oldValue!==this.type)setTimeout(this.process.bind(this,n.target));else if(n.addedNodes&&n.addedNodes.length)for(var a=0,s=n.addedNodes.length;a<s;a++)setTimeout(this.process.bind(this,n.addedNodes[a]))}}},{key:"process",value:function(e){var i=this;if(!this.isValidNode(e))return null;var n=void 0,a=JSON.parse(JSON.stringify(this.options)),s=null;for(n in a)if(a.hasOwnProperty(n)){var l=t.toAttributeName(n),r=t.parse(e.getAttribute(l));null!=r&&(a[n]=r)}return a.renderTo=e,(s=new this.Type(a)).draw&&s.draw(),this.isObservable?(s.observer=new MutationObserver((function(n){n.forEach((function(n){if("attributes"===n.type){var a=n.attributeName.toLowerCase(),l=e.getAttribute(a).toLowerCase();if("data-type"===a&&l&&l!==i.type)s.observer.disconnect(),delete s.observer,s.destroy&&s.destroy();else if("data-"===a.substr(0,5)){var r=a.substr(5).split("-").map((function(e,t){return t?e.charAt(0).toUpperCase()+e.substr(1):e})).join(""),o={};o[r]=t.parse(e.getAttribute(n.attributeName)),"value"===r?s&&(s.value=o[r]):s.update&&s.update(o)}}}))})),s.observer.observe(e,{attributes:!0}),s):s}}],[{key:"parse",value:function(e){if("true"===e)return!0;if("false"===e)return!1;if("undefined"!==e){if("null"===e)return null;if(/^[-+#.\w\d\s]+(?:,[-+#.\w\d\s]*)+$/.test(e))return e.split(",");try{return JSON.parse(e)}catch(e){}return e}}},{key:"toDashed",value:function(e){for(var t=e.split(/(?=[A-Z])/),i=1,n=t.length,a=t[0].toLowerCase();i<n;i++)a+="-"+t[i].toLowerCase();return a}},{key:"toCamelCase",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=e.split(/-/),n=0,a=i.length,s="";n<a;n++)s+=n||t?i[n][0].toUpperCase()+i[n].substr(1).toLowerCase():i[n].toLowerCase();return s}},{key:"toAttributeName",value:function(e){return"data-"+t.toDashed(e)}},{key:"domReady",value:function(e){if(/comp|inter|loaded/.test((window.document||{}).readyState+""))return e();window.addEventListener?window.addEventListener("DOMContentLoaded",e,!1):window.attachEvent&&window.attachEvent("onload",e)}}]),t}(),K=function(){function e(t,i,n){s(this,e),e.collection.push(this),this.width=i||0,this.height=n||0,this.element=t,this.init()}return X(e,[{key:"init",value:function(){var t=e.pixelRatio;this.element.width=this.width*t,this.element.height=this.height*t,this.element.style.width=this.width+"px",this.element.style.height=this.height+"px",this.elementClone=this.element.cloneNode(!0),this.context=this.element.getContext("2d"),this.contextClone=this.elementClone.getContext("2d"),this.drawWidth=this.element.width,this.drawHeight=this.element.height,this.drawX=this.drawWidth/2,this.drawY=this.drawHeight/2,this.minSide=this.drawX<this.drawY?this.drawX:this.drawY,this.elementClone.initialized=!1,this.contextClone.translate(this.drawX,this.drawY),this.contextClone.save(),this.context.translate(this.drawX,this.drawY),this.context.save(),this.context.max=this.contextClone.max=this.minSide,this.context.maxRadius=this.contextClone.maxRadius=null}},{key:"destroy",value:function(){var t=e.collection.indexOf(this);~t&&e.collection.splice(t,1),this.context.clearRect(-this.drawX,-this.drawY,this.drawWidth,this.drawHeight),this.context.max=null,delete this.context.max,this.context.maxRadius=null,delete this.context.maxRadius,this.context=null,this.contextClone=null,this.elementClone=null,this.element=null,this.onRedraw=null}},{key:"commit",value:function(){var t=e.pixelRatio;return 1!==t&&(this.contextClone.scale(t,t),this.contextClone.save()),this}},{key:"redraw",value:function(){return this.init(),this.onRedraw&&this.onRedraw(),this}}],[{key:"redraw",value:function(){for(var t=0,i=e.collection.length;t<i;t++)e.collection[t].redraw()}},{key:"pixelRatio",get:function(){return window.devicePixelRatio||1}}]),e}();K.collection=[],window.matchMedia&&window.matchMedia("screen and (min-resolution: 2dppx)").addListener(K.redraw);var Q={renderTo:null,width:0,height:0,minValue:0,maxValue:100,value:0,units:!1,exactTicks:!1,majorTicks:[0,20,40,60,80,100],minorTicks:10,strokeTicks:!0,animatedValue:!1,animateOnInit:!1,title:!1,borders:!0,numbersMargin:1,listeners:null,valueInt:3,valueDec:2,majorTicksInt:1,majorTicksDec:0,animation:!0,animationDuration:500,animationRule:"cycle",colorPlate:"#fff",colorPlateEnd:"",colorMajorTicks:"#444",colorMinorTicks:"#666",colorStrokeTicks:"",colorTitle:"#888",colorUnits:"#888",colorNumbers:"#444",colorNeedle:"rgba(240,128,128,1)",colorNeedleEnd:"rgba(255,160,122,.9)",colorValueText:"#444",colorValueTextShadow:"rgba(0,0,0,0.3)",colorBorderShadow:"rgba(0,0,0,0.5)",colorBorderOuter:"#ddd",colorBorderOuterEnd:"#aaa",colorBorderMiddle:"#eee",colorBorderMiddleEnd:"#f0f0f0",colorBorderInner:"#fafafa",colorBorderInnerEnd:"#ccc",colorValueBoxRect:"#888",colorValueBoxRectEnd:"#666",colorValueBoxBackground:"#babab2",colorValueBoxShadow:"rgba(0,0,0,1)",colorNeedleShadowUp:"rgba(2,255,255,0.2)",colorNeedleShadowDown:"rgba(188,143,143,0.45)",colorBarStroke:"#222",colorBar:"#ccc",colorBarProgress:"#888",colorBarShadow:"#000",fontNumbers:"Arial",fontTitle:"Arial",fontUnits:"Arial",fontValue:"Arial",fontNumbersSize:20,fontTitleSize:24,fontUnitsSize:22,fontValueSize:26,fontNumbersStyle:"normal",fontTitleStyle:"normal",fontUnitsStyle:"normal",fontValueStyle:"normal",fontNumbersWeight:"normal",fontTitleWeight:"normal",fontUnitsWeight:"normal",fontValueWeight:"normal",needle:!0,needleShadow:!0,needleType:"arrow",needleStart:5,needleEnd:85,needleWidth:4,borderOuterWidth:3,borderMiddleWidth:3,borderInnerWidth:3,borderShadowWidth:3,valueBox:!0,valueBoxStroke:5,valueBoxWidth:0,valueText:"",valueTextShadow:!0,valueBoxBorderRadius:2.5,highlights:[{from:20,to:60,color:"#eee"},{from:60,to:80,color:"#ccc"},{from:80,to:100,color:"#999"}],highlightsWidth:15,highlightsLineCap:"butt",barWidth:20,barStrokeWidth:0,barProgress:!0,barShadow:0};o.prototype=Object.create(Array.prototype),o.prototype.constructor=o,o.prototype.get=function(e){if("string"==typeof e)for(var t=0,i=this.length;t<i;t++){if((this[t].options.renderTo.tagName?this[t].options.renderTo:document.getElementById(this[t].options.renderTo||"")).getAttribute("id")===e)return this[t]}else if("number"==typeof e)return this[e];return null};var ee="2.1.7",te=Math.round,ie=Math.abs,ne=new o;ne.version=ee;var ae=function(t){function i(t){s(this,i);var a=n(this,(i.__proto__||Object.getPrototypeOf(i)).call(this)),l=a.constructor.name;if("BaseGauge"===l)throw new TypeError("Attempt to instantiate abstract class!");if(ne.push(a),t.listeners&&Object.keys(t.listeners).forEach((function(e){(t.listeners[e]instanceof Array?t.listeners[e]:[t.listeners[e]]).forEach((function(t){a.on(e,t)}))})),a.version=ee,a.type=e[l]||i,a.initialized=!1,t.minValue=parseFloat(t.minValue),t.maxValue=parseFloat(t.maxValue),t.value=parseFloat(t.value)||0,t.borders||(t.borderInnerWidth=t.borderMiddleWidth=t.borderOuterWidth=0),!t.renderTo)throw TypeError("Canvas element was not specified when creating the Gauge object!");var r=t.renderTo.tagName?t.renderTo:document.getElementById(t.renderTo);if(!(r instanceof HTMLCanvasElement))throw TypeError("Given gauge canvas element is invalid!");return t.width=parseFloat(t.width)||0,t.height=parseFloat(t.height)||0,t.width&&t.height||(t.width||(t.width=r.parentNode?r.parentNode.offsetWidth:r.offsetWidth),t.height||(t.height=r.parentNode?r.parentNode.offsetHeight:r.offsetHeight)),a.options=t||{},a.options.animateOnInit&&(a._value=a.options.value,a.options.value=a.options.minValue),a.canvas=new K(r,t.width,t.height),a.canvas.onRedraw=a.draw.bind(a),a.animation=new Z(t.animationRule,t.animationDuration),a}return a(i,t),X(i,[{key:"update",value:function(e){return Object.assign(this.options,this.type.configure(e||{})),this.canvas.width=this.options.width,this.canvas.height=this.options.height,this.animation.rule=this.options.animationRule,this.animation.duration=this.options.animationDuration,this.canvas.redraw(),this}},{key:"destroy",value:function(){var e=ne.indexOf(this);~e&&ne.splice(e,1),this.canvas.destroy(),this.canvas=null,this.animation.destroy(),this.animation=null,this.emit("destroy")}},{key:"draw",value:function(){return this.options.animateOnInit&&!this.initialized&&(this.value=this._value,this.initialized=!0,this.emit("init")),this.emit("render"),this}},{key:"value",set:function(e){var t=this;e=i.ensureValue(e,this.options.minValue);var n=this.options.value;if(e!==n)if(this.options.animation){if(this.animation.frame&&(this.options.value=this._value,this._value===e))return this.animation.cancel(),void delete this._value;void 0===this._value&&(this._value=e),this.emit("animationStart"),this.animation.animate((function(i){var a=n+(e-n)*i;t.options.animatedValue&&t.emit("value",a,t.value),t.options.value=a,t.draw(),t.emit("animate",i,t.options.value)}),(function(){void 0!==t._value&&(t.emit("value",t._value,t.value),t.options.value=t._value,delete t._value),t.draw(),t.emit("animationEnd")}))}else this.emit("value",e,this.value),this.options.value=e,this.draw()},get:function(){return void 0===this._value?this.options.value:this._value}}],[{key:"configure",value:function(e){return e}},{key:"initialize",value:function(e,t){return new J(t,"canvas",e)}},{key:"fromElement",value:function(e){var t=J.toCamelCase(e.getAttribute("data-type")),i=e.attributes,n=0,a=i.length,s={};if(t){for(/Gauge$/.test(t)||(t+="Gauge");n<a;n++)s[J.toCamelCase(i[n].name.replace(/^data-/,""),!1)]=J.parse(i[n].value);new J(s,e.tagName,t).process(e)}}},{key:"ensureValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e=parseFloat(e),!isNaN(e)&&isFinite(e)||(e=parseFloat(t)||0),e}},{key:"mod",value:function(e,t){return(e%t+t)%t}},{key:"version",get:function(){return ee}}]),i}(H);void 0!==e&&(e.BaseGauge=ae,e.gauges=(window.document||{}).gauges=ne);var se=/{([_a-zA-Z]+[_a-zA-Z0-9]*)}/g,le={roundRect:u,padValue:h,formatMajorTickNumber:function(e,t){var i=void 0,n=!1;return i=0===t.majorTicksDec?Math.round(e).toString():e.toFixed(t.majorTicksDec),t.majorTicksInt>1?(n=~i.indexOf("."),~i.indexOf("-")?"-"+[t.majorTicksInt+t.majorTicksDec+2+(n?1:0)-i.length].join("0")+i.replace("-",""):[t.majorTicksInt+t.majorTicksDec+1+(n?1:0)-i.length].join("0")+i):i},radians:function(e){return e*Math.PI/180},radialPoint:function(e,t){return{x:-e*Math.sin(t),y:e*Math.cos(t)}},linearGradient:function(e,t,i,n){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,l=e.createLinearGradient(a?0:s,a?s:0,a?0:n,a?n:0);return l.addColorStop(0,t),l.addColorStop(1,i),l},drawNeedleShadow:function(e,t){t.needleShadow&&(e.shadowOffsetX=2,e.shadowOffsetY=2,e.shadowBlur=10,e.shadowColor=t.colorNeedleShadowDown)},drawValueBox:function(e,t,i,n,a,s){if(t.valueBox){c(e);var l=t.valueDec?1+t.valueDec:0,r="9".repeat(Math.max.apply(null,[String(parseInt(i)).length+l].concat(t.majorTicks.map((function(e){return String(parseInt(e,10)).length+l}))))),o=t.valueText||h(i,t),m=s/200,v=s/100,f=.4*v,g=1.2*v;e.font=d(t,"Value",m),p(e,t,f,g);var y=e.measureText(t.valueText?o:"-"+h(Number(r),t)).width;c(e);var b=parseFloat(t.fontValueSize)*m+f+g,x=v*parseFloat(t.valueBoxStroke),E=2*s-2*x,U=y+10*v,w=1.1*b+f+g,V=v*t.valueBoxBorderRadius,A=(parseFloat(t.valueBoxWidth)||0)/100*E;A>U&&(U=A),U>E&&(U=E);var I=n-U/2,T=a-w/2,C=a-5.75*v;if(e.beginPath(),V?u(e,I,T,U,w,V):e.rect(I,T,U,w),x){var S=e.createRadialGradient(n,C,10*v,n,C,20*v);S.addColorStop(0,t.colorValueBoxRect),S.addColorStop(1,t.colorValueBoxRectEnd),e.strokeStyle=S,e.lineWidth=x,e.stroke()}t.colorValueBoxShadow&&(e.shadowBlur=1.2*v,e.shadowColor=t.colorValueBoxShadow),t.colorValueBoxBackground&&(e.fillStyle=t.colorValueBoxBackground,e.fill()),e.closePath(),e.restore(),p(e,t,f,g),e.fillStyle=t.colorValueText,e.textAlign="center",e.textBaseline="alphabetic",e.fillText(o,I+U/2,a+w/2-b/3),e.restore()}},verifyError:function(e){if(!(e instanceof DOMException&&2152923147===e.result))throw e},prepareTicks:function(e){return e.majorTicks instanceof Array||(e.majorTicks=e.majorTicks?[e.majorTicks]:[]),e.majorTicks.length||(e.majorTicks.push(le.formatMajorTickNumber(e.minValue,e)),e.majorTicks.push(le.formatMajorTickNumber(e.maxValue,e))),["right"!==e.tickSide,"left"!==e.tickSide]},drawShadow:function(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2])return e.restore(),!0;e.save();var i=t.borderShadowWidth;return i&&(e.shadowBlur=i,e.shadowColor=t.colorBorderShadow),!0},font:d,normalizedValue:function(e){var t=e.value,i=e.minValue,n=e.maxValue,a=.01*(n-i);return{normal:t<i?i:t>n?n:t,indented:t<i?i-a:t>n?n+a:t}},formatContext:function(e,t){return t.replace(se,(function(t,i){var n=e[i];return void 0!==n?n:t}))}},re=Math.PI,oe=re/2,ue=Object.assign({},Q,{ticksAngle:270,startAngle:45,colorNeedleCircleOuter:"#f0f0f0",colorNeedleCircleOuterEnd:"#ccc",colorNeedleCircleInner:"#e8e8e8",colorNeedleCircleInnerEnd:"#f5f5f5",needleCircleSize:10,needleCircleInner:!0,needleCircleOuter:!0,needleStart:20,animationTarget:"needle",useMinPath:!1,barWidth:0,barStartPosition:"left"}),he=function(e){function t(e){return s(this,t),e=Object.assign({},ue,e||{}),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,t.configure(e)))}return a(t,e),X(t,[{key:"draw",value:function(){try{var e=this.canvas,i=[-e.drawX,-e.drawY,e.drawWidth,e.drawHeight],n=i[0],a=i[1],s=i[2],l=i[3],r=this.options;if("needle"===r.animationTarget){if(!e.elementClone.initialized){var o=e.contextClone;o.clearRect(n,a,s,l),o.save(),this.emit("beforePlate"),f(o,r),this.emit("beforeHighlights"),g(o,r),this.emit("beforeMinorTicks"),y(o,r),this.emit("beforeMajorTicks"),x(o,r),this.emit("beforeNumbers"),w(o,r),this.emit("beforeTitle"),V(o,r),this.emit("beforeUnits"),A(o,r),e.elementClone.initialized=!0}this.canvas.commit(),e.context.clearRect(n,a,s,l),e.context.save(),e.context.drawImage(e.elementClone,n,a,s,l),e.context.save(),this.emit("beforeProgressBar"),C(e.context,r),this.emit("beforeValueBox"),T(e.context,r,S(this)),this.emit("beforeNeedle"),I(e.context,r)}else{var u=-le.radians((r.value-r.minValue)/(r.maxValue-r.minValue)*r.ticksAngle);if(e.context.clearRect(n,a,s,l),e.context.save(),this.emit("beforePlate"),f(e.context,r),e.context.rotate(u),this.emit("beforeHighlights"),g(e.context,r),this.emit("beforeMinorTicks"),y(e.context,r),this.emit("beforeMajorTicks"),x(e.context,r),this.emit("beforeNumbers"),w(e.context,r),this.emit("beforeProgressBar"),C(e.context,r),e.context.rotate(-u),e.context.save(),!e.elementClone.initialized){var h=e.contextClone;h.clearRect(n,a,s,l),h.save(),this.emit("beforeTitle"),V(h,r),this.emit("beforeUnits"),A(h,r),this.emit("beforeNeedle"),I(h,r),e.elementClone.initialized=!0}e.context.drawImage(e.elementClone,n,a,s,l)}this.emit("beforeValueBox"),T(e.context,r,S(this)),Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"draw",this).call(this)}catch(e){le.verifyError(e)}return this}},{key:"value",set:function(e){e=ae.ensureValue(e,this.options.minValue),this.options.animation&&360===this.options.ticksAngle&&this.options.useMinPath&&(this._value=e,e=this.options.value+((e-this.options.value)%360+540)%360-180),z(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"value",e,this)},get:function(){return Y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"value",this)}}],[{key:"configure",value:function(e){return e.barWidth>50&&(e.barWidth=50),isNaN(e.startAngle)&&(e.startAngle=45),isNaN(e.ticksAngle)&&(e.ticksAngle=270),e.ticksAngle>360&&(e.ticksAngle=360),e.ticksAngle<0&&(e.ticksAngle=0),e.startAngle<0&&(e.startAngle=0),e.startAngle>360&&(e.startAngle=360),e}}]),t}(ae);void 0!==e&&(e.RadialGauge=he),ae.initialize("RadialGauge",ue);var de=Object.assign({},Q,{borderRadius:0,barBeginCircle:30,colorBarEnd:"",colorBarProgressEnd:"",needleWidth:6,tickSide:"both",needleSide:"both",numberSide:"both",ticksWidth:10,ticksWidthMinor:5,ticksPadding:5,barLength:85,fontTitleSize:26,highlightsWidth:10}),ce=function(e){function i(e){return s(this,i),e=Object.assign({},de,e||{}),n(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,i.configure(e)))}return a(i,e),X(i,[{key:"draw",value:function(){try{var e=this.canvas,n=[-e.drawX,-e.drawY,e.drawWidth,e.drawHeight],a=n[0],s=n[1],l=n[2],r=n[3],o=this.options;if(!e.elementClone.initialized){var u=e.contextClone;u.clearRect(a,s,l,r),u.save(),this.emit("beforePlate"),this.drawBox=L(u,o,a,s,l,r),this.emit("beforeBar"),O.apply(void 0,[u,o].concat(t(this.drawBox))),e.context.barDimensions=u.barDimensions,this.emit("beforeHighlights"),function(e,t){var i=e.barDimensions,n=i.isVertical,a=i.width,s=i.length,l=i.barWidth,r=i.barOffset,o=i.barMargin,u=i.X,h=i.Y,d=i.ticksLength,c=i.ticksPadding,p=a*(parseFloat(t.highlightsWidth)||0)/100;if(t.highlights&&p){var m="right"!==t.tickSide,v="left"!==t.tickSide,f=0,g=t.highlights.length,y=(a-l)/2,b=t.maxValue-t.minValue,x=te(n?u+y:u+o+r),E=p,U=n?h+s-o-r:h+y,w=te((t.ticksWidth/100+c)*a)+(p-t.ticksWidth/100*a),V=te(l+c*a);for(e.save();f<g;f++){var A=t.highlights[f],I=d*ie(t.minValue-A.from)/b,T=d*ie((A.to-A.from)/b);e.beginPath(),e.fillStyle=A.color,n?(m&&e.rect(x-w,U-I,E,-T),v&&e.rect(x+V,U-I,E,-T)):(m&&e.rect(x+I,U-w,T,E),v&&e.rect(x+I,U+V,T,E)),e.fill(),e.closePath()}}}(u,o),this.emit("beforeMinorTicks"),function(e,t){var i=le.prepareTicks(t),n=G(i,2),a=n[0],s=n[1],l=[],r=t.minValue,o=Math.abs(t.minorTicks)||0,u=o?(t.maxValue-t.minValue)/(o*(t.majorTicks.length-1)):0;if(o)if(t.exactTicks)for(var h=ae.mod(t.majorTicks[0],o)||0;r<t.maxValue;r+=o)h+r<t.maxValue&&l.push(h+r);else for(;r<t.maxValue;r+=u)l.push(r);D(e,t.colorMinorTicks||t.colorStrokeTicks,l,t.minValue,t.maxValue,a,s,1,t.ticksWidthMinor/100)}(u,o),this.emit("beforeMajorTicks"),function(e,t){var i=le.prepareTicks(t),n=G(i,2),a=n[0],s=n[1],l=2,r=(t.maxValue-t.minValue)/(t.majorTicks.length-1),o=t.colorMajorTicks instanceof Array?t.colorMajorTicks:new Array(t.majorTicks.length).fill(t.colorStrokeTicks||t.colorMajorTicks);if(D(e,o,t.exactTicks?t.majorTicks:t.majorTicks.map((function(e,i){return t.minValue+r*i})),t.minValue,t.maxValue,a,s,l,t.ticksWidth/100),t.strokeTicks){var u=e.barDimensions,h=u.isVertical,d=u.length,c=u.width,p=u.barWidth,m=u.barMargin,v=u.barOffset,f=u.X,g=u.Y,y=u.ticksLength,b=u.pixelRatio,x=u.ticksPadding,E=(c-p)/2+p+x*c,U=(c-p)/2-x*c,w=void 0,V=void 0,A=void 0,I=void 0;e.strokeStyle=t.colorStrokeTicks||o[0],l*=b,h?(I=(V=g+d-m-v+l/2)-y-l,a&&(A=w=te(f+U),k(e,w,V,A,I)),s&&(A=w=te(f+E),k(e,w,V,A,I))):(A=(w=f+m+v-l/2)+y+l,a&&(I=V=te(g+U),k(e,w,V,A,I)),s&&(I=V=te(g+E),k(e,w,V,A,I)))}}(u,o),this.emit("beforeNumbers"),function(e,t){var i=e.barDimensions,n=i.isVertical,a=i.length,s=i.width,l=i.barWidth,r=i.barMargin,o=i.barOffset,u=i.X,h=i.Y,d=i.ticksLength,c=i.ticksPadding,p=t.maxValue-t.minValue,m=p/(t.majorTicks.length-1),v=t.exactTicks?t.majorTicks:t.majorTicks.map((function(e,i){return t.minValue+m*i})),f=v.length,g="right"!==t.numberSide,y="left"!==t.numberSide,b=t.fontNumbersSize*s/200,x=0,E=(t.ticksWidth/100+2*c)*s,U=(s-l)/2-E,w=(s-l)/2+l+E,V=void 0,A=void 0,I=void 0,T=void 0,C=t.colorNumbers instanceof Array?t.colorNumbers:new Array(f).fill(t.colorNumbers),S=t.numbersMargin/100*s;for(e.font=le.font(t,"Numbers",s/200),e.lineWidth=0,e.textAlign="center";x<f;x++)e.fillStyle=C[x],T=t.majorTicks[x],I=t.exactTicks?d*((v[x]-t.minValue)/p):x*d/(f-1),n?(A=h+a-r-o-I+b/3,g&&(e.textAlign="right",e.fillText(T,u+U-S,A)),y&&(e.textAlign="left",e.fillText(T,u+w+S,A))):(e.measureText(T).width,V=u+r+o+I,g&&e.fillText(T,V,h+U-S),y&&e.fillText(T,V,h+w+b+S))}(u,o),this.emit("beforeTitle"),function(e,t){if(t.title){var i=e.barDimensions,n=i.isVertical,a=i.width,s=i.length,l=i.baseX,r=i.baseY,o=i.titleMargin,u=t.fontTitleSize*a/200,h=te(l+(n?a:s)/2),d=te(r+o/2-(n?u:u/2)-.025*(n?s:a));e.save(),e.textAlign="center",e.fillStyle=t.colorTitle,e.font=le.font(t,"Title",a/200),e.lineWidth=0,e.fillText(t.title,h,d,n?a:s)}}(u,o),this.emit("beforeUnits"),function(e,t){if(t.units){var i=e.barDimensions,n=i.isVertical,a=i.width,s=i.length,l=i.baseX,r=i.baseY,o=i.unitsMargin,u=t.fontUnitsSize*a/200,h=te(l+(n?a:s)/2),d=te(r+(n?s:a)+o/2-u/2);e.save(),e.textAlign="center",e.fillStyle=t.colorUnits,e.font=le.font(t,"Units",a/200),e.lineWidth=0,e.fillText(le.formatContext(t,t.units),h,d,n?a:s)}}(u,o),e.elementClone.initialized=!0}this.canvas.commit(),e.context.clearRect(a,s,l,r),e.context.save(),e.context.drawImage(e.elementClone,a,s,l,r),e.context.save(),this.emit("beforeProgressBar"),N.apply(void 0,[e.context,o].concat(t(this.drawBox))),this.emit("beforeNeedle"),function(e,t){if(t.needle){var i=e.barDimensions,n=i.isVertical,a=i.width,s=i.length,l=i.barWidth,r=i.barOffset,o=i.barMargin,u=i.ticksLength,h=i.X,d=i.Y,c=i.ticksPadding,p="right"!==t.needleSide,m="left"!==t.needleSide,v=u*(le.normalizedValue(t).indented-t.minValue)/(t.maxValue-t.minValue),f=(t.ticksWidth/100+c)*a,g=l/2+f,y=g*(t.needleEnd/100),b=void 0,x=void 0,E="arrow"===t.needleType.toLowerCase()?j:B,U=(a-l)/2,w=g*(t.needleStart/100),V=U-f-w,A=U+l+f+w;e.save(),le.drawNeedleShadow(e,t),n?(x=te(d+s-o-r-v),p&&E(e,t,b=te(h+V),x,b+y,x,y),m&&E(e,t,b=te(h+A),x,b-y,x,y,!0)):(b=te(h+o+r+v),p&&E(e,t,b,x=te(d+V),b,x+y,y),m&&E(e,t,b,x=te(d+A),b,x-y,y,!0)),e.restore()}}(e.context,o),this.emit("beforeValueBox"),W.apply(void 0,[e.context,o,o.animatedValue?this.options.value:this.value].concat(t(this.drawBox))),Y(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"draw",this).call(this)}catch(e){le.verifyError(e)}return this}}],[{key:"configure",value:function(e){return e.barStrokeWidth>=e.barWidth&&(e.barStrokeWidth=te(e.barWidth/2)),e.hasLeft=M("right",e),e.hasRight=M("left",e),e.value>e.maxValue&&(e.value=e.maxValue),e.value<e.minValue&&(e.value=e.minValue),ae.configure(e)}}]),i}(ae);void 0!==e&&(e.LinearGauge=ce),ae.initialize("LinearGauge",de),Object.assign(e,{Collection:o,GenericOptions:Q,Animation:Z,BaseGauge:ae,drawings:le,SmartCanvas:K,DomObserver:J,vendorize:l})}(e.exports)},139:function(e,t){var i;i=function(){"use strict";var e=String.fromCharCode,t=Object.prototype.hasOwnProperty,i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array,n=!1,a=!1;try{"a"===e.apply(null,[97])&&(n=!0)}catch(e){}if(i)try{"a"===e.apply(null,new Uint8Array([97]))&&(a=!0)}catch(e){}var s=65533,l=null,r=!1;-1!=="abcほげ".lastIndexOf("ほげ",1)&&(r=!0);var o=function(){for(var i="",n={8:1,10:1,11:1,12:1,13:1,92:1},a=0;a<127;a++)t.call(n,a)||(i+=e(a));return i}(),u=o.length,h=Math.max(u,62)-Math.min(u,62),d=u-1,c=1024,p=s,m=p-u,v=u+1,f=h+20,g=u+5,y=u-h-19;function b(e){this._init(e)}function x(e){this._init(e)}function E(e){this._init(e)}function U(e){this._init(e)}function w(){var e,t,i,n="abcdefghijklmnopqrstuvwxyz",a="";for(e=0;e<26;e++)for(i=n.charAt(e),t=25;t>15&&a.length<c;t--)a+=" "+i+" "+n.charAt(t);for(;a.length<c;)a=" "+a;return a=a.slice(0,c)}function V(t,i){if(null==i?i=t.length:t=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)}(t,i),n&&a&&i<s){if(l)return e.apply(null,t);if(null===l)try{var r=e.apply(null,t);return i>s&&(l=!0),r}catch(e){l=!1}}return function(t){for(var i,n="",a=t.length,r=0;r<a;){if(i=t.subarray?t.subarray(r,r+s):t.slice(r,r+s),r+=s,!l){if(null===l)try{n+=e.apply(null,i),i.length>s&&(l=!0);continue}catch(e){l=!1}return A(t)}n+=e.apply(null,i)}return n}(t)}function A(t){for(var i="",n=t.length,a=0;a<n;a++)i+=e(t[a]);return i}function I(e,t){if(!i)return new Array(t);switch(e){case 8:return new Uint8Array(t);case 16:return new Uint16Array(t)}}function T(e){for(var t,i,n=[],a=0,s=e.length;a<s;a++)(t=e.charCodeAt(a))>=55296&&t<=56319&&a+1<s&&(i=e.charCodeAt(a+1))>=56320&&i<=57343&&(t=1024*(t-55296)+i-56320+65536,a++),t<128?n[n.length]=t:t<2048?(n[n.length]=192|t>>6&31,n[n.length]=128|63&t):t<65536?(n[n.length]=224|t>>12&15,n[n.length]=128|t>>6&63,n[n.length]=128|63&t):t<2097152&&(n[n.length]=240|t>>18&15,n[n.length]=128|t>>12&63,n[n.length]=128|t>>6&63,n[n.length]=128|63&t);return V(n)}function C(e){for(var t,i,n,a=[],s=0,l=e.length;s<l;)(t=(i=e.charCodeAt(s++))>>4)>=0&&t<=7?n=i:12===t||13===t?n=(31&i)<<6|63&e.charCodeAt(s++):14===t?n=(15&i)<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++):15===t&&(n=(7&i)<<18|(63&e.charCodeAt(s++))<<12|(63&e.charCodeAt(s++))<<6|63&e.charCodeAt(s++)),n<=65535?a[a.length]=n:(n-=65536,a[a.length]=55296+(n>>10),a[a.length]=n%1024+56320);return V(a)}function S(e,t){for(var i,n,a=0,s=0,l=e.length;s<l;s++)55296==(64512&(i=e.charCodeAt(s)))&&s+1<l&&56320==(64512&(n=e.charCodeAt(s+1)))&&(i=65536+(i-55296<<10)+(n-56320),s++),i<128?a++:a+=i<2048?2:i<65536?3:4;return a}b.prototype={_init:function(e){e=e||{},this._data=null,this._table=null,this._result=null,this._onDataCallback=e.onData,this._onEndCallback=e.onEnd,this._maxBytes=e.maxBytes},_createTable:function(){for(var e=I(8,u),t=0;t<u;t++)e[t]=o.charCodeAt(t);return e},_onData:function(e,t){var i=V(e,t);this._onDataCallback?this._onDataCallback(i):this._result+=i},_onEnd:function(){this._onEndCallback&&this._onEndCallback(),this._data=this._table=null},_search:function(){var e=2,t=this._data,i=this._offset,n=d;if(this._dataLen-i<n&&(n=this._dataLen-i),e>n)return!1;var a,s,l,o,u,h=i-304,c=t.substring(h,i+n),p=i+e-3-h;do{if(2===e){if(s=t.charAt(i)+t.charAt(i+1),!~(l=c.indexOf(s))||l>p)break}else 3===e?s+=t.charAt(i+2):s=t.substr(i,e);if(!~(o=r?t.substring(h,i+e-1).lastIndexOf(s):c.lastIndexOf(s,p)))break;u=o,a=h+o;do{if(t.charCodeAt(i+e)!==t.charCodeAt(a+e))break}while(++e<n);if(l===o){e++;break}}while(++e<n);return 2!==e&&(this._index=304-u,this._length=e-1,!0)},compress:function(e){if(null==e||0===e.length)return"";var t,i=this._createTable(),n=w(),a=I(8,p),s=0,l=0;this._result="",this._offset=n.length,this._data=n+e,this._dataLen=this._data.length,n=e=null;for(var r,o,h,c,y,b=-1,x=-1;this._offset<this._dataLen;){if(this._search()?(this._index<d?(o=this._index,h=0):(o=this._index%d,h=(this._index-o)/d),2===this._length?(a[s++]=i[h+14],a[s++]=i[o],l+=2):(a[s++]=i[h+9],a[s++]=i[o],a[s++]=i[this._length],l+=3),this._offset+=this._length,~x&&(x=-1)):(r=this._data.charCodeAt(this._offset++))<132?(r<0?(o=r,h=0,b=v):b=(h=(r-(o=r%0))/0)+v,x===b?(a[s++]=i[o],l++):(a[s++]=i[b-f],a[s++]=i[o],l+=2,x=b)):(r<0?(o=r,h=0,b=g):b=(h=(r-(o=r%0))/0)+g,o<0?(c=o,y=0):y=(o-(c=o%0))/0,x===b?(a[s++]=i[c],a[s++]=i[y],l+=2):(a[s++]=i[8],a[s++]=i[b-u],a[s++]=i[c],a[s++]=i[y],l+=4,x=b)),l>this._maxBytes)return!1;s>=m&&(this._onData(a,s),s=0)}return s>0&&this._onData(a,s),this._onEnd(),t=this._result,this._result=null,null===t?"":t}},x.prototype={_init:function(e){e=e||{},this._result=null,this._onDataCallback=e.onData,this._onEndCallback=e.onEnd},_createTable:function(){for(var e={},t=0;t<u;t++)e[o.charAt(t)]=t;return e},_onData:function(e){var t;this._onDataCallback&&(e?(t=this._result,this._result=[]):(t=this._result.slice(c,65533),this._result=this._result.slice(0,c).concat(this._result.slice(65533))),t.length>0&&this._onDataCallback(V(t)))},_onEnd:function(){this._onEndCallback&&this._onEndCallback()},decompress:function(e){if(null==e||0===e.length)return"";this._result=function(e){for(var t=[],i=e&&e.length,n=0;n<i;n++)t[n]=e.charCodeAt(n);return t}(w());for(var t,i,n,a,s,l,r,o,u,h,p=this._createTable(),m=!1,v=null,f=e.length,g=0;g<f;g++)if(void 0!==(n=p[e.charAt(g)])){if(n<y)s=m?0*p[e.charAt(++g)]+n+0*v:0*v+n,this._result[this._result.length]=s;else if(n<7)v=n-y,m=!1;else if(8===n)v=(a=p[e.charAt(++g)])-5,m=!0;else if(n<19){if(a=p[e.charAt(++g)],n<14?(l=(n-9)*d+a,r=p[e.charAt(++g)]):(l=(n-14)*d+a,r=2),(o=this._result.slice(-l)).length>r&&(o.length=r),u=o.length,o.length>0)for(h=0;h<r;)for(i=0;i<u&&(this._result[this._result.length]=o[i],!(++h>=r));i++);v=null}this._result.length>=67581&&this._onData()}return this._result=this._result.slice(c),this._onData(!0),this._onEnd(),t=V(this._result),this._result=null,t}},E.prototype={_init:function(e){e=e||{},this._codeStart=e.codeStart||255,this._codeMax=e.codeMax||65535,this._maxBytes=e.maxBytes},compress:function(i){if(null==i||0===i.length)return"";var n,a,s,l,r="",o=0,u=0,h=i.length,d="",c=this._codeStart+1,p=this._codeMax,m=2,v=[],f=0;for(h>0&&(d=n=i.charAt(u++));u<h;)if(s=1<<(l=(a=d+(n=i.charAt(u++))).length),(l<32&&f&s||l>=32&&void 0!==v[l])&&t.call(v[l],a))d+=n;else{if(1===d.length?(r+=d,o++):(r+=v[d.length][d],o+=m),o>this._maxBytes)return!1;c<=p&&(s=1<<(l=(a=d+n).length),(l<32&&!(f&s)||l>=32&&void 0===v[l])&&(v[l]={},f|=s),v[l][a]=e(c++),2048===c&&(m=3)),d=n}return 1===d.length?(r+=d,o++):(r+=v[d.length][d],o+=m),!(o>this._maxBytes)&&r},decompress:function(i){if(null==i||0===i.length)return"";var n,a,s,l,r="",o={},u=this._codeStart+1,h=this._codeStart,d=0,c=i.length;for(c>0&&(n=i.charCodeAt(d++),r+=a=e(n),s=a);d<c;)r+=l=(n=i.charCodeAt(d++))<=h?e(n):t.call(o,n)?o[n]:s+a,a=l.charAt(0),o[u++]=s+a,s=l;return r}},U.prototype={_init:function(e){e=e||{},this._encoding=e.encoding||"utf-8"},compress:function(e){if(null==e||0===e.length)return"";var t,i="",n=S(e=""+e),a=.9*n|0,s=e.length,l={maxBytes:n};return n===s?(t="W",l.codeStart=127,l.codeMax=2047,!1===(i=new E(l).compress(e))&&(t="S",!1===(i=new b(l).compress(e))&&(t="N",i=e))):n>s&&a<s?(t="U",!1===(i=new E(l).compress(T(e)))&&(t="S",!1===(i=new b(l).compress(e))&&(t="N",i=e))):(t="S",!1===(i=new b(l).compress(e))&&(t="U",(!1===(i=new E(l).compress(T(e)))||S(i)>n)&&(t="N",i=e))),t+i},decompress:function(e){if(null==e||0===e.length)return"";switch((e=""+e).charAt(0)){case"S":return this._decompressByS(e.substring(1));case"W":return this._decompressByW(e.substring(1));case"U":return this._decompressByU(e.substring(1));case"N":return this._decompressByN(e.substring(1));default:return e}},_decompressByS:function(e){return(new x).decompress(e)},_decompressByW:function(e){return new E({codeStart:127,codeMax:2047}).decompress(e)},_decompressByU:function(e){return C((new E).decompress(e))},_decompressByN:function(e){return e}};var _="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",L=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];return{compress:function(e,t){return new U(t).compress(e)},decompress:function(e,t){return new U(t).decompress(e)},compressToBase64:function(e,t){return function(e){var t,i,n,a,s,l;for(n=e.length,i=0,t="";i<n;){if(a=255&e.charCodeAt(i++),i===n){t+=_.charAt(a>>2)+_.charAt((3&a)<<4)+"==";break}if(s=e.charCodeAt(i++),i===n){t+=_.charAt(a>>2)+_.charAt((3&a)<<4|(240&s)>>4)+_.charAt((15&s)<<2)+"=";break}l=e.charCodeAt(i++),t+=_.charAt(a>>2)+_.charAt((3&a)<<4|(240&s)>>4)+_.charAt((15&s)<<2|(192&l)>>6)+_.charAt(63&l)}return t}(T(new U(t).compress(e)))},decompressFromBase64:function(t,i){return new U(i).decompress(C(function(t){var i,n,a,s,l,r,o;for(r=t.length,l=0,o="";l<r;){do{i=L[255&t.charCodeAt(l++)]}while(l<r&&-1===i);if(-1===i)break;do{n=L[255&t.charCodeAt(l++)]}while(l<r&&-1===n);if(-1===n)break;o+=e(i<<2|(48&n)>>4);do{if(61==(a=255&t.charCodeAt(l++)))return o;a=L[a]}while(l<r&&-1===a);if(-1===a)break;o+=e((15&n)<<4|(60&a)>>2);do{if(61==(s=255&t.charCodeAt(l++)))return o;s=L[s]}while(l<r&&-1===s);if(-1===s)break;o+=e((3&a)<<6|s)}return o}(t)))}}},e.exports?e.exports=i():t.lzjs=i()}},t={};function i(n){var a=t[n];if(void 0!==a)return a.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,i),s.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=i(139),t=i.n(e);function n(e){return JSON.stringify(e)}function a(e,t){var i,n;i=new Blob([e],{type:"text/plain"}),s(n=window.URL.createObjectURL(i),t),setTimeout((function(){return window.URL.revokeObjectURL(n)}),1e3)}function s(e,t){var i;(i=document.createElement("a")).href=e,i.download=t,document.body.appendChild(i),i.style="display: none",i.click(),i.remove()}const l={};var r=i(877),o=i.n(r);l.ESP32C6_Expander={name:"ESP32C6 Expander",Overlay:o(),OverlayWidth:610,OverlayElementHeight:25,CANBusCount:2,Pins:[{name:"1",value:1,supportedModes:"digitalin digitalout analog",overlayX:450,overlayY:345,align:"right"},{name:"3",value:3,supportedModes:"digitalin digitalout analog",overlayX:450,overlayY:391,align:"right"},{name:"4",value:4,supportedModes:"digitalin digitalout analog",overlayX:450,overlayY:414,align:"right"},{name:"5",value:5,supportedModes:"digitalin digitalout digitalinterrupt analog pwm",overlayX:450,overlayY:437,align:"right"},{name:"6",value:6,supportedModes:"digitalin digitalout digitalinterrupt analog pwm",overlayX:450,overlayY:460,align:"right"},{name:"7",value:7,supportedModes:"digitalin digitalout digitalinterrupt analog pwm",overlayX:450,overlayY:483,align:"right"},{name:"10",value:10,supportedModes:"digitalout",overlayX:450,overlayY:345,align:"left"},{name:"12",value:12,supportedModes:"digitalin digitalout",overlayX:450,overlayY:391,align:"left"},{name:"13",value:14,supportedModes:"digitalin digitalout",overlayX:450,overlayY:414,align:"left"},{name:"14",value:14,supportedModes:"digitalin digitalout",overlayX:450,overlayY:437,align:"left"},{name:"15",value:15,supportedModes:"digitalin digitalout",overlayX:450,overlayY:460,align:"left"},{name:"16",value:16,supportedModes:"digitalin digitalout digitalinterrupt analog pwm",overlayX:450,overlayY:483,align:"left"}]};function u(e,t,i,n){const a=h(e,t,i,n);return function(e){return!e.type&&!e.unit&&a(e)}}function h(e,t,i,n){return function(a){if(a.type||a.unit){if(i?.length||n?.length)return!1;if(null!=e?.[0]){if(1!==e.length)return!1;if(GetMeasurementNameFromUnitName(a.unit)!==GetMeasurementNameFromUnitName(e[0]))return!1}else if(null!=t?.[0]){if(1!==t.length)return!1;if(null==a.unit&&null==a.type)return!1;if(null!=a.unit&&-1===t[0].split("|").indexOf("float"))return!1;if(null!=a.type&&!t[0].split("|").some((e=>-1!==a.type.split("|").indexOf(e))))return!1}return!0}if(null!=e||null!=t){if(0===(e?.length??t?.length??0)&&0!==(a.outputUnits?.length??a.outputTypes?.length))return!1;for(let i=0;i<(e?.length??t?.length??0);i++)if(null!=e?.[i]&&""!==e[i]){if(-1===(a.outputTypes?.[i]?.split("|").indexOf("float")??-1)&&e[i]!==a.outputUnits?.[i])return!1}else if(null!=t?.[i]){if(null==a.outputUnits?.[i]&&a.outputTypes,null!=a.outputUnits?.[i]&&-1===t[i].split("|").indexOf("float"))return!1;if(null!=a.outputTypes?.[i]&&!t[i].split("|").some((e=>-1!==a.outputTypes[i].split("|").indexOf(e))))return!1}}if(null!=n||null!=i){if(0===(n?.length??i?.length??0)&&0!==(a.inputUnits?.length??a.inputTypes?.length??0))return!1;for(let e=0;e<(n?.length??i?.length??0);e++)if(null!=n?.[e]){if(-1===(a.inputTypes?.[e]?.split("|").indexOf("float")??-1)&&n[e]!==a.inputUnits?.[e])return!1}else if(null!=i?.[e]){if(null==a.inputUnits?.[e]&&a.inputTypes,null!=a.inputUnits?.[e]&&-1===i[e].split("|").indexOf("float"))return!1;if(null!=a.inputTypes?.[e]&&!i[e].split("|").some((t=>-1!==a.inputTypes[e].split("|").indexOf(t))))return!1}}return!0}}function d(e){for(var t=window.atob(e),i=t.length,n=new Uint8Array(i),a=0;a<i;a++)n[a]=t.charCodeAt(a);return n.buffer}function c(e){return ve.find((t=>t.type===e.type)).toArrayBuffer.call(e)}let p=1e4,m=0,v=1,f=2,g=3,y=4,b=5,x=10,E=11,U=12,w=13,V=14,A=15,I=16,T=17,C=18,S=19,_=20,L=21,P=22,O=2e4,M=1,N=2,R=3,D=4,k=5,F=6,B=7,j=14,W=15,G=16,Y=17,z=18,X=3e4,H=1,q=2,$=3,Z=4e4,J=1,K=3,Q=4,ee=5,te=6,ie=7,ne=8;Uint8Array.prototype.toHex=function(){for(var e=Array.prototype.map.call(new Uint8Array(this),(e=>("00"+e.toString(16)).slice(-2))),t=`${e[0]}`,i=1;i<e.length;i++)t+=i%16==0?"\n":i%8==0?"  ":" ",t+=e[i];return t};let ae=[];for(let e=0;e<256;++e){let t=e;for(let e=0;e<8;++e)t=1&t?3988292384^t>>>1:t>>>1;ae[e]=t}function se(e){for(var t=9e15,i=-9e15,n=0;n<e.length;n++){if(e[n]%1!=0)return"FLOAT";e[n]<t&&(t=e[n]),e[n]>i&&(i=e[n])}return"boolean"==typeof e[0]?"BOOL":le(t<0?i<0||t<-i?t:-i:i)}function le(e){if(null==e)return"VOID";if(Array.isArray(e))return se(e);if("boolean"==typeof e)return"BOOL";if(e%1!=0)return"FLOAT";if(e<0){if(e<128&&e>-129)return"INT8";if(e<32768&&e>-32759)return"INT16";if(e<2147483648&&e>-2147483649)return"INT32";if(e<0x8000000000000000&&e>-0x8000000000000000)return"INT64";throw"number too big"}if(e<128)return"INT8";if(e<256)return"UINT8";if(e<32768)return"INT16";if(e<65536)return"UINT16";if(e<2147483648)return"INT32";if(e<4294967295)return"UINT32";if(e<0x8000000000000000)return"INT64";if(e<0x10000000000000000)return"UINT64";throw"number too big"}function re(e){switch(e){case"VOID":return 0;case"UINT8":return 1;case"UINT16":return 2;case"UINT32":return 3;case"UINT64":return 4;case"INT8":return 5;case"INT16":return 6;case"INT32":return 7;case"INT64":return 8;case"FLOAT":return 9;case"DOUBLE":return 10;case"BOOL":return 11}}ArrayBuffer.prototype.crc32=function(){var e=-1;let t=new Uint8Array(this);for(let i=0;i<t.length;++i)e=ae[255&(e^t[i])]^e>>>8;return e^=-1},ArrayBuffer.prototype.concatArray=function(e){var t=new Uint8Array(this.byteLength+e.byteLength);return this.byteLength>0&&t.set(new Uint8Array(this),0),t.set(new Uint8Array(e),this.byteLength),t.buffer},ArrayBuffer.prototype.pad=function(e,t){null==t&&(t=255);for(var i=[],n=0;n<e;n++)i[n]=t;return this.concatArray(new Uint8Array(i).buffer)},ArrayBuffer.prototype.align=function(e,t){return this.byteLength%e>0?this.pad(e-this.byteLength%e,t):this};let oe=[{type:"INT8",align:1},{type:"INT16",align:2},{type:"INT32",align:4},{type:"INT64",align:8},{type:"BOOL",align:1},{type:"UINT8",align:1},{type:"UINT16",align:2},{type:"UINT32",align:4},{type:"UINT64",align:8},{type:"FLOAT",align:4},{type:"DOUBLE",align:8}],ue=[{type:"INT8",align:1},{type:"INT16",align:2},{type:"INT32",align:4},{type:"INT64",align:8},{type:"BOOL",align:1},{type:"UINT8",align:1},{type:"UINT16",align:2},{type:"UINT32",align:4},{type:"UINT64",align:8},{type:"FLOAT",align:4},{type:"DOUBLE",align:8}];function he(e,t){return t={...t},t.outputVariables??=[],t.outputUnits=(null==t.unit?t.outputUnits:[t.unit])??[],delete t.unit,t.outputVariables=t.outputVariables?.map(((e,i)=>{if("string"!=typeof e)return e;let n=e.substring(e.indexOf("(")>-1?e.indexOf("(")+1:e.length);n.indexOf(")")>0&&(n=n.substring(0,n.indexOf(")")),t.outputUnits[i]??=n);let a=e.substring(0,e.indexOf("(")>-1?e.indexOf("("):e.length);return console.log(a),a})),t.inputVariables??=[],t.outputVariables&&t.outputVariables.some((e=>null!=e))||t.intputVariables&&t.intputVariables.some((e=>null!=e))?(e.type="Package",e.outputVariables=t.outputVariables,e.outputUnits=t.outputUnits,e.inputVariables=t.inputVariables,{type:"definition",value:[e]}):e}function de(e,t=2){return(this.outputVariables||this.inputVariables)&&(this.inputVariables??=2===t?[0,0]:[0],this.outputVariables??=[0]),he({type:"definition",value:[{type:"UINT32",value:p+e}]},this)}function ce(e){const t={name:this.outputVariables?.[0]?.name,type:"Record"};return{type:"Group",value:[{...this,type:"Input_DigitalRecord",outputVariables:[t]},he(e,{...this,inputVariables:[t,{name:"CurrentTick",type:"tick"}]})]}}function pe(e){const t=this.types?.find((t=>t.type==e.type));if((e={...e,...t}).definition)return e.definition;e.types??=[];for(let t in this.types)null==e.types.find((e=>e.type===this.types[t].type))&&e.types.push(this.types[t]);if(e.toDefinition){let t=e.toDefinition.call(e);if(null==t)return;return"definition"!==t.type&&(t={type:"definition",value:[t]}),t.value.flatMap((t=>pe.call(e,t)))}return e}function me(){return{type:"definition",value:this.value.flatMap((e=>pe.call(this,e))),types:this.types}}let ve=[{type:"definition",toDefinition:me,toArrayBuffer:function(){let e=me.call(this);var t=new ArrayBuffer;for(var i in e.value)if(null!=e.value[i]){var n=e.types.find((t=>t.type===e.value[i].type)),a=e.value[i].align;null==a&&null!=n&&(a=n.align),a&&(t=t.align(a));var s=e.value[i].toArrayBuffer;null==s&&null!=n&&"definition"!==e.value[i].type&&(s=n.toArrayBuffer),null!=s&&(t=t.concatArray(s.call(e.value[i])))}return t}},{type:"INT8",toArrayBuffer(){return new Int8Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"INT16",toArrayBuffer(){return new Int16Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"INT32",toArrayBuffer(){return new Int32Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"INT64",toArrayBuffer(){return new BigInt64Array(Array.isArray(this.value)?this.value:[BigInt(this.value)]).buffer}},{type:"BOOL",toArrayBuffer(){return new Uint8Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"UINT8",toArrayBuffer(){return new Uint8Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"UINT16",toArrayBuffer(){return new Uint16Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"UINT32",toArrayBuffer(){return new Uint32Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"UINT64",toArrayBuffer(){return new BigUint64Array(Array.isArray(this.value)?this.value:[BigInt(this.value)]).buffer}},{type:"FLOAT",toArrayBuffer(){return new Float32Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"DOUBLE",toArrayBuffer(){return new Float64Array(Array.isArray(this.value)?this.value:[this.value]).buffer}},{type:"CompressedObject",toArrayBuffer(){return d(t().compressToBase64(n(this.value)))}},{type:"VariableId",toDefinition(){return{type:"definition",value:[{type:"UINT32",value:"number"==typeof this.value?this.value:VariableRegister.GetVariableId(this.value)}]}}},{type:"Package",toDefinition(){this.value.unshift({type:"UINT32",value:p+m});const e=this;for(let t in this.outputVariables)e.value.push({type:"VariableId",value:this.outputVariables?.[t]});return delete this.outputUnits,delete this.outputVariables,this.inputVariables?.forEach((t=>{e.value.push({type:"VariableId",value:t??0})})),delete this.inputVariables,this.type="definition",this}},{type:"Group",toDefinition(){let e=[];const t=this,i=[...this.types.filter((e=>"Group"===e.type||"Package"===e.type))];return this.types=this.types.filter((e=>!("Group"===e.type||"Package"===e.type))),this.value.forEach((function i(n){if(function(e){for(var t in e)if(null!=e[t]&&Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}(n))return;let a=pe.call(t,n);for(fe in Array.isArray(a)||(a=[a]),a)if(null!=a[fe])if("Group"===a[fe].type){for(var s in a[fe].types){null==t.types.find((e=>e.type===a[fe].types[s].type))&&t.types.push(a[fe].types[s])}a[fe].value.forEach(i)}else"Package"===a[fe].type?e.push(a[fe]):"definition"!==e[e.length-1]?.type?e.push({type:"definition",value:[a[fe]]}):e[e.length-1].value.push(a[fe])})),this.types=[...this.types,...i],e.unshift({type:"UINT16",value:e.length}),e.unshift({type:"UINT32",value:p+v}),this.value=e,this.type="definition",he(this,this)}},{type:"Calculation_Static",toDefinition(){var e=le(this.value),t=re(e);return he({type:"definition",value:[{type:"UINT32",value:p+b},{type:"UINT8",value:t},{type:e,value:this.value}]},this)}},{type:"Calculation_2AxisTable",inputs:2,toDefinition(){this.inputVariables??=[void 0,void 0],this.XSelection&&(this.inputVariables[0]=this.XSelection),this.YSelection&&(this.inputVariables[1]=this.YSelection);const e=se(this.table.value),t=re(e);return he({type:"definition",value:[{type:"UINT32",value:p+f},{type:"UINT8",value:this.table.xAxis.length},{type:"UINT8",value:this.table.yAxis.length},{type:"UINT8",value:t},{type:"FLOAT",value:this.table.xAxis},{type:"FLOAT",value:this.table.yAxis},{type:e,value:this.table.value}]},this)}},{type:"Calculation_LookupTable",inputs:1,toDefinition(){this.parameterSelection&&(this.inputVariables=[this.parameterSelection]);const e=se(this.table.value),t=re(e);return he({type:"definition",value:[{type:"UINT32",value:p+g},{type:"UINT8",value:this.table.xAxis.length},{type:"UINT8",value:t},{type:"FLOAT",value:this.table.xAxis},{type:e,value:this.table.value}]},this)}},{type:"Calculation_Polynomial",inputs:1,toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:p+y},{type:"FLOAT",value:this.minValue},{type:"FLOAT",value:this.maxValue},{type:"UINT8",value:this.coeffecients.length},{type:"FLOAT",value:this.coeffecients}]},this)}},{type:"Calculation_UnitConversion",inputs:1,toDefinition(){const e=GetUnitFromName(this.inputVariables?.[0]?.unit),t=GetUnitFromName(this.outputVariables?.[0]?.unit),i=t.SIMultiplier/e.SIMultiplier,n=-e.SIOffset*i+t.SIOffset;return he({type:"definition",value:[{type:"UINT32",value:p+P},{type:"FLOAT",value:i},{type:"FLOAT",value:n}]},this)}},{type:"CalculationOrVariableSelection",toDefinition(){if(this.calculation)return{...this,..."object"==typeof this.calculation?this.calculation:{value:this.calculation},type:this.selection};if(!this.selection)return;const e=this.outputVariables?.[0]?.unit??this.outputUnits?.[0];if(null!=e&&this.selection.unit!=e&&!VariableRegister.GetVariableByReference({...this.selection,unit:e})){const t=VariableRegister.GetVariableByReference(this.selection);return{outputVariables:[{...t,unit:e}],inputVariables:[t],type:"Calculation_UnitConversion"}}VariableRegister.RegisterVariable({...this.selection,...this.outputVariables?.[0],...null!=this.selection?.name&&{id:this.selection.name},...null!=e&&{unit:e}})}},{type:"GenericCalculation",toDefinition(){return{...this,type:"CalculationOrVariableSelection",outputVariables:[{name:`${this.outputVariables?.[0]?.name??""}${this.name}`,unit:this.outputUnits?.[0],type:this.outputTypes?.[0]}]}}},{type:"Calculation_Add",inputs:2,toDefinition(){return de.call(this,x)}},{type:"Calculation_Subtract",inputs:2,toDefinition(){return de.call(this,E)}},{type:"Calculation_Multiply",inputs:2,toDefinition(){return de.call(this,U)}},{type:"Calculation_Divide",inputs:2,toDefinition(){return de.call(this,w)}},{type:"Calculation_And",inputs:2,toDefinition(){return de.call(this,V)}},{type:"Calculation_Or",inputs:2,toDefinition(){return de.call(this,A)}},{type:"Calculation_GreaterThan",inputs:2,toDefinition(){return de.call(this,I)}},{type:"Calculation_LessThan",inputs:2,toDefinition(){return de.call(this,T)}},{type:"Calculation_Equal",inputs:2,toDefinition(){return de.call(this,C)}},{type:"Calculation_GreaterThanOrEqual",inputs:2,toDefinition(){return de.call(this,S)}},{type:"Calculation_LessThanOrEqual",inputs:2,toDefinition(){return de.call(this,_)}},{type:"Calculation_Not",inputs:1,toDefinition(){return de.call(this,L,1)}},{type:"Calculation_Formula",toDefinition(){let e=["!","*","/","+","-",">=","<=",">","<","=","&","|"];let t=this.formula.replaceAll(" ","");for(let i in e){let n=e[i];t=t.split(n).join(",")}let i=t.split(","),n=this.formula.replaceAll(" ","");for(let e=0;e<i.length;e++){let t=n.indexOf(i[e]);n=n.substring(0,t)+","+n.substring(t+i[e].length)}n=n.split(","),t="";for(let e=0;e<i.length;e++)if(""!==t&&(t+=","),t+=i[e],i[e].match(/[^,][(]/)&&")"!==i[e][i[e].length-1])for(;++e<i.length&&(t+=n[e]+i[e],")"!==i[e][i[e].length-1]););if(t=t.split(","),t=t.map((e=>"("===e[0]?e.substring(1):e)),t=t.map((e=>{for(;")"===e[e.length-1]&&e.split(")").length>e.split("(").length;)e=e.substring(0,e.length-1);return e})),t=t.filter((e=>!e.match(/^[0-9]*$/))),t=t.filter((e=>0!==e.length)),0===t.length)return;const a=function(t,i){t=t.replaceAll(" ","");for(let e=0;e<i.length;e++)t=t.replaceAll(i[e],`param${e}`);let n,a=[],s=0;if(t.split(")").length!==t.split("(").length)return"Parenthesis start and end not matching";for(;t.split(")").flatMap((e=>e.split("("))).filter((t=>e.some((e=>t.indexOf(e)>-1)))).length>1;){s++;let i=t.split(")").filter((t=>e.some((e=>t.split("(").pop()?.indexOf(e)>-1))))[0].split("(").pop();a.push({resultInto:`$temp${s}`,parameters:[i]}),t=t.replace(`(${i})`,`$temp${s}`)}function l(t){for(let i in e){let n=e[i];t=t.split(n).join(",")}return t.split(",")}"("===t[0]&&")"===t[t.length-1]&&(t=t.substring(1,t.length-1)),a.push({resultInto:"return",parameters:[t]});for(let t in e){let i,n=e[t];for(;(i=a.findIndex((e=>e.parameters.find((e=>e.indexOf(n)>-1)))))>-1;){const e=a[i],t=e.parameters.findIndex((e=>e.indexOf(n)>-1)),r=e.parameters[t],o=l(r.split(n)[0]).pop(),u=l(r.split(n)[1])[0];e.parameters.length>1||l(e.parameters[0].replace(`${o}${n}${u}`,"temp")).length>1?(s++,e.parameters[t]=r.replace(`${o}${n}${u}`,`$temp${s}`),a.splice(i,0,{operator:n,resultInto:`$temp${s}`,parameters:[o,u]})):(a[i].operator=n,a[i].parameters=[o,u])}}for(;(n=a.findIndex((e=>"s"!==e.operator&&e.parameters.find((e=>e.match(/^[0-9]+$/))))))>-1;){const e=a[n],t=e.parameters.findIndex((e=>e.match(/^[0-9]+$/))),i=e.parameters[t];s++,a[n].parameters[t]=`$temp${s}`,a.splice(n,0,{operator:"s",resultInto:`$temp${s}`,parameters:[i]})}s=0;for(let e in a){e=parseInt(e);let t,i=a[e];0===i.resultInto.indexOf("$temp")&&(a.filter((e=>e.parameters.findIndex((e=>e===i.resultInto))>-1)).length<2&&(t=a[e+1]?.parameters?.findIndex((e=>e===i.resultInto)))>-1?a[e+1].parameters[t]=i.resultInto="temp":(s++,a.filter((e=>e.parameters.findIndex((e=>e===i.resultInto))>-1)).forEach((e=>{for(let t in e.parameters)e.parameters[t]===i.resultInto&&(e.parameters[t]=`temp${s}`)})),i.resultInto=`temp${s}`))}for(let e=0;e<a.length;e++){a[e].parameters;for(let t=0;t<a[e].parameters.length;t++)0===a[e].parameters[t].indexOf("param")&&(a[e].parameters[t]=i[parseInt(a[e].parameters[t].substring(5))])}return a}(this.formula,t);if(0==a.length||1==a.length&&null==a[0].operator)return{...this.parameterValues[t[0]],type:"CalculationOrVariableSelection",outputVariables:this.outputVariables};var s={type:"Group",value:[]};let l=this.outputVariables?.[0]?.name;t.forEach((e=>{let t=0===e.indexOf("temp")?e:`${l}_${e}`;t=t.substring(0,-1!==t.indexOf("(")?t.indexOf("("):t.length),s.value.push({...this.parameterValues[e],type:"CalculationOrVariableSelection",outputVariables:[{name:t}]})}));for(let e in a){let t=a[e],i={outputVariables:"return"===t.resultInto?this.outputVariables:[{name:t.resultInto}]};const n=e=>{if("self"===e)return this.outputVariables[0];const t=0===e.indexOf("temp")?e:`${l}_${e}`;return{name:t.substring(0,-1!==t.indexOf("(")?t.indexOf("("):t.length)}};if("s"===t.operator)i.type="Calculation_Static",i.value=t.parameters[0];else if("!"===t.operator)i.type="Calculation_Not",i.inputVariables=[n(t.parameters[1])];else switch(i.inputVariables=t.parameters.map(n),t.operator){case"*":i.type="Calculation_Multiply";break;case"/":i.type="Calculation_Divide";break;case"+":i.type="Calculation_Add";break;case"-":i.type="Calculation_Subtract";break;case">=":i.type="Calculation_GreaterThanOrEqual";break;case"<=":i.type="Calculation_LessThanOrEqual";break;case">":i.type="Calculation_GreaterThan";break;case"<":i.type="Calculation_LessThan";break;case"=":i.type="Calculation_Equal";break;case"&":i.type="Calculation_And";break;case"|":i.type="Calculation_Or"}s.value.push(i)}return s}},{type:"CAN_ReadData",toDefinition(){return{type:"definition",value:[{type:"UINT32",value:O+W},{type:"UINT32",value:this.canBus<<29|this.canID},{type:"UINT32",value:p+m},{type:"UINT32",value:O+Y},{type:"UINT8",value:this.parseData.length},...this.parseData.map((e=>{const t=e.bitLength<2;return{type:"definition",value:[{type:"FLOAT",value:e.multiplier},{type:"FLOAT",value:e.adder},{type:"UINT8",value:e.bitLocation},{type:"UINT8",value:e.bitLength},{type:"UINT8",value:0|t}]}})),...this.parseData.map((e=>{const t=e.bitLength<2;return{type:"VariableId",value:{name:`${this.outputVariables?.[0].name}.${e.name}`,type:t?"bool":void 0,unit:t?void 0:e.unit}}}))]}}},{type:"CAN_WriteData",toDefinition(){return{type:"definition",value:[{type:"UINT32",value:O+j},{type:"FLOAT",value:1/this.interval},{type:"Group",value:[{type:"definition",value:[{type:"UINT32",value:p+m},{type:"UINT32",value:O+z},{type:"UINT64",value:0},{type:"UINT8",value:this.packData.length},...this.packData.map((e=>{const t=e.bitLength<2;return{type:"definition",value:[{type:"FLOAT",value:e.multiplier},{type:"FLOAT",value:e.adder},{type:"UINT8",value:e.bitLocation},{type:"UINT8",value:e.bitLength},{type:"UINT8",value:t}]}})),{type:"VariableId",value:{name:"temp"}},...this.packData.map((e=>({type:"VariableId",value:e.variable})))]},{type:"definition",value:[{type:"UINT32",value:p+m},{type:"UINT32",value:O+G},{type:"UINT32",value:this.canBus<<29|this.canID},{type:"VariableId",value:{name:"temp"}}]}]}]}}},{type:"Input_Analog",outputUnits:["V"],toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:O+M},{type:"UINT16",value:this.pin}]},this)}},{type:"Input_AnalogPolynomial",toDefinition(){const e={name:this.outputVariables[0].name,unit:"V"};return{type:"Group",value:[{...this.analogInput,type:"Input_Analog",outputVariables:[e]},{...this.polynomial,type:"Calculation_Polynomial",outputVariables:this.outputVariables,inputVariables:[e]}]}}},{type:"Input_Digital",toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:O+N},{type:"UINT16",value:this.pin},{type:"BOOL",value:this.inverted}]},this)}},{type:"Input_DigitalRecord",toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:O+R},{type:"UINT16",value:this.pin},{type:"BOOL",value:this.inverted},{type:"UINT16",value:this.length}]},this)}},{type:"Input_DutyCycle",outputUnits:["%"],toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:O+D},{type:"UINT16",value:this.pin},{type:"UINT16",value:this.minFrequency}]},this)}},{type:"Input_Frequency",outputUnits:["Hz"],toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:O+k},{type:"UINT16",value:this.pin},{type:"UINT16",value:this.minFrequency}]},this)}},{type:"Input_PulseWidth",outputUnits:["s"],toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:O+F},{type:"UINT16",value:this.pin},{type:"UINT16",value:this.minFrequency}]},this)}},{type:"Output_Digital",toDefinition(){return he({type:"definition",value:[{type:"UINT32",value:O+B},{type:"UINT16",value:this.pin},{type:"UINT8",value:this.inverted|(this.highZ?2:0)}]},this)}},{type:"Reluctor_GM24x",toDefinition(){return ce.call(this,{type:"definition",value:[{type:"UINT32",value:X+H}]})}},{type:"Reluctor_Universal1x",toDefinition(){let e={type:"definition",value:[{type:"UINT32",value:X+q},{type:"UINT8",value:this.mode}]};return 0!==this.mode&&1!==this.mode||e.value.push({type:"FLOAT",value:this.risingPosition}),0!==this.mode&&1!==this.mode||e.value.push({type:"FLOAT",value:this.fallingPosition}),ce.call(this,e)}},{type:"Reluctor_UniversalMissingTeeth",toDefinition(){return ce.call(this,{type:"definition",value:[{type:"UINT32",value:X+$},{type:"FLOAT",value:this.firstToothPosition},{type:"FLOAT",value:this.toothWidth},{type:"UINT8",value:this.numberOfTeeth},{type:"UINT8",value:this.numberOfTeethMissing}]})}},{type:"TPS_Linear",toDefinition(){return this.type="Input_AnalogPolynomial",this}},{type:"MAP_GM1Bar",toDefinition(){return this.type="Input_AnalogPolynomial",this}},{type:"MAP_GM2Bar",toDefinition(){return this.type="Input_AnalogPolynomial",this}},{type:"MAP_GM3Bar",toDefinition(){return this.type="Input_AnalogPolynomial",this}},{type:"Input",toDefinition(){if(null==this.translationConfig)return;const e={name:`Inputs.${this.name}`,unit:this.translationConfig.outputUnits?.[0],type:this.translationConfig.outputTypes?.[0]};if(0===(this.translationConfig.inputTypes?.length??0)&&0===(this.translationConfig.inputUnits?.length??0))return{...this.translationConfig,type:"CalculationOrVariableSelection",outputVariables:[e]};const t={name:`Inputs.${this.name}`,unit:this.rawConfig.outputUnits?.[0],type:this.rawConfig.outputTypes?.[0]};return this.rawConfig={...this.rawConfig,type:"CalculationOrVariableSelection",outputVariables:[t]},{type:"Group",value:[{...this.rawConfig,type:"CalculationOrVariableSelection"},{...this.translationConfig,type:"CalculationOrVariableSelection",outputVariables:[e],inputVariables:[t]}]}}},{type:"Inputs",toDefinition(){return{type:"ConfigList",value:this.value,itemType:"Input"}}},{type:"CylinderAirmass_AlphaN",outputUnits:["g"],toDefinition(){return{...this.Airmass,type:"CalculationOrVariableSelection",outputVariables:this.outputVariables}}},{type:"CylinderAirmass_SpeedDensity",outputUnits:["g"],toDefinition(){return this.inputVariables=[{name:"EngineParameters.Cylinder Air Temperature"},{name:"EngineParameters.Manifold Absolute Pressure"},{name:"EngineParameters.Volumetric Efficiency"}],he({type:"definition",value:[{type:"UINT32",value:Z+J},{type:"FLOAT",value:this.CylinderVolume}]},this)}},{type:"InjectorPulseWidth_DeadTime",outputUnits:["s"],toDefinition(){return{type:"Group",value:[{...this.FlowRate,type:"CalculationOrVariableSelection",outputVariables:[{name:"FuelParameters.Injector Flow Rate"}]},{...this.DeadTime,type:"CalculationOrVariableSelection",outputVariables:[{name:"FuelParameters.Injector Dead Time"}]},{type:"Calculation_Static",value:2,outputVariables:[{name:"SquirtsPerCycle"}]},{type:"Calculation_Subtract",outputVariables:[{name:"SquirtsPerCycle"}],inputVariables:[{name:"SquirtsPerCycle"},{name:"EngineSequentialId"}]},he({type:"definition",value:[{type:"UINT32",value:Z+ne},{type:"FLOAT",value:this.MinInjectorFuelMass}]},{...this,inputVariables:[{name:"SquirtsPerCycle"},{name:"FuelParameters.Cylinder Fuel Mass"},{name:"FuelParameters.Injector Flow Rate"},{name:"FuelParameters.Injector Dead Time"}]})]}}},{type:"ConfigList",toDefinition(){return{type:"Group",value:this.value.map((e=>{const t=Object.keys(e),i=this.staticItems?.find((e=>e.name===t[0]));return 1===t.length&&void 0!==i?Array.isArray(e[i.name])||"object"!=typeof e[i.name]?{value:e[i.name],type:i.type}:{...e[i.name],type:i.type}:{...e,type:this.itemType}})),staticItems:void 0,itemType:void 0}}},{type:"Fuel",toDefinition(){return{types:[{type:"Fuel_InjectorOutput",toDefinition(){return{type:"definition",value:[{type:"Package",value:[{type:"UINT32",value:Z+ie},{type:"FLOAT",value:this.TDC},{...this,type:"CalculationOrVariableSelection"}],outputVariables:[{name:"temp"},{name:"temp"}],inputVariables:[{name:"EnginePositionId"},{name:"FuelParameters.Injector Enable"},{name:"FuelParameters.Injector Pulse Width"},{name:"FuelParameters.Injector End Position"}]}]}}},{type:"Fuel_AFR",toDefinition(){return{type:"Group",value:[{...this,type:"Fuel_GenericCalculation"},{type:"Calculation_Divide",outputVariables:[{name:"FuelParameters.Cylinder Fuel Mass"}],inputVariables:[{name:"EngineParameters.Cylinder Air Mass"},{name:"FuelParameters.Air Fuel Ratio"}]}]}}},{type:"Fuel_InjectorProperties",toDefinition(){return{type:"Group",value:[{...this.InjectorEnable,type:"CalculationOrVariableSelection",outputVariables:[{name:"FuelParameters.Injector Enable"}]},{...this.InjectorPulseWidth,type:"CalculationOrVariableSelection",outputVariables:[{name:"FuelParameters.Injector Pulse Width"}]},{...this.InjectorEndPosition,type:"CalculationOrVariableSelection",outputVariables:[{name:"FuelParameters.Injector End Position"}]}]}}},{type:"Fuel_InjectorOutputs",toDefinition(){return{type:"Group",value:this.value.map((e=>({...e,type:"Fuel_InjectorOutput"})))}}},{type:"Fuel_GenericCalculation",toDefinition(){return{...this,type:"GenericCalculation",outputVariables:[{name:"FuelParameters."}]}}}],type:"ConfigList",value:this.value,itemType:"Fuel_GenericCalculation",staticItems:[{name:"AFR",type:"Fuel_AFR"},{name:"InjectorProperties",type:"Fuel_InjectorProperties"},{name:"InjectorOutputs",type:"Fuel_InjectorOutputs"}]}}},{type:"Ignition",toDefinition(){return{types:[{type:"Ignition_IgnitionOutput",toDefinition(){return{type:"definition",value:[{type:"Package",value:[{type:"UINT32",value:Z+te},{type:"FLOAT",value:this.TDC},{...this,type:"CalculationOrVariableSelection"}],outputVariables:[{name:"temp"},{name:"temp"}],inputVariables:[{name:"EnginePositionId"},{name:"IgnitionParameters.Ignition Enable"},{name:"IgnitionParameters.Ignition Dwell"},{name:"IgnitionParameters.Ignition Advance"},{name:"IgnitionParameters.Ignition Dwell Deviation"}]}]}}},{type:"Ignition_IgnitionProperties",toDefinition(){return{type:"Group",value:[{...this.IgnitionEnable,type:"CalculationOrVariableSelection",outputVariables:[{name:"IgnitionParameters.Ignition Enable"}]},{...this.IgnitionAdvance,type:"CalculationOrVariableSelection",outputVariables:[{name:"IgnitionParameters.Ignition Advance"}]},{...this.IgnitionDwell,type:"CalculationOrVariableSelection",outputVariables:[{name:"IgnitionParameters.Ignition Dwell"}]},{...this.IgnitionDwellDeviation,type:"CalculationOrVariableSelection",outputVariables:[{name:"IgnitionParameters.Ignition Dwell Deviation"}]}]}}},{type:"Ignition_IgnitionOutputs",toDefinition(){return{type:"Group",value:this.value.map((e=>({...e,type:"Ignition_IgnitionOutput"})))}}},{type:"Ignition_GenericCalculation",toDefinition(){return{...this,type:"GenericCalculation",outputVariables:[{name:"IgnitionParameters."}]}}}],type:"ConfigList",value:this.value,itemType:"Ignition_GenericCalculation",staticItems:[{name:"IgnitionProperties",type:"Ignition_IgnitionProperties"},{name:"IgnitionOutputs",type:"Ignition_IgnitionOutputs"}]}}},{type:"Engine",toDefinition(){return{types:[{type:"Engine_EngineSensors",toDefinition(){let e={type:"Group",value:[{...this.CrankPosition,type:"CalculationOrVariableSelection",outputVariables:[{name:"EngineParameters.Crank Position"}]},{...this.CamPosition,type:"CalculationOrVariableSelection",outputVariables:[{name:"EngineParameters.Cam Position"}]},{type:"Package",value:[{type:"UINT32",value:Z+(this.CrankPriority?K:Q)}],outputVariables:[{name:"EnginePositionId"}],inputVariables:[{name:"EngineParameters.Crank Position"},{name:"EngineParameters.Cam Position"}]},{type:"Package",value:[{type:"UINT32",value:Z+ee}],outputVariables:[{name:"EngineParameters.Engine Speed"},{name:"EngineSequentialId"},{name:"EngineSyncedId"}],inputVariables:[{name:"EnginePositionId"}]}]};return void 0!==this.ManifoldAbsolutePressure&&e.value.push({...this.ManifoldAbsolutePressure,type:"CalculationOrVariableSelection",outputVariables:[{name:"EngineParameters.Manifold Absolute Pressure"}]}),void 0!==this.ThrottlePosition&&e.value.push({...this.ThrottlePosition,type:"CalculationOrVariableSelection",outputVariables:[{name:"EngineParameters.Throttle Position"}]}),void 0!==this.CylinderAirTemperature&&e.value.push({...this.CylinderAirTemperature,type:"CalculationOrVariableSelection",outputVariables:[{name:"EngineParameters.Cylinder Air Temperature"}]}),e}},{type:"Engine_EngineCalculations",toDefinition(){let e={type:"Group",value:[]};return void 0!==this.VolumetricEfficiency&&e.value.push({...this.VolumetricEfficiency,type:"CalculationOrVariableSelection",outputVariables:[{name:"EngineParameters.Volumetric Efficiency"}]}),e.value.push({...this.CylinderAirmass,type:"CalculationOrVariableSelection",outputVariables:[{name:"EngineParameters.Cylinder Air Mass"}]}),e}},{type:"Engine_GenericCalculation",toDefinition(){return{...this,type:"GenericCalculation",outputVariables:[{name:"EngineParameters."}]}}}],type:"ConfigList",value:this.value,itemType:"Engine_GenericCalculation",staticItems:[{name:"EngineSensors",type:"Engine_EngineSensors"},{name:"EngineCalculations",type:"Engine_EngineCalculations"}]}}},{type:"CAN",toDefinition(){return{types:[{type:"CAN_GenericCalculation",toDefinition(){return{...this,type:"GenericCalculation",outputVariables:[{name:"CANParameters."}]}}}],type:"ConfigList",value:this.value,itemType:"CAN_GenericCalculation"}}},{type:"Top",toDefinition(){return{type:"definition",value:[{type:"UINT32",value:0},{type:"Group",value:[{type:"Inputs",value:this.Inputs},{type:"CAN",value:this.CAN},{type:"Engine",value:this.Engine}]},{type:"Group",value:[]},{type:"Group",value:[{type:"Calculation_Static",value:!1,outputVariables:[{name:"temp"}]},{type:"Calculation_Or",inputVariables:[{name:"EngineSyncedId"},{name:"temp"}]}]},{type:"Group",value:[{type:"Fuel",value:this.Fuel},{type:"Ignition",value:this.Ignition}]}]}},toArrayBuffer(){let e=c({type:"definition",value:[this],types:ve});e=new Uint32Array([e.byteLength]).buffer.concatArray(e),e=e.concatArray(new Uint32Array([e.crc32()]).buffer);let i=d(t().compressToBase64(n(VariableRegister.GetVariableReferenceList())));return i=new Uint32Array([i.byteLength]).buffer.concatArray(i),i=i.concatArray(new Uint32Array([i.crc32()]).buffer),e.concatArray(i)}}];for(var fe in oe){var ge=ve.find((e=>e.type==ue[fe].type));ge&&(ge.align=ue[fe].align)}class UITemplate extends HTMLSpanElement{constructor(e){super(),e&&this.Setup(e)}Setup(e){e??={};const t=e.saveValue,i=e.value;delete e.saveValue,delete e.value,Object.assign(this,e),null!=t&&(this.saveValue=t),null!=i&&(this.value=i);let n=Object.entries(this);const a=this.template??this.constructor.template;this.innerHTML=a,this.querySelectorAll("[data-element]").forEach((e=>{let t=n.find((([t,i])=>e.dataset.element===t));if(!t)return;let[i,a]=t;e.replaceWith(a)}))}get saveValue(){let e={};if(Object.entries(this).forEach((([t,i])=>{null!=i?.saveValue&&(e[t]=i.saveValue)})),0!==Object.keys(e).length)return e}set saveValue(e){null!=e&&Object.entries(this).forEach((([t,i])=>{null!=e[t]&&"object"==typeof i&&Object.keys(i).indexOf("saveValue")&&(i.saveValue=e[t])}))}get value(){let e={};if(Object.entries(this).forEach((([t,i])=>{null!=i?.value&&(e[t]=i.value)})),0!==Object.keys(e).length)return e}set value(e){null!=e&&Object.entries(this).forEach((([t,i])=>{null!=e[t]&&"object"==typeof i&&(i.value=e[t])}))}}customElements.define("ui-template",UITemplate,{extends:"span"});class UINumber extends HTMLInputElement{#e;get value(){return this.#e}set value(e){if(e=parseFloat(e),parseFloat(this.value)===e)return;const t=this.value;super.value=isNaN(e)?"":e,this.#e=e,t===this.value||isNaN(t)&&isNaN(this.value)||super.dispatchEvent(new Event("change",{bubbles:!0}))}get min(){return super.min}set min(e){super.min=e,null!=e&&null!=this.value&&this.value<parseFloat(e)&&(this.value=e)}get max(){return super.max}set max(e){super.max=e,null!=e&&null!=this.value&&this.value>parseFloat(e)&&(this.value=e)}get saveValue(){return this.value}set saveValue(e){this.value=e}constructor(e){super(),this.type="number",this.class="ui number",Object.assign(this,e),this.addEventListener("change",(()=>{this.#e=parseFloat(super.value);const e=parseFloat(super.min),t=parseFloat(super.max);!isNaN(this.#e)&&!isNaN(e)&&this.#e<e&&(this.#e=e),!isNaN(this.#e)&&!isNaN(t)&&this.#e>t&&(this.#e=t)}))}}function ye(e,t=6){return e=parseFloat(e),isNaN(e)?"&nbsp;":Math.abs(e)<1?parseFloat(e.toFixed(t-1)):parseFloat(e.toPrecision(t))}function be(e,t=1){let i=18e18,n=-9e18;for(let t=0;t<e.length;t++){let a=e[t];a<i&&(i=a),a>n&&(n=a)}return t&&n===i&&(n=i+t),[i,n]}function xe(e,t){if(e===t)return!0;if(typeof e!=typeof t)return!1;if("number"==typeof e&&isNaN(e)&&isNaN(t))return!0;var i=Ee(e);if(i!=Ee(t))return!1;if("[object Boolean]"==i||"[object String]"==i||"[object Number]"==i)return e.valueOf()==t.valueOf();if("[object RegExp]"==i||"[object Date]"==i||"[object Error]"==i)return e.toString()==t.toString();if("object"==typeof e||"function"==typeof e){if("[object Function]"==i&&e.toString()!=t.toString())return!1;var n=Object.keys(e),a=Object.keys(t);return n.length==a.length&&(!!n.every((function(e){return t.hasOwnProperty(e)}))&&n.every((function(i){return xe(e[i],t[i])})))}return!1}function Ee(e){return Object.prototype.toString.call(e)}customElements.define("ui-number",UINumber,{extends:"input"});class UISelection extends HTMLDivElement{static ParseValue(e,t){switch(e){case"number":return parseFloat(t);case"boolean":if("number"==typeof t)return 0!==t;if("boolean"==typeof t)return t;if("string"==typeof t)return"true"===t||"True"===t||"1"===t;if("object"==typeof t)return!!t;case"string":if("number"==typeof t||"boolean"==typeof t)return`${t}`;if("string"==typeof t)return t;if("object"==typeof t)return JSON.stringify(t);case"object":if("number"==typeof t||"boolean"==typeof t||"object"==typeof t)return t;if("string"==typeof t)return JSON.parse(t)}}#t=!1;get selectDisabled(){return this.#t}set selectDisabled(e){this.#t=e,this.selectHidden||Ue(this.#i,{name:this.selectName,disabled:this.selectDisabled,value:this.selectValue})}#n="select";get selectName(){return this.#n}set selectName(e){this.#n!==e&&(this.#n=e,null==this.selectedOption&&(this.selectedElement.textContent=this.selectName),this.selectHidden||Ue(this.#i,{name:this.selectName,disabled:this.selectDisabled,value:this.selectValue}))}#a=void 0;get selectValue(){return this.#a}set selectValue(e){this.#a!==e&&(this.#a=e,null==this.selectedOption&&(this.selectedElement.value=UISelection.ParseValue("string",e),this.selectedElement.type=typeof e),this.selectHidden||Ue(this.#i,{name:this.selectName,disabled:this.selectDisabled,value:this.selectValue}))}#i;#s=!1;get selectHidden(){return this.#s}set selectHidden(e){this.#s!==e&&(this.#s=e,this.selectHidden?null!=this.contextMenuElement.children[0]&&this.contextMenuElement.removeChild(this.contextMenuElement.children[0]):Ue(this.#i,{name:this.selectName,disabled:this.selectDisabled,value:this.selectValue}))}collapse=20;#l(){const e=this.selectedElement;this.contextMenuElement.querySelectorAll(".selectoption, .selectgroup").length>=this.collapse&&this.collapse>0?this.contextMenuElement.classList.add("collapsible"):this.contextMenuElement.classList.remove("collapsible");let t=!1;[...this.contextMenuElement.children].forEach((i=>{let n=!1;[...i.children].forEach((i=>{null==e.value||i.value!==e.value?i.classList.remove("selected"):(i.classList.add("selected"),t=!0,n=!0)})),n?i.classList.remove("collapsed"):i.classList.add("collapsed"),i.value!==e.value?i.classList.remove("selected"):(i.classList.add("selected"),t=!0)}));const i=this.selectedOption?.selectedName??this.selectedOption?.name??this.selectName;e.textContent!==i&&(e.textContent=i),t||this.#i.classList.add("selected"),this.options.map((e=>e.options?.length??1)).reduce(((e,t)=>e+t),0)<(this.selectHidden?2:1)?e.classList.add("single"):e.classList.remove("single")}#r=[];get options(){return this.#r}set options(e){if(null==e&&(e=[]),xe(this.#r,e))return;this.#r=e;const t=e.length+(this.selectHidden?0:1);for(;t<this.contextMenuElement.children.length;)this.contextMenuElement.removeChild(this.contextMenuElement.children[t]);this.selectHidden||(this.#i=this.contextMenuElement.children[0],null==this.#i&&(this.#i=this.contextMenuElement.appendChild(document.createElement("div"))),Ue(this.#i,{name:this.selectName,disabled:this.selectDisabled,value:this.selectValue})),e.forEach(((e,t)=>{let i=this.contextMenuElement.children[t+(this.selectHidden?0:1)];null==i&&(i=this.contextMenuElement.appendChild(document.createElement("div"))),Ue(i,e)})),this.#l()}get selectedOption(){const e=this.selectedElement.value;let t=this.options.find((t=>UISelection.ParseValue("string",t.value)===e||t.options?.findIndex((t=>UISelection.ParseValue("string",t.value)===e))>-1));return t?.group&&(t=t.options.find((t=>UISelection.ParseValue("string",t.value)===e))),t}set selectedOption(e){this.value=e.value}get value(){return UISelection.ParseValue(this.selectedElement.type,this.selectedElement.value)}set value(e){if(this.selectHidden&&null==this.value&&1===this.options.length&&(e=this.options[0].value),xe(this.value,e))return;const t=this.selectedElement;t.type=typeof e,t.value=UISelection.ParseValue("string",e),this.#l(),this.dispatchEvent(new Event("change",{bubbles:!0}))}get saveValue(){return this.value}set saveValue(e){this.value=e}constructor(e){super(),this.class="ui select",this.selectedElement=this.appendChild(document.createElement("div")),this.selectedElement.class="ui selected",this.contextMenuElement=document.createElement("div"),this.contextMenuElement.class="ui context-menu",this.#i=document.createElement("div"),this.contextMenuElement.prepend(this.#i),Ue(this.#i,{name:this.selectName,disabled:this.selectDisabled,value:this.selectValue}),Object.assign(this,e);let t=!1,i=!1;this.selectedElement.addEventListener("click",(()=>{if(this.#l(),t)return;if(this.selectHidden&&this.options.length<2)return;if(this.selectedElement.classList.contains("single"))return;const e=()=>{if(i)return i=!1;t&&(this.removeChild(this.contextMenuElement),document.removeEventListener("click",e),t=!1)};document.addEventListener("click",e),window.setTimeout((()=>{this.append(this.contextMenuElement),t=!0}),1)})),this.contextMenuElement.addEventListener("click",(e=>{if(!e.target.classList.contains("selectdisabled"))return e.target.classList.contains("selectgroup")&&this.contextMenuElement.classList.contains("collapsible")?(e.target.parentElement.classList.contains("collapsed")?e.target.parentElement.classList.remove("collapsed"):e.target.parentElement.classList.add("collapsed"),void(i=!0)):void(e.target.classList.contains("selectoption")&&(this.value=UISelection.ParseValue(e.target.type,e.target.value)))})),this.#l()}}function Ue(e,t){if(e.removeAttribute("class"),t.group){delete e.type,delete e.value;let i=document.createElement("div");e.replaceChildren(i),i.classList.add("selectgroup"),i.textContent=t.group,t.options.forEach((t=>{Ue(e.appendChild(document.createElement("div")),t)}))}else e.classList.add("selectoption"),t.disabled&&e.classList.add("selectdisabled"),e.type=typeof t.value,e.value=UISelection.ParseValue("string",t.value),e.textContent=t.name+(t.info?` ${t.info}`:"")}customElements.define("ui-selection",UISelection,{extends:"div"});let we=[{name:"",SIMultiplier:1,SIOffset:0}],Ve=[{name:"%",SIMultiplier:100,SIOffset:0},{name:"[0.0-1.0]",SIMultiplier:1,SIOffset:0}],Ae=Ve.map((e=>({name:e.name+"/s",SIMultiplier:e.SIMultiplier,SIOffset:e.SIOffset})));let Ie={"No Unit":we,Voltage:[{name:"V",SIMultiplier:1,SIOffset:0},{name:"mV",SIMultiplier:1e3,SIOffset:0}],Temperature:[{name:"°C",SIMultiplier:1,SIOffset:0},{name:"°F",SIMultiplier:1.8,SIOffset:32}],Pressure:[{name:"Bar",SIMultiplier:1,SIOffset:0},{name:"kPa",SIMultiplier:100,SIOffset:0}],Mass:[{name:"g",SIMultiplier:1,SIOffset:0},{name:"mg",SIMultiplier:1e3,SIOffset:0},{name:"kg",SIMultiplier:.001,SIOffset:0}],MassFlow:[{name:"g/s",SIMultiplier:1,SIOffset:0},{name:"g/min",SIMultiplier:60,SIOffset:0}],Volume:[{name:"L",SIMultiplier:1,SIOffset:0},{name:"mL",SIMultiplier:1e3,SIOffset:0}],Speed:[{name:"KPH",SIMultiplier:1,SIOffset:0},{name:"MPH",SIMultiplier:1.61,SIOffset:0}],Time:[{name:"s",SIMultiplier:1,SIOffset:0},{name:"ms",SIMultiplier:1e3,SIOffset:0},{name:"us",SIMultiplier:1e6,SIOffset:0},{name:"ns",SIMultiplier:1e9,SIOffset:0}],Frequency:[{name:"Hz",SIMultiplier:1,SIOffset:0},{name:"KHz",SIMultiplier:.001,SIOffset:0},{name:"MHz",SIMultiplier:1e-6,SIOffset:0}],Percentage:Ve,PercentageAcceleration:Ae,Lambda:[{name:"λ",SIMultiplier:1,SIOffset:0}],Angle:[{name:"°",SIMultiplier:1,SIOffset:0}],AngularSpeed:[{name:"RPM",SIMultiplier:1,SIOffset:0}],Ratio:[{name:":1",SIMultiplier:1,SIOffset:0}],Resistance:[{name:"Ω",SIMultiplier:1,SIOffset:0},{name:"kΩ",SIMultiplier:.001,SIOffset:0}]};function Te(e){return null==e?void 0:Ie[Ce(e)]?.find((t=>t.name===e))??Ie[Ce(e)]?.find((t=>t.name===`°${e}`))??we[0]}function Ce(e){if(Array.isArray(e))return e.map((e=>Ce(e)));for(let t in Ie)for(let i in Ie[t])if(e===Ie[t][i].name)return t;for(let t in Ie)for(let i in Ie[t])if(`°${e}`===Ie[t][i].name)return t;return"None"}function Se(e,t,i){let n=Ce(t);t=Te(t);let a=Ce(i);return i=Te(i),null==e||null==t||null==i||n!==a||t===i?e:Array.isArray(e)?e.map((e=>null==e?e:(e-t.SIOffset)/t.SIMultiplier*i.SIMultiplier+i.SIOffset)):(e-t.SIOffset)/t.SIMultiplier*i.SIMultiplier+i.SIOffset}class UIUnit extends UISelection{static allMeasurementOptions=Object.keys(Ie).map((e=>0===Ie[e].length||1===Ie[e].length&&""===Ie[e][0].name?{name:e,value:""}:1===Ie[e].length?{selectedName:Ie[e][0].name,name:`${e} [${Ie[e][0].name}]`,value:Ie[e][0].name}:{group:e,options:Ie[e]?.map((e=>({selectedName:e.name,name:`${e.name}`,value:e.name})))}));_hidden=!1;get hidden(){return this._hidden}set hidden(e){this._hidden=e,e||0===this.options.length?super.hidden=!0:super.hidden=!1}get value(){return super.value}set value(e){super.value=e}_measurement;get measurement(){return Array.isArray(this._measurement)?this._measurement.find((e=>e===Ce(this.value))):this._measurement}set measurement(e){xe(this._measurement,e)||(e?(this._measurement=e,Ce(this.default)!==e&&(this.default=function(e){return Array.isArray(e)&&(e=e[0]),Ie[e]?.[0]?.name}(e)),Array.isArray(e)||(e=[e]),e.length>1?this.options=UIUnit.allMeasurementOptions.filter((t=>-1!==e.indexOf(t.group)||e.some((e=>0===t.name?.indexOf(e))))).map((e=>e.group?{group:e.group,options:e.options.map((e=>({...e,selectedName:void 0})))}:{...e,selectedName:""===e.value?e.selectedName:e.value})):this.options=Ie[e[0]]?.map((e=>({name:e.name,value:e.name}))),null==this.selectedOption&&(this.value=this.default)):(this.options=UIUnit.allMeasurementOptions,this.default=""),null!=this.value&&""!==this.value&&null!==this.value||(this.value=this.default),0===this.options.length?super.hidden=!0:this.hidden||(super.hidden=!1))}get saveValue(){if(this.value!==this.default)return super.saveValue}set saveValue(e){null!=e&&""!==e&&(super.saveValue=e)}constructor(e){e??={},e.options??=UIUnit.allMeasurementOptions,super(e),(e?.measurement||e?.value)&&(this.default=this.value),this.class="ui unit",this.selectHidden=!0}}customElements.define("ui-unit",UIUnit,{extends:"div"});class UINumberWithUnit extends UITemplate{static template='<div data-element="displayValueElement"></div><div data-element="displayUnitElement"></div>';get measurement(){return this.displayUnitElement.measurement}set measurement(e){this.displayUnitElement.measurement=e}get displayUnit(){return this.displayUnitElement.value}set displayUnit(e){this.displayUnitElement.value=e??this._valueUnit}get displayValue(){return this.displayValueElement.value}set displayValue(e){this.displayValueElement.value=e}_valueUnit;get valueUnit(){return this._valueUnit??this.displayUnit}set valueUnit(e){if(this._valueUnit===e)return;let t=Se(this.value,this._valueUnit,e);this._valueUnit=e,this.measurement=Ce(e),this.displayUnit??=e,this.value=t}#e;get value(){return this.#e}set value(e){this.#e!==e&&(this.#e=e,this.UpdateDisplayValue())}set class(e){this.displayValueElement.class=e}#o;get min(){return this.#o}set min(e){this.#o!==e&&(this.#o=e,this.UpdateDisplayValue())}#u;get max(){return this.#u}set max(e){this.#u!==e&&(this.#u=e,this.UpdateDisplayValue())}#h;get step(){return this.#h}set step(e){this.#h!==e&&(this.#h=e,this.UpdateDisplayValue())}constructor(e){super(),this.displayUnitElement=new UIUnit({measurement:e?.measurement,value:e?.displayUnit??e?.valueUnit});let t=this.displayUnit;this.displayUnitElement.addEventListener("change",(()=>{null!=this.displayValue&&(this.displayValue=Se(this.displayValue,t,this.displayUnit)),t=this.displayUnit})),this.displayValueElement=new UINumber,this.displayValueElement.addEventListener("change",(()=>{null!=this.displayValue&&(this.#e=Se(this.displayValue,this.displayUnit,this.valueUnit))})),this.Setup(e)}get saveValue(){return{displayUnit:this.displayUnitElement.saveValue,value:this.value}}set saveValue(e){"object"==typeof e?(null!=e.displayUnit&&(this.displayUnitElement.saveValue=e.displayUnit),this.value=e.value??e.value):this.value=e}UpdateDisplayValue(){const e=this.displayUnit,t=this.valueUnit,i=i=>null!=i&&e?Se(i,t,e):i;this.displayValue=i(this.value)??this.displayValue,this.displayValueElement.min=i(this.min)??this.displayValueElement.min,this.displayValueElement.max=i(this.max)??this.displayValueElement.max,this.displayValueElement.step=i(this.step)??this.displayValueElement.step}}customElements.define("ui-numberwithunit",UINumberWithUnit,{extends:"span"});class UIDisplayNumberWithUnit extends UINumberWithUnit{static template='<div data-element="displayElement"></div><div data-element="displayUnitElement"></div>';ZeroesToAdd=1e7;displayElement=document.createElement("div");constructor(e){super(),this.displayUnitElement.addEventListener("change",(()=>{this.ZeroesToAdd=1e7,this.UpdateDisplayValue()})),this.displayElement.style.display=this.displayUnitElement.style.display="inline-block",this.ZeroesToAdd=1e7,this.Setup(e)}get saveValue(){return this.displayUnitElement.saveValue}set saveValue(e){this.displayUnitElement.saveValue=e}#e;get value(){return this.#e}set value(e){if(this.#e===e)return;this.#e=e;const t=this.displayUnit,i=this.valueUnit;let n=(e=>null!=e&&t?Se(e,i,t):e)(e);if(null==n)return;n=`${parseFloat(parseFloat(parseFloat(n).toFixed(5)).toPrecision(6))}`;const a=n.indexOf(".");let s=Math.max(0,6-(n.length-a));-1===a&&(s=6),s<this.ZeroesToAdd&&(this.ZeroesToAdd=s),s-=this.ZeroesToAdd,s>0&&a<0&&(n+=".");for(let e=0;e<s;e++)n+="0";this.displayElement.textContent=n}}customElements.define("ui-displaynumberwithunit",UIDisplayNumberWithUnit,{extends:"span"});var _e=0;function Le(){return"GUID"+_e++}async function Pe(e,t=1e3){let i=0;for(;e()&&i++<Math.max(1,t/Math.max(t/10,10));)await new Promise((e=>setTimeout(e,Math.max(t/10,10))));return!e()}class Serial{#r;#d;#c;#p=new ArrayBuffer;#m;get options(){return this.#r}set options(e){this.#r=e,this.#c=void 0}get filters(){return this.#d}set filters(e){this.#d=e,this.#c=void 0}constructor(e,t){this.options=e??{baudRate:115200},this.filters=t}async#v(){if(null!=this.#c&&this.#c.readable&&this.#c.writable)return;if(!("serial"in navigator))throw"WebSerial not supported. please open in a supported browser";let e=await navigator.serial.getPorts({filter:this.filters});1!==e.length?this.#c=await navigator.serial.requestPort({filter:this.filters}):this.#c=e[0],await this.#c.open(this.options)}async read(e,t=1e3){async function i(e,t){if(!await Pe((function(){return e.locked})))return{value:void 0,done:!1};const i=new TransformStream;e.pipeThrough(i,{preventClose:!0,preventCancel:!0});const n=i.readable.getReader();let a;const s=setTimeout((()=>{a={value:void 0,done:!1},n.cancel()}),t),l=await n.read();return clearTimeout(s),n.cancel(),a??l}await this.#v();let n=0;for(;null==e||this.#p.byteLength<e;){const{value:a,done:s}=await i(this.#c.readable,t);if(s)throw"Serial closed";if(!a&&n++>10)break;if(a&&(n=0,this.#p=this.#p.concatArray(a)),null==e)break}let a=null==e?this.#p:this.#p.slice(0,e);return this.#p=null==e?new ArrayBuffer:this.#p.slice(e),a}async write(e,t=1e3){await this.#v();const i=this.#c.writable;if(!await Pe((function(){return i.locked})))return;const n=i.getWriter();await n.write(e),n.releaseLock()}async command(e,t,i=1e3){const n=this;if(!await Pe((function(){return n.#m})))throw"Serial locked";let a;this.#m=!0;try{await this.write(e,i),a=this.read(t,i)}catch(e){throw e}finally{this.#m=!1}return a??new ArrayBuffer}}class EFIGenieLog{variableMetadata=void 0;logBytes=new ArrayBuffer;loggedVariableValues=[];get saveValue(){var e=base64ToArrayBuffer(lzjs.compressToBase64(stringifyObject(this.variableMetadata.GetVariableReferenceList())));return new Uint32Array([e.byteLength]).buffer.concatArray(e).concatArray(LogBytes)}set saveValue(e){const t=new Uint32Array(e.slice(0,4))[0];this.variableMetadata=new VariableRegistry(JSON.parse(lzjs.decompressFromBase64(arrayBufferToBase64(e.slice(4,t+4))))),this.logBytes=e.slice(t+4)}}let Oe=new class EFIGenieSerial extends EFIGenieLog{#f=new Serial(void 0,[{usbVendorId:1155,usbProductId:22336}]);variableMetadata=void 0;variablesToPoll=[];liveUpdateEvents=[];previousVariableIds=[];async pollVariableMetadata(){if(null!=this.variableMetadata)return;let e=new ArrayBuffer,t=1;for(let i=0;i<Math.ceil(t);i++){const n=new Uint8Array([109]).buffer.concatArray(new Uint32Array([i]).buffer);let a=await this.#f.command(n,64);if(64!==a.byteLength)throw"Incorrect number of bytes returned when requesting metadata";if(0===i){if(t=new Uint32Array(a.slice(0,4))[0]/64,t>1e3)throw"Incorrect length returned when requesting metadata";a=a.slice(4)}e=e.concatArray(a)}e=e.slice(0,64*t);const i=lzjs.decompressFromBase64(arrayBufferToBase64(e));this.variableMetadata=new VariableRegistry(JSON.parse(i)),registerVariables()}async pollVariables(){await this.pollVariableMetadata();var e=[];const t=this.variableMetadata.GetVariableId({name:"CurrentTick",type:"tick"});for(var i in t&&e.push(t),this.variablesToPoll){const t=this.variableMetadata.GetVariableId(this.variablesToPoll[i]);null!=t&&-1===e.indexOf(t)&&e.push(t)}if(e.length<1)return;if(e.length!=this.previousVariableIds?.length)this.logBytes=new ArrayBuffer,this.loggedVariableValues=[],this.previousVariableIds=e;else for(var n=0;n<e.length;n++)if(e[n]!==this.previousVariableIds[n]){this.logBytes=new ArrayBuffer,this.loggedVariableValues=[],this.previousVariableIds=e;break}function a(e){switch(e){case 0:return 0;case 1:case 5:case 11:return 1;case 2:case 6:return 2;case 3:case 7:case 9:return 4;case 4:case 8:case 10:return 8}}function s(e){switch(new Uint8Array(e)[0]){case 0:return;case 1:return new Uint8Array(e.slice(1))[0];case 2:return new Uint16Array(e.slice(1))[0];case 3:return new Uint32Array(e.slice(1))[0];case 5:return new Int8Array(e.slice(1))[0];case 6:return new Int16Array(e.slice(1))[0];case 7:return new Int32Array(e.slice(1))[0];case 9:return new Float32Array(e.slice(1))[0];case 10:return new Float64Array(e.slice(1))[0];case 11:return 1===new Uint8Array(e.slice(1))[0]}}let l=new ArrayBuffer;for(let t=0;t<e.length;t++)l=l.concatArray(new Uint8Array([103]).buffer.concatArray(new Uint32Array([e[t]]).buffer));await this.#f.write(l);let r=new ArrayBuffer,o={};for(let t=0;t<e.length;t++){let i=await this.#f.read(1);if(1!==i.byteLength)return;const n=a(new Uint8Array(i)[0]);if(i=i.concatArray(await this.#f.read(n)),i.byteLength!==n+1)return;o[e[t]]=s(i),r=r.concatArray(i)}this.logBytes=this.logBytes.concatArray(r),this.loggedVariableValues.push(o);const u=this;!async function(){u.#g(u)}()}#g=function(e){};async#y(e,t){const i=await this.#f.command(e,1);if(1!==i.byteLength)throw`Incorrect number of bytes returned when ${t}`;if(6!==new Uint8Array(i)[0])throw`Ack not returned when ${t}`}async stopExecution(){await this.#y(new Uint8Array([113]).buffer,"stopping execution")}async startExecution(){await this.#y(new Uint8Array([115]).buffer,"starting execution")}async writeToAddress(e,t,i=52,n=1e3){let a=t.byteLength,s=0;for(;a>0;){let n=Math.min(i,a);await this.#y(new Uint8Array([119]).buffer.concatArray(new Uint32Array([e+s,n]).buffer).concatArray(t.slice(s,s+n)),"writing data"),a-=n,s+=n}}async getConfigAddress(){const e=await this.#f.command(new Uint8Array([99]).buffer,4);if(4!==e.byteLength)throw"Incorrect number of bytes returned when requesting config address";return new Uint32Array(e)[0]}async burnBin(e){let t=this.connected;await this.disconnect(),await this.stopExecution();const i=await this.getConfigAddress();await this.writeToAddress(i,e),await this.startExecution(),t&&this.connect()}connect(){if(this.polling)return;this.polling=!0,this.connected=!0;const e=this;this.pollVariables().then((function(){e.polling=!1,e.connected&&e.connect()})).catch((function(t){alert(t),e.variableMetadata=void 0,e.polling=!1,e.connected=!1}))}async disconnect(){this.connected=!1;const e=this;await Pe((function(){return e.polling||e.connected}))}};class UIDisplayLiveUpdate extends UIDisplayNumberWithUnit{GUID=Le();get superHidden(){return super.hidden}set superHidden(e){super.hidden=e}get hidden(){return this._stickyHidden}set hidden(e){this._stickyHidden=e,e&&(super.hidden=e)}RegisterVariables(e){let t=VariableRegister.GetVariableByReference(e);t??=e,(t?.unit||-1!==t?.type?.split("|")?.indexOf("float"))&&(this.measurement=Ce(t.unit),this.valueUnit=t.unit,-1===Oe.variablesToPoll.indexOf(e)&&Oe.variablesToPoll.push(e),Oe.liveUpdateEvents[this.GUID]=(t,i)=>{if(e){const n=t?.GetVariableId(e);null!=i?.[n]?(this.superHidden=!1,this.value=i[n],this.superHidden||(this.superHidden&&(this.superHidden=!1),this.TimeoutHandle&&window.clearTimeout(this.TimeoutHandle),this.TimeoutHandle=window.setTimeout((()=>{this.value=void 0,this.superHidden=!0}),5e3))):this.superHidden=!0}})}constructor(e){super(e??{}),this.superHidden=!0,this.displayElement.class="livevalue"}}customElements.define("ui-displayliveupdate",UIDisplayLiveUpdate,{extends:"span"});class UIButton extends HTMLSpanElement{get value(){}set value(e){}get saveValue(){}set saveValue(e){}get label(){return this.textContent}set label(e){this.textContent=e}constructor(e){super(),this.class="ui button",Object.assign(this,e)}}customElements.define("ui-button",UIButton,{extends:"span"});class UIDialog extends HTMLSpanElement{get value(){}set value(e){}get saveValue(){}set saveValue(e){}content=document.createElement("div");#b=new UIButton;#x=document.createElement("dialog");#E=document.createElement("div");#U=document.createElement("div");#w=document.createElement("div");get title(){return this.#U.textContent}set title(e){this.#U.textContent=e}get buttonLabel(){return this.#b.label}set buttonLabel(e){this.#b.label=e}get title(){return this.#U.innerText}set title(e){this.#U.innerText=e}show(){this.#x.show(),0==this.#x.style.right&&(this.#x.style.top="0px",this.#x.style.left="0px")}close(){this.#x.close(),delete this.#x.style.top,delete this.#x.style.left}constructor(e){super(),this.title="Dialog",this.buttonLabel,this.append(this.#b),this.#x.class="ui dialog",this.#x.style.bottom="0px",document.getElementsByTagName("body")[0].append(this.#x),this.#E.class="titlebar",this.#x.append(this.#E),this.content.class="content",this.#x.append(this.content),this.#U.class="title",this.#E.append(this.#U),this.#w.class="close",this.#E.append(this.#w),Object.assign(this,e),this.#b.addEventListener("click",(()=>{this.show()})),this.#w.addEventListener("click",(()=>{this.close()})),this.#E.addEventListener("mousedown",(e=>{this.#x.style.left=this.#x.offsetLeft,this.#x.style.right="auto",this.#x.style.top=this.#x.offsetTop,this.#x.style.bottom="auto";let t=e.pageX,i=e.pageY,n=parseFloat(this.#x.style.left),a=parseFloat(this.#x.style.top);const s=e=>{let s=e.pageX-t,l=e.pageY-i;this.#x.style.left=n+s,this.#x.style.top=a+l},l=()=>{document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",l)}))}}customElements.define("ui-dialog",UIDialog,{extends:"span"});class UIParameterWithUnit extends UITemplate{static template='<div data-element="parameterSelection"></div><div data-element="unitSelection"></div>';get selectName(){return this.parameterSelection.selectName}set selectName(e){this.parameterSelection.selectName=e}parameterSelection=new UISelection;unitSelection=new UIUnit;constructor(e){super(),this.style.display="inline-flex",this.style.alignItems="center",this.parameterSelection.addEventListener("change",(()=>{const e=this.units;this.unitSelection.measurement=Ce(e),this.unitSelection.hidden=void 0===e||this.unitHidden})),this.Setup(e)}#V=!1;get unitHidden(){return this.#V}set unitHidden(e){this.#V=e,void 0!==this.units?this.unitSelection.hidden=e:this.unitSelection.hidden=!0}get selectHidden(){return this.parameterSelection.selectHidden}set selectHidden(e){this.parameterSelection.selectHidden=e}get selectDisabled(){return this.parameterSelection.selectDisabled}set selectDisabled(e){this.parameterSelection.selectDisabled=e}get selectValue(){return this.parameterSelection.selectValue}set selectValue(e){this.parameterSelection.selectValue=e}get selectedOption(){return"object"==typeof this.parameterSelection.selectedOption&&void 0!==this.optionUnits[this.parameterSelection.selectedOption.name]?{...this.parameterSelection.selectedOption,unit:this.unitSelection.selectedOption}:this.parameterSelection.selectedOption}set selectedOption(e){"object"==typeof e?(void 0!==this.optionUnits[e.name]&&(this.unitSelection.selectedOption=e.unit),delete e.unit,this.parameterSelection.selectedOption=e):this.parameterSelection.selectedOption=e}get value(){return"object"==typeof this.parameterSelection.value&&void 0!==this.optionUnits[this.parameterSelection.value.name]?{...this.parameterSelection.value,unit:this.unit}:this.parameterSelection.value}set value(e){"object"==typeof e?(e={...e},void 0!==this.optionUnits[e.name]&&(this.unitSelection.value=e.unit),delete e.unit,this.parameterSelection.value=e):this.parameterSelection.value=e}get saveValue(){return"object"==typeof this.parameterSelection.saveValue&&void 0!==this.optionUnits[this.parameterSelection.saveValue.name]?{...this.parameterSelection.saveValue,unit:this.unit}:this.parameterSelection.saveValue}set saveValue(e){"object"==typeof e?(e={...e},void 0!==this.optionUnits[e.name]&&(this.unitSelection.saveValue=e.unit),delete e.unit,this.parameterSelection.saveValue=e):this.parameterSelection.saveValue=e}get units(){return null!=this.parameterSelection.value?.name?this.optionUnits[this.parameterSelection.value.name]:void 0}get unit(){return this.units.find((e=>Ce(e)===Ce(this.unitSelection.value)))}get displayUnit(){return this.unitSelection.value}set displayUnit(e){this.unitSelection.value=e}optionUnits={};get options(){const e=t=>{let i=[];for(const n in t){let a={...t[n]};if(a.group)a.options=e(a.options),i.push(a);else if("object"==typeof a.value&&void 0!==this.optionUnits[a.value.name])for(const e in this.optionUnits[a.value.name]){a={...t[n]},a.value={...a.value};const s=this.optionUnits[a.value.name][e];a.value.unit=s,a.info=`[${Ce(s)}]`,i.push(a)}else i.push(a)}return i};return e(this.parameterSelection.options)}set options(e){const t=e=>{let i=[];for(const n in e){let a=e[n];a.group?i.push({...a,options:t(a.options)}):"object"==typeof a.value&&void 0!==a.value.unit?(this.optionUnits[a.value.name]??=[],this.optionUnits[a.value.name].push(a.value.unit),i.filter((e=>e?.value?.name===a.value.name)).length<1&&i.push({...a,value:{...a.value,unit:void 0},info:void 0})):i.push(a)}return i};this.optionUnits={},this.parameterSelection.options=t(e);const i=this.units;this.unitSelection.measurement=Ce(i),this.unitSelection.hidden=void 0===i||this.unitHidden}}customElements.define("ui-parameterwithunit",UIParameterWithUnit,{extends:"span"});class UITextArea extends HTMLTextAreaElement{#e="";get value(){return this.#e}set value(e){this.#e!==e&&(super.value=this.#e=e,super.dispatchEvent(new Event("change",{bubbles:!0})))}get saveValue(){return this.value}set saveValue(e){this.value=e}constructor(e){super(),this.class="ui text",this.addEventListener("change",(()=>{this.#e=super.value})),Object.assign(this,e)}}customElements.define("ui-textarea",UITextArea,{extends:"textarea"});class UILoggedVariable extends HTMLTableRowElement{#A;get variable(){return this.#A}set variable(e){this.#A=e,this.children[0].textContent=null==e?.name?"--":e.name.substring(e.name.lastIndexOf(".")+1)??"--",this.children[2].textContent=e?.unit??"--",this.children[3].textContent=e?.refreshRate?-1==e.refreshRate?"Max":`${e.refreshRate}Hz`:"--"}get unit(){return this.#A?.unit}set unit(e){const t=this.variable;null!=t&&(this.variable={...t,unit:e})}get refreshRate(){return this.#A?.refreshRate}set refreshRate(e){const t=this.variable;null!=t&&(this.variable={...t,refreshRate:e})}#e;get value(){return this.#e}set value(e){this.#e=e,this.children[1].textContent=e??"--"}constructor(){super(),this.appendChild(document.createElement("td")).class="loggedVariableName",this.append(document.createElement("td")),this.append(document.createElement("td")),this.append(document.createElement("td")),this.appendChild(document.createElement("td")).class="actions",this.value=void 0}}customElements.define("ui-loggedvariable",UILoggedVariable,{extends:"tr"});class Dashboard extends UITemplate{static thisDashboard;static template='<div style="display: flex;">\n    <div style="display: flex;">\n        <div class="loggedVariables">\n            <div>Logged Variables<div data-element="collapseSidebar"></div></div>\n            <div data-element="loggedVariables"></div>\n        </div>\n        <div data-element="expandSidebar"></div>\n    </div>\n    <div style="display:inline-block;">\n        <div data-element="gauges"></div>\n    </div>\n</div>';gauges=document.createElement("div");loggedVariables=document.createElement("table");loggedVariablesUnitSelection=new UIUnit;loggedVariablesRefreshSelection=new UISelection({class:"refreshRateSelection",selectHidden:!0,options:[{name:"0.5Hz",value:.5},{name:"1Hz",value:1},{name:"10Hz",value:10},{name:"30Hz",value:30},{name:"60Hz",value:60},{name:"100Hz",value:100},{name:"Max",value:-1}]});loggedVariableVariableSelection=new UISelection({selectHidden:!0});get options(){return this.loggedVariableVariableSelection.options}set options(e){this.loggedVariableVariableSelection.options=e}loggedVariableVariableSelectionDialog=new UIDialog({title:"Variables"});expandSidebar=new UIButton({label:"Logged Variables",class:"loggedVariablesExpand"});get saveValue(){let e=super.saveValue;return delete e.loggedVariablesUnitSelection,delete e.loggedVariablesRefreshSelection,delete e.loggedVariableVariableSelection,e}set saveValue(e){super.saveValue=e}get value(){let e=super.value;return null==e||(delete e.loggedVariablesUnitSelection,delete e.loggedVariablesRefreshSelection,delete e.loggedVariableVariableSelection),e}set value(e){super.value=e}constructor(e){super(),Dashboard.thisDashboard=this,this.loggedVariablesUnitSelection.classList.remove("unit"),this.loggedVariablesUnitSelection.classList.add("logged-variable-selection"),this.loggedVariablesRefreshSelection.classList.add("logged-variable-selection"),this.loggedVariableVariableSelectionDialog.content.appendChild(this.loggedVariableVariableSelection.contextMenuElement).class="openned",this.loggedVariableVariableSelection.addEventListener("change",(()=>{this.loggedVariables.saveValue=[...this.loggedVariables.saveValue,{...this.loggedVariableVariableSelection.value,refreshRate:60}],this.RegisterVariables()})),this.RegisterVariables(),this.gauges.class="gauges",Object.defineProperty(this.gauges,"saveValue",{get:function(){return[...this.children].map((e=>e.saveValue))},set:function(e){for(;this.children.length>e.length;)this.removeChild(this.lastChild);for(let t=0;t<e.length;t++)this.children[t]||this.append(new UIGauge),this.children[t].saveValue=e[t]}}),this.gauges.saveValue=new Array(8);const t=this.loggedVariables.appendChild(document.createElement("tr")),i=t.appendChild(document.createElement("td"));i.textContent="Name",i.class="loggedVariableName",t.appendChild(document.createElement("td")).textContent="Value",t.appendChild(document.createElement("td")).textContent="Unit",t.appendChild(document.createElement("td")).textContent="Refresh";const n=t.appendChild(document.createElement("td"));let a;n.class="actions",n.replaceChildren(a=document.createElement("div")),a.class="controladd",a.addEventListener("click",(e=>{this.loggedVariableVariableSelectionDialog.show()}));const s=this;this.loggedVariables.tabIndex=0,this.loggedVariables.addEventListener("keydown",(e=>{if("Delete"===e.key){const e=this.loggedVariables.querySelector(".selected");if(!e)return;this.loggedVariables.removeChild(e),this.RegisterVariables()}})),Object.defineProperty(this.loggedVariables,"saveValue",{get:function(){return this.variables},set:function(e){this.variables=e}}),Object.defineProperty(this.loggedVariables,"variables",{get:function(){return[...this.children].map((e=>e.variable)).slice(1)},set:function(e){for(;this.children.length>e.length+1;)this.removeChild(this.lastChild);for(let t=0;t<e.length;t++){if(!this.children[t+1]){const e=this.appendChild(new UILoggedVariable);let t;e.children[4].replaceChildren(t=document.createElement("div")),t.class="controldelete",t.addEventListener("click",(t=>{this.removeChild(e),s.RegisterVariables()})),e.addEventListener("click",(t=>{[...this.children].forEach((e=>{e.classList.remove("selected"),e.unit=e.unit,e.refreshRate=e.refreshRate})),e.class="selected",null!=e.variable&&(s.loggedVariablesRefreshSelection.value=e.refreshRate,s.loggedVariablesUnitSelection.value=e.unit,s.loggedVariablesUnitSelection.measurement=Ce(e.unit),e.children[3].replaceChildren(s.loggedVariablesRefreshSelection),e.children[2].replaceChildren(s.loggedVariablesUnitSelection),t.target===e.children[2]&&s.loggedVariablesUnitSelection.children[0].dispatchEvent(new Event("click")),t.target===e.children[3]&&s.loggedVariablesRefreshSelection.children[0].dispatchEvent(new Event("click")))}))}this.children[t+1].variable=e[t]}}}),this.loggedVariablesRefreshSelection.addEventListener("change",(()=>{const e=this.loggedVariables.querySelector(".selected");e&&(e.refreshRate=this.loggedVariablesRefreshSelection.value)})),this.loggedVariablesUnitSelection.addEventListener("change",(()=>{const e=this.loggedVariables.querySelector(".selected");e&&(e.unit=this.loggedVariablesUnitSelection.value)})),this.Setup(e)}Setup(e){super.Setup(e),this.sidebar=this.querySelector(".loggedVariables"),this.expandSidebar.addEventListener("click",(()=>{this.sidebar.hidden?(this.sidebar.hidden=!1,this.expandSidebar.label=" - Logged Variables"):(this.sidebar.hidden=!0,this.expandSidebar.label=" + Logged Variables")})),this.sidebar.hidden=!0,this.expandSidebar.label=" + Logged Variables"}RegisterVariables(){function e(e,t){return!(e?.name!=t?.name||null!=e?.type&&null!=t?.type&&e?.type!==t?.type||null!=e?.unit&&null!=t?.unit&&Ce(e?.unit)!==Ce(t?.unit))}let t=VariableRegister.GetSelections(void 0,h(void 0,["float|bool"])),i=Oe.variableMetadata?.GetSelections(void 0,h(void 0,["float|bool"]));for(const e in i){const n=i[e];if(n.group){const e=t.find((e=>e.group===n.group));if(null==e)t.push(n);else for(const t in n.options){const i=n.options[t];null==e.options.find((e=>objectTester(e.value,i.value)))&&e.options.push(i)}}else null==t.find((e=>objectTester(e.value,n.value)))&&t.push(n)}t=t.map((t=>(-1!==[...this.loggedVariables.children].findIndex((i=>e(t?.value,i?.variable)))&&(t.disabled=!0),t))),t=t.map((t=>(t.options=t.options?.map((t=>(-1!==[...this.loggedVariables.children].findIndex((i=>e(t?.value,i?.variable)))&&(t.disabled=!0),t))),t))),this.options=t,[...this.loggedVariables.children].forEach((i=>{null!=i.variable&&-1===t.findIndex((t=>t.group&&t.options?-1!==t.options.findIndex((t=>e(t?.value,i.variable))):e(t?.value,i.variable)))?i.hidden=!0:i.hidden=!1})),[...this.gauges.children].forEach((e=>e.RegisterVariables()))}}customElements.define("top-dashboard",Dashboard,{extends:"span"});var Me=i(890);class UIGauge extends UITemplate{static template='<canvas data-type="radial-gauge"\n    data-width="350"\n    data-height="350"\n    data-minor-ticks="2"\n    data-stroke-ticks="true"\n    data-color-plate="rgba(0,0,0,0)",\n    data-color-major-ticks="#eee"\n    data-color-minor-ticks="#ddd"\n    data-color-numbers="#eee"\n    data-border-shadow-width="0"\n    data-borders="false"\n    data-needle-type="arrow"\n    data-needle-width="2"\n    data-needle-circle-size="7"\n    data-needle-circle-outer="true"\n    data-needle-circle-inner="false"\n    data-animation-duration="50"\n    data-animation-rule="linear"\n></canvas>';Setup(e){super.Setup(e);const t=this.querySelector("canvas");t.addEventListener("click",(()=>{this.configDialog.show()})),Me.BaseGauge.fromElement(t),this.gauge=document.gauges.find((e=>e.canvas.element===t)),this.#I()}get displayUnit(){return this.configTemplate.variable.displayUnit}set displayUnit(e){this.configTemplate.variable.displayUnit=e}#e;get value(){return this.#e}set value(e){this.#e!==e&&(this.#e=e,this.gauge.value=Se(e,this.valueUnit,this.displayUnit))}get saveValue(){let e=this.configTemplate.saveValue;return e.gaugeTemplate===this.constructor.template&&delete e.gaugeTemplate,e}set saveValue(e){this.configTemplate.saveValue=e}get min(){return this.configTemplate.min.value}set min(e){this.configTemplate.min.value=e}get max(){return this.configTemplate.max.value}set max(e){this.configTemplate.max.value=e}get step(){return this.configTemplate.step.value}set step(e){this.configTemplate.step.value=e}get highRedline(){return this.configTemplate.highRedline.value}set highRedline(e){this.configTemplate.highRedline.value=e}get lowRedline(){return this.configTemplate.lowRedline.value}set lowRedline(e){this.configTemplate.lowRedline.value=e}#I(){let e={};e.minValue=parseFloat(Se(this.min,this.valueUnit,this.displayUnit)?.toFixed(2)??0),e.maxValue=parseFloat(Se(this.max,this.valueUnit,this.displayUnit)?.toFixed(2)??100);let t=e.minValue;e.majorTicks=[t];let i=Se(this.step,this.valueUnit,this.displayUnit)??10;const n=e.maxValue-e.minValue;for((n<0||n/Math.max(n/30,i)>25)&&(i=n/25);(t+=i)<e.maxValue-i/2;)e.majorTicks.push(parseFloat(t.toFixed(2)));e.majorTicks.push(parseFloat(t.toFixed(2))),e.highlights=[];const a=Se(this.highRedline,this.valueUnit,this.displayUnit);null!=a&&e.highlights.push({from:a,to:e.maxValue,color:"rgba(200, 50, 50, .75)"});const s=Se(this.lowRedline,this.valueUnit,this.displayUnit);null!=s&&e.highlights.push({from:e.minValue,to:s,color:"rgba(200, 50, 50, .75)"}),e.title=this.configTemplate.variable.value?.name,e.title=e.title?.substring(e.title.indexOf(".")+1),e.units=this.configTemplate.variable.displayUnit,this.gauge.update(e),this.gauge.value=Se(this.value,this.valueUnit,this.displayUnit),this.gauge.draw()}constructor(e){let t,i,n,a;super(),this.style.position="relative",this.configTemplate=new UITemplate({template:'<span style="display: block;"><label>Variable:</label><div data-element="variable"></div><span>\n                        <span style="display: block;"><label>Min:</label><div data-element="min"></div><span>\n                        <span style="display: block;"><label>Low:</label><div data-element="lowRedline"></div><span>\n                        <span style="display: block;"><label>Step:</label><div data-element="step"></div><span>\n                        <span style="display: block;"><label>High:</label><div data-element="highRedline"></div><span>\n                        <span style="display: block;"><label>Max:</label><div data-element="max"></div><span>\n                        <span style="display: block;"><label>Gauge Template</label><div data-element="editGauge"></div><div data-element="gaugeTemplate"></div><span>',variable:new UIParameterWithUnit({options:VariableRegister.GetSelections(void 0,h(void 0,["float"]))}),min:new UINumberWithUnit,max:new UINumberWithUnit,step:new UINumberWithUnit({min:1e-7}),highRedline:new UINumberWithUnit,lowRedline:new UINumberWithUnit,editGauge:new UIButton({label:"Edit"}),gaugeTemplate:new UITextArea({value:this.constructor.template,class:"gaugeTemplate",hidden:!0})}),this.configTemplate.editGauge.addEventListener("click",(e=>{"Edit"===this.configTemplate.editGauge.label?(this.configTemplate.editGauge.label="Hide",this.configTemplate.gaugeTemplate.hidden=!1):(this.configTemplate.editGauge.label="Edit",this.configTemplate.gaugeTemplate.hidden=!0)})),this.configTemplate.gaugeTemplate.addEventListener("change",(e=>{this.template=this.configTemplate.gaugeTemplate.value,this.Setup(),e.preventDefault()})),this.configTemplate.variable.addEventListener("change",(()=>{if(t!=this.displayUnit){const e=t;t=this.displayUnit,e===this.configTemplate.min.displayUnit&&(this.configTemplate.min.displayUnit=this.displayUnit),e===this.configTemplate.max.displayUnit&&(this.configTemplate.max.displayUnit=this.displayUnit),e===this.configTemplate.step.displayUnit&&(this.configTemplate.step.displayUnit=this.displayUnit),e===this.configTemplate.highRedline.displayUnit&&(this.configTemplate.highRedline.displayUnit=this.displayUnit),e===this.configTemplate.lowRedline.displayUnit&&(this.configTemplate.lowRedline.displayUnit=this.displayUnit)}if(this.RegisterVariables(),i!=this.valueUnit){i=this.valueUnit,this.configTemplate.min.valueUnit=this.valueUnit,this.configTemplate.max.valueUnit=this.valueUnit,this.configTemplate.step.valueUnit=this.valueUnit,this.configTemplate.highRedline.valueUnit=this.valueUnit,this.configTemplate.lowRedline.valueUnit=this.valueUnit;let e=function(e){switch(e){case"%":return{min:0,max:100,step:10,lowRedline:void 0,highRedline:void 0};case"[0.0-1.0]":return{min:0,max:1,step:.1,lowRedline:void 0,highRedline:void 0};case"RPM":return{min:0,max:8e3,step:1e3,lowRedline:void 0,highRedline:6500};case"Bar":return{min:.2,max:3,step:.2,lowRedline:.25,highRedline:void 0};case"kPa":return{min:20,max:300,step:20,lowRedline:25,highRedline:void 0};case"V":return{min:0,max:5,step:1,lowRedline:void 0,highRedline:void 0};case"mV":return{min:0,max:5e3,step:1e3,lowRedline:void 0,highRedline:void 0}}}(this.valueUnit);this.min=e?.min??this.min,this.max=e?.max??this.max,this.step=e?.step??this.step,this.highRedline=e?.highRedline??e?.max??this.highRedline,this.lowRedline=e?.lowRedline??e?.min??this.lowRedline}})),this.configTemplate.addEventListener("change",(()=>{if(this.RegisterVariables(),this.configTemplate.min.step=this.configTemplate.max.step=this.configTemplate.highRedline.step=this.configTemplate.lowRedline.step=this.step,n!=this.min){const e=n;n=this.min,this.configTemplate.lowRedline.min=this.configTemplate.highRedline.min=this.min,this.lowRedline===e&&(this.lowRedline=this.min)}if(a!=this.min){const e=a;a=this.max,this.configTemplate.lowRedline.max=this.configTemplate.highRedline.max=this.max,this.highRedline===e&&(this.highRedline=this.max)}this.configTemplate.step.min=(this.max-this.min)/25,this.#I()})),this.configDialog=new UIDialog({title:"Edit Gauge"}),this.configDialog.content.append(this.configTemplate),this.Setup(e)}GUID=Le();RegisterVariables(){let e=Dashboard.thisDashboard.options.map((e=>e.group&&e.options?{...e,options:e.options.map((e=>({...e,disabled:!e.disabled})))}:{...e,disabled:!e.disabled}));this.configTemplate.variable.options=e;const t=this.configTemplate.variable.value,i=this.communication?.variableMetadata?.GetVariableByReference(t)??VariableRegister.GetVariableByReference(t);(t?.unit||-1!==t?.type?.split("|")?.indexOf("float"))&&(this.valueUnit=i?.unit,-1===Oe.variablesToPoll.indexOf(t)&&Oe.variablesToPoll.push(t),Oe.liveUpdateEvents[this.GUID]=(e,i)=>{if(t){const n=e?.GetVariableId(t);null!=i?.[n]&&(this.value=i[n])}})}}customElements.define("ui-gauge",UIGauge,{extends:"span"});class UIPinOverlay extends HTMLDivElement{get pinSelectElements(){function e(t){if(t.classList.contains("pinselectname")){const e=t.value;return e||t.textContent}const i=t.children;for(var n=0;n<i?.length;n++){const t=e(i[n]);if(t)return t}}function t(i){return i?e(i)??t(i.parentElement):void 0}let i=[...document.querySelectorAll(".pinselect")];return i.forEach((e=>{e.name=t(e),e.updateOptions?.(this.pinOut),e.addEventListener("change",(()=>{this.update()}))})),i}#T;get pinOut(){return this.#T}set pinOut(e){if(!e)return;this.#T=e;let t=910/(e.OverlayWidth+300);for(this.overlayImage.style.width=`${e.OverlayWidth}px`,this.style.width="910px",this.style.transform=`scale(${t})`,this.overlayImage.src=e.Overlay;e.Pins.length<this.pinElements.children.length;)this.pinElements.removeChild(this.pinElements.lastChild);for(let t=0;t<e.Pins.length;t++){let i=this.pinElements.children[t];i||(i=this.pinElements.appendChild(new UISelection),i.firstChild.style.minWidth="100px",i.style.width="150px",i.style.position="absolute",Object.defineProperty(i,"pinSelectElements",{set:function(e){this._pinSelectElements=e;let t,i=[];for(let n=0;n<e.length;n++){let a={name:e[n].name,value:n,disabled:-1===this.supportedModes.split(" ").indexOf(e[n].pinType)};e[n].value==this.pin&&(t?(a.Class="pinconflict","string"!=typeof t&&(t.Class="pinconflict"),t="conflict"):t=a),i.push(a)}this.options=i,t?"conflict"===t?(this.classList.add("pinconflict"),this.value=void 0):(this.classList.remove("pinconflict"),this.value=t.value):this.value=void 0}}),i.addEventListener("change",(()=>{null!=i.value&&(i._pinSelectElements[i.value].value=i.pin)}))),i.pin=e.Pins[t].value,i.supportedModes=e.Pins[t].supportedModes,i.style.top=e.Pins[t].overlayY-e.OverlayElementHeight/2+"px",i.style.left=("left"===e.Pins[t].align?e.Pins[t].overlayX+150:e.OverlayWidth-e.Pins[t].overlayX)+"px"}this.update()}update(){const e=this.pinSelectElements;[...this.pinElements.children].forEach((t=>t.pinSelectElements=e))}pinElements=document.createElement("div");overlayImage=document.createElement("img");constructor(){super(),this.class="pinoverlay",this.append(this.overlayImage),this.append(this.pinElements)}}customElements.define("ui-pinoverlay",UIPinOverlay,{extends:"div"});class UIPinSelection extends UISelection{constructor(e){super(e),this.selectDisabled=e.selectDisabled??!0,this.selectValue=e.selectValue??65535,this.classList.add("pinselect")}wtf=1;updateOptions(e){var t=[],i=[];if(e){for(var n=0;n<e.Pins.length;n++){const a=this.value===e.Pins[n].value;-1===e.Pins[n].supportedModes.split(" ").indexOf(this.pinType)?i.push({name:e.Pins[n].name,value:e.Pins[n].value,class:a?"incompatible":void 0,disabled:!0}):t.push({name:e.Pins[n].name,value:e.Pins[n].value})}t=t.concat(i),this.options=t}}}customElements.define("ui-pinselection",UIPinSelection,{extends:"div"});customElements.define("ui-plot",class UIPlot extends UITemplate{constructor(e){super(),this.Setup(e)}GUID=Le();RegisterVariables(){let e=VariableRegister.GetSelections(void 0,h(void 0,["float"])),t=Oe.variableMetadata?.GetSelections(void 0,h(void 0,["float"]));for(const i in t){const n=t[i];if(n.group){const t=e.find((e=>e.group===n.group));if(null==t)e.push(n);else for(const e in n.options){const i=n.options[e];null==t.options.find((e=>xe(e.value,i.value)))&&t.options.push(i)}}else null==e.find((e=>xe(e.value,n.value)))&&e.push(n)}this.variable.options=e;const i=this.variable.value,n=this.communication?.variableMetadata?.GetVariableByReference(i)??VariableRegister.GetVariableByReference(i);(i?.unit||-1!==i?.type?.split("|")?.indexOf("float"))&&(this.valueUnit=n?.unit,-1===Oe.variablesToPoll.indexOf(i)&&Oe.variablesToPoll.push(i),Oe.liveUpdateEvents[this.GUID]=(e,t)=>{if(i){const n=e?.GetVariableId(i);null!=t?.[n]&&(this.value=t[n])}})}},{extends:"span"});class UITableBase extends HTMLDivElement{get value(){return[...this._valueElement.children].map((e=>e.value))}set value(e){if(null==e)return;if(e.length!==this.xResolution*this.yResolution)return;let t=!0;const i=this.value;for(let n=0;n<i.length;n++)if(!(i[n]===e[n]||isNaN(i[n])&&isNaN(e[n]))){t=!1;break}if(!t){for(let t=0;t<this._valueElement.children.length;t++)this._valueElement.children[t].value=e[t];this.dispatchEvent(new Event("change",{bubbles:!0}))}}get saveValue(){return{value:this.value,xAxis:this.xAxis,yAxis:this.yAxis}}set saveValue(e){if(null==e)return;e.value??=e.Value,e.xAxis??=e.XAxis,e.xResolution??=e.XResolution,e.yAxis??=e.YAxis,e.yResolution??=e.YResolution;const t=e.xResolution??e.Resolution,i=e.MaxX??e.Max,n=e.MinX??e.Min;if(t&&null!=i&&null!=n&&null!==i&&null!==n){e.xAxis=new Array(t);const a=(i-n)/(t-1);for(let i=0;i<t;i++)e.xAxis[i]=n+a*i}if(e.yResolution&&null!=e.MaxY&&null!=e.MinY&&null!==e.MaxY&&null!==e.MinY){e.yAxis=new Array(e.yResolution);const t=(e.MaxY-e.MinY)/(e.yResolution-1);for(let i=0;i<e.yResolution;i++)e.yAxis[i]=e.MinY+t*i}null!=e.xAxis&&(this.xAxis=e.xAxis),null!=e.yAxis&&(this.yAxis=e.yAxis),null!=e.value&&Array.isArray(e.value)&&(this.value=e.value)}get xResolution(){return Math.max(1,this._xAxisElement.children.length)}set xResolution(e){if(isNaN(e)||e===this._xAxisElement.children.length)return;const t=this.value;let i=new Array(e*this.yResolution);for(let n=0;n<e;n++)for(let a=0;a<this.yResolution;a++){let s=n+this.xResolution*a,l=n+e*a;if(n>=this.xResolution){let t=n-1+e*a,s=n-2+e*a;n>1&&(i[l]=i[t]+(i[t]-i[s]))}else i[l]=t[s];isNaN(i[l])&&(i[l]=0)}this._xResolutionElement&&(this._xResolutionElement.value=e),this._resolutionChanged(this._xAxisElement,e),this.value=i,this.dispatchEvent(new Event("change",{bubbles:!0}))}get xAxis(){return[...this._xAxisElement.children].map((e=>e.value))}set xAxis(e){xe(this.xAxis,e)||(this.xResolution=e.length,e.forEach(((e,t)=>{this._xAxisElement.children[t].value=e})),this.dispatchEvent(new Event("change",{bubbles:!0})))}get yResolution(){return Math.max(1,this._yAxisElement.children.length)}set yResolution(e){if(isNaN(e)||e===this._yAxisElement.children.length)return;const t=this.value;let i=new Array(this.xResolution*e);for(let n=0;n<this.xResolution;n++)for(let a=0;a<e;a++){let e=n+this.xResolution*a;if(a>=this.yResolution){let t=n+this.xResolution*(a-1),s=n+this.xResolution*(a-2);a>1&&(i[e]=i[t]+(i[t]-i[s]))}else i[e]=t[e];isNaN(i[e])&&(i[e]=0)}this._yResolutionElement&&(this._yResolutionElement.value=e),this._resolutionChanged(this._yAxisElement,e),this.value=i,this.dispatchEvent(new Event("change",{bubbles:!0}))}get yAxis(){return[...this._yAxisElement.children].map((e=>e.value))}set yAxis(e){xe(this.yAxis,e)||(this.yResolution=e.length,e.forEach(((e,t)=>{this._yAxisElement.children[t].value=e})),this.dispatchEvent(new Event("change",{bubbles:!0})))}#C;get selecting(){return this.#C}set selecting(e){if(this.#C=e,this._valueElement.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected")})),this._xAxisElement.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected")})),this._yAxisElement.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected")})),e){let t=this._valueElement.children;isNaN(e.startX)&&(t=this._yAxisElement.children),isNaN(e.startY)&&(t=this._xAxisElement.children);for(let i=0;i<t.length;i++){let n=t[i];Math.min(e.endX,e.startX)>parseInt(n.x)||Math.max(e.endX,e.startX)<parseInt(n.x)||Math.min(e.endY,e.startY)>parseInt(n.y)||Math.max(e.endY,e.startY)<parseInt(n.y)||n.classList.add("selected")}}this.dispatchEvent(new Event("select"))}#S;get _valueMin(){return isNaN(this.#S)?18e18:this.#S}set _valueMin(e){e=parseFloat(e),this.#S!==e&&(this.#S=e,this.style.setProperty("--valuemin",e))}#_;get _valueMax(){return this.#_-this.#S==0?1:isNaN(this.#_)?-9e18:this.#_}set _valueMax(e){e=parseFloat(e),this.#_!==e&&(this.#_=e,this.style.setProperty("--valuemax",e))}_boundAxis(e){if(e!==this._xAxisElement&&e!==this._yAxisElement)return;let t,i;e===this._xAxisElement?(t=Math.max(this.selecting.endX,this.selecting.startX),i=Math.max(this.selecting.endX,this.selecting.startX)):(t=Math.max(this.selecting.endY,this.selecting.startY),i=Math.max(this.selecting.endY,this.selecting.startY));let n=e.children[i].value;for(let t=i+1;t<e.children.length;t++)e.children[t].value<n&&(e.children[t].value=n),n=e.children[t].value;n=e.children[t].value;for(let i=t-1;i>=0;i--)e.children[i].value>n&&(e.children[i].value=n),n=e.children[i].value}attachToTable(e){e.addEventListener("change",(()=>{this.xAxis=e.xAxis,this.yAxis=e.yAxis,this.value=e.value})),e.addEventListener("select",(()=>{this.selecting=e.selecting}))}}class UITable extends UITableBase{get selecting(){return super.selecting}set selecting(e){if(xe(this.selecting,e))return;this.#L.querySelectorAll("input")?.forEach((e=>{e.parentElement.textContent=ye(e.parentElement.value)}));let t=[...this._valueElement.children].find((t=>t.x===e.startX&&t.y===e.startY));isNaN(e.startX)&&(t=[...this._yAxisElement.children].find((t=>t.y===e.startY))),isNaN(e.startY)&&(t=[...this._xAxisElement.children].find((t=>t.x===e.startX))),t&&this.#P.parentElement!==t&&(this.#P.value=t.value,t.replaceChildren(this.#P)),super.selecting=e}get xResolutionModifiable(){return!this.#O.hidden}set xResolutionModifiable(e){this.#O.hidden=!e,this._xResolutionElement.hidden=!e,this.yResolutionModifiable&&e?this.#M.hidden=!1:this.#M.hidden=!0,this.yResolutionModifiable||e?(this.#N.hidden=!1,this.#R.hidden=!1):(this.#N.hidden=!0,this.#R.hidden=!0)}get yResolutionModifiable(){return!this.#D.hidden}set yResolutionModifiable(e){this.#D.hidden=!e,this._yResolutionElement.hidden=!e,this.xResolutionModifiable&&e?this.#M.hidden=!1:this.#M.hidden=!0,this.xResolutionModifiable||e?(this.#N.hidden=!1,this.#R.hidden=!1):(this.#N.hidden=!0,this.#R.hidden=!0)}get xLabel(){return this.#k}set xLabel(e){this.#k!==e&&(this.#k=e,this.#F.replaceChildren(e??""))}get yLabel(){return this.#B}set yLabel(e){this.#B!==e&&(this.#B=e,this.#j.replaceChildren(e??""))}get zLabel(){return this.#W}set zLabel(e){this.#W!==e&&(this.#W=e,this.#G.replaceChildren(e??""))}get step(){return this.#P.step}set step(e){this.#P.step=e}get min(){return this.#P.min}set min(e){this.#P.min=e}get max(){return this.#P.max}set max(e){this.#P.max=e}trailTime=2e3;#Y=document.createElement("div");#z=document.createElement("div");#X=document.createElement("div");#H=document.createElement("div");#q=document.createElement("div");#$=document.createElement("div");#Z=document.createElement("div");#J=document.createElement("input");#K=document.createElement("div");#Q=document.createElement("div");#ee=document.createElement("div");#te=document.createElement("div");#R=document.createElement("div");_xResolutionElement=document.createElement("input");_yResolutionElement=document.createElement("input");#M=document.createElement("span");#ie=document.createElement("div");#ne=document.createElement("div");#ae=document.createElement("div");#se=document.createElement("div");#le=document.createElement("div");#re=document.createElement("div");#oe=document.createElement("div");#ue=document.createElement("div");#he=document.createElement("div");#de=document.createElement("div");#ce=document.createElementNS("http://www.w3.org/2000/svg","svg");#L=document.createElement("table");#F=document.createElement("div");#k=void 0;#j=document.createElement("div");#B=void 0;#G=document.createElement("div");#W=void 0;#N=document.createElement("td");#O=document.createElement("td");#D=document.createElement("td");_xAxisElement=document.createElement("div");_yAxisElement=document.createElement("div");_valueElement=document.createElement("div");#P=document.createElement("input");constructor(e){if(super(),this.class="ui",this.append(this.#ue),this.#ue.class="toolbar",this.#ue.append(this.#de),this.#de.class="lefttoolbar",this.#ue.append(this.#he),this.#he.class="righttoolbar",this.#de.append(this.#R),this.#R.class="resolution container",this.#R.append(this._xResolutionElement),this.#R.append(this.#M),this.#R.append(this._yResolutionElement),this._xResolutionElement.type="number",this._xResolutionElement.class="resolution-value",this._yResolutionElement.type="number",this._yResolutionElement.class="resolution-value",this.#M.textContent="X",this.#de.append(this.#ie),this.#ie.class="paste container",this.#ie.append(this.#ne),this.#ie.append(this.#ae),this.#ie.append(this.#se),this.#ie.append(this.#le),this.#ie.append(this.#re),this.#ie.append(this.#oe),this.#ne.class="paste-button equal selected",this.#ne.value="equal",this.#ae.class="paste-button add",this.#ae.value="add",this.#se.class="paste-button subtract",this.#se.value="subtract",this.#le.class="paste-button multiply",this.#le.value="multiply",this.#re.class="paste-button multiplyp",this.#re.value="multiply%",this.#oe.class="paste-button multiplyp2",this.#oe.value="multiply%/2",this.#oe.innerHTML="<span><sup>%</sup>&frasl;<sub>2</sub></span>",this.#he.append(this.#Y),this.#Y.class="modify container",this.#Y.append(this.#J),this.#Y.append(this.#z),this.#Y.append(this.#X),this.#Y.append(this.#H),this.#Y.append(this.#q),this.#Y.append(this.#$),this.#Y.append(this.#Z),this.#J.type="number",this.#J.class="modify-value",this.#z.class="modify-button add",this.#X.class="modify-button subtract",this.#H.class="modify-button multiply",this.#q.class="modify-button divide",this.#$.class="modify-button percent",this.#Z.class="modify-button equal",this.#X.hidden=!0,this.#q.hidden=!0,this.#$.hidden=!0,this.#he.append(this.#K),this.#K.class="interpolate container",this.#K.append(this.#Q),this.#K.append(this.#ee),this.#K.append(this.#te),this.#Q.class="modify-button interpolatex",this.#ee.class="modify-button interpolatey",this.#te.class="modify-button interpolatexy",this.#ce.style='position:absolute; pointer-events: none;" z-index="100',this.#ce.setAttribute("overflow","visible"),this.#ce.setAttribute("width",100),this.#ce.setAttribute("height",60),this.#ce.classList.add("trail"),this.append(this.#L),this.#L.class="numerictable",this.#F.class="xlabel",this.#j.class="ylabel",this.#G.class="zlabel",this._xAxisElement.class="xAxis",this._yAxisElement.class="yAxis",this._valueElement.class="value",this.#P.type="number",this.#O.class="xdrag",this.#O.rowSpan=2,this.#D.class="ydrag",this.#D.colSpan=2,this.#N.class="xydrag",e){const t=e.value;delete e.value,Object.assign(this,e),this.value=t}this.#pe(),this.#me(),this.#ve(),this.#fe()}static#ge={get:function(){return this._value},set:function(e){if(e=parseFloat(e),this._value===e)return;this._value=e,this.style.setProperty("--data-value",e);const t=this.children[0];"INPUT"===t?.tagName?t.value=e:this.textContent=ye(e)}};trail(e,t=0,i){const n=this.xAxis,a=this.yAxis,s=this._valueElement.firstChild.offsetWidth,l=this._valueElement.firstChild.offsetHeight,r=this._valueElement.firstChild.offsetLeft,o=this._valueElement.firstChild.offsetTop;let u=n.findIndex((t=>t>e));u<0?u=n.length-1:u>0&&u<n.length-1&&(u+=(e-n[u-1])/(n[u]-n[u-1])-1);let h,d=a.findIndex((e=>e>t));if(d<0?d=a.length-1:d>0&&d<a.length-1&&(d+=(t-a[d-1])/(a[d]-a[d-1])-1),e=r+u*s+s/2,t=o+d*l+l/2,this.#ce.children.length>0){h=this.#ce.firstChild;let i=document.createElementNS("http://www.w3.org/2000/svg","line");i.setAttribute("x1",h.getAttribute("cx")),i.setAttribute("y1",h.getAttribute("cy")),i.setAttribute("x2",e),i.setAttribute("y2",t),this.#ce.children.length>1?this.#ce.insertBefore(i,this.#ce.children[1]):this.#ce.append(i)}else h=document.createElementNS("http://www.w3.org/2000/svg","ellipse"),this.#ce.append(h);h.setAttribute("rx",s/2),h.setAttribute("ry",l/2),h.setAttribute("cx",e),h.setAttribute("cy",t),setTimeout((()=>{let e=this.#ce.lastChild;e&&this.#ce.removeChild(e)}),this.trailTime)}#pe(){let e=[];const t=this._xAxisElement.children.length,i=this._yAxisElement.children.length;if(t>1&&i>1){const t=document.createElement("tr");e.push(t);t.appendChild(document.createElement("td")).colSpan=3;const i=t.appendChild(document.createElement("td"));i.class="xtrans",i.append(this.#F)}const n=document.createElement("tr");if(e.push(n),t>1){const e=n.appendChild(document.createElement("td"));e.class="xztrans",i>1?(e.colSpan=3,e.append(this.#G)):e.append(this.#F);n.appendChild(document.createElement("td")).append(this._xAxisElement),n.append(this.#O)}else if(i>1){n.appendChild(document.createElement("td")).append(this.#j);n.appendChild(document.createElement("td")).append(this.#G)}const a=document.createElement("tr");e.push(a);const s=document.createElement("tr");if(e.push(s),i>1){if(t>1){a.appendChild(document.createElement("td")).style="width: auto; min-width: 2em;";const e=a.appendChild(document.createElement("td"));e.class="ytrans",e.append(this.#j),s.appendChild(document.createElement("td")).colSpan=2}const e=a.appendChild(document.createElement("td"));e.class="yaxis",e.append(this._yAxisElement),s.append(this.#D),s.append(this.#N)}else if(t>1){const e=a.appendChild(document.createElement("td"));e.class="xztrans",e.append(this.#G)}const l=a.appendChild(document.createElement("td"));l.append(this.#ce),l.append(this._valueElement),this.#L.replaceChildren(...e)}_resolutionChanged(e,t){for(;t<e.children.length;)e.removeChild(e.lastChild);for(let i=e.children.length;i<t;i++){const t=e.appendChild(document.createElement("div"));Object.defineProperty(t,"value",UITable.#ge);const n=e.children[i-1]?.value,a=e.children[i-2]?.value;let s=0;null!=n&&null!=a&&(s=n+(n-a)),t.value=s,e===this._xAxisElement?t.x=i:t.y=i}for(this.style.setProperty("--xresolution",this.xResolution),this.style.setProperty("--yresolution",this.yResolution);this.xResolution*this.yResolution<this._valueElement.children.length;)this._valueElement.removeChild(this._valueElement.lastChild);for(let e=0;e<this.xResolution*this.yResolution;e++){const t=this._valueElement.children[e]??this._valueElement.appendChild(document.createElement("div"));Object.defineProperty(t,"value",UITable.#ge),t.x=e%this.xResolution,t.y=Math.trunc(e/this.xResolution)}this.xResolution>1?(this.yResolution>1?(this.#K.classList.add("interpolatexy"),this.#te.hidden=!1):(this.#K.classList.remove("interpolatexy"),this.#te.hidden=!0),this.#Q.hidden=!1):(this.#K.classList.remove("interpolatexy"),this.#te.hidden=!0,this.#Q.hidden=!0),this.yResolution>1?this.#ee.hidden=!1:this.#ee.hidden=!0,this.#pe()}#me(){const e=()=>{const e=be(this.value);this._valueMin=e[0],this._valueMax=e[1]};this.addEventListener("change",e),e(),this.#ie.addEventListener("click",(e=>{let t=e.target;for(let e=0;e<2;e++)t.value||(t=t.parentElement);t.value&&(this.#ie.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected")})),t.classList.add("selected"))})),this._xResolutionElement.addEventListener("change",(e=>{this.xResolution=parseInt(e.target.value)})),this._yResolutionElement.addEventListener("change",(e=>{this.yResolution=parseInt(e.target.value)}));const t=()=>{if(!this.#P.parentElement)return;let e=parseInt(this.#P.parentElement.x),t=parseInt(this.#P.parentElement.y);const i=parseFloat(this.#P.parentElement.value);let n=parseFloat(this.#P.value);if(isNaN(n)||n===i||null==e&&null==t)return;let a=this._valueElement;isNaN(t)?a=this._xAxisElement:isNaN(e)&&(a=this._yAxisElement);a.querySelectorAll(".selected").forEach((e=>{e.value=n})),this._boundAxis(a)};this.#P.addEventListener("change",t),this.#P.addEventListener("copy",(e=>{let t,i="";this.#L.querySelectorAll(".selected").forEach((e=>{if(isNaN(parseFloat(e.value)))return;if(null==e.y&&null==e.x)return;let n=parseInt(e.y??-1);null!=t&&(i+=t!==n?"\n":"\t"),i+=e.value,t=n})),e.clipboardData.setData("text/plain",i),e.preventDefault()})),this.#P.addEventListener("paste",(e=>{var t=e.clipboardData.getData("text/plain");const i=t.split("\n").length,n=t.split("\t").length;let a=parseInt(e.target.parentElement.x),s=parseInt(e.target.parentElement.y),l=this._valueElement;if(isNaN(a)){if(n>1)return;a=0,l=this._yAxisElement}if(isNaN(s)){if(i>1)return;s=0,l=this._xAxisElement}let r=this.#ie.querySelector(".selected")?.value;t.split("\n").forEach(((e,t)=>{var i=s+t;i>this.yResolution-1||(l===this._valueElement&&(i*=this.xResolution),e.split("\t").forEach(((e,t)=>{var n=a+t;if(n>this.xResolution-1)return;var s=parseFloat(e);let o=l.children[n+i];switch(r){case"add":o.value+=s;break;case"subtract":o.value-=s;break;case"multiply":o.value*=s;break;case"multiply%":o.value*=1+s/100;break;case"multiply%/2":o.value*=1+s/200;break;case"average":o.value+=s,o.value/=2;break;default:o.value=s}})))})),this.selecting={startX:a,startY:s,endX:a+t.split("\n")[0].split("\t").length-1,endY:s+t.split("\n").length-1},e.preventDefault(),this._boundAxis(l),this.dispatchEvent(new Event("change",{bubbles:!0}))})),this.#L.addEventListener("dragstart",(e=>{e.preventDefault()}));let i=!1,n=!1,a=!1;const s=e=>{r(e.pageX,e.pageY)},l=e=>{var t=e.touches[e.touches.length-1];r(t.pageX,t.pageY)},r=(e,t)=>{if(i){var s=this._xAxisElement.firstChild.offsetWidth;let t=(e-i.startPageX)/s;const n=t/Math.abs(t);t=parseInt((Math.abs(t)+.5)*n);let a=i.startXResolution+t;a<2&&(a=2),this.xResolution=a}if(n){var l=this._yAxisElement.firstChild.offsetHeight;let e=(t-n.startPageY)/l;const i=e/Math.abs(e);e=parseInt((Math.abs(e)+.5)*i);let a=n.startYResolution+e;a<2&&(a=2),this.yResolution=a}if(a){var r=a.startElement.getBoundingClientRect();let i=e-r.left;i<0&&(i-=r.width);let n=t-r.top;n<0&&(n-=r.height),i=parseInt(i/r.width),n=parseInt(n/r.height),a.endX=Math.min(this.xResolution-1,Math.max(0,a.startX+i)),a.endY=Math.min(this.yResolution-1,Math.max(0,a.startY+n)),(Math.abs(i)>0||Math.abs(n)>0)&&(a.selectOnMove=!1),a.selectOnMove||(this.selecting={startX:a.startX,startY:a.startY,endX:a.endX,endY:a.endY})}};let o=!1;const u=()=>{if(i=!1,n=!1,a){const e=null!=a.startElement.x||null!=a.startElement.y;o&&e&&this.#P.select()}a=!1,document.removeEventListener("touchmove",l),document.removeEventListener("mousemove",s)};document.addEventListener("mouseup",u),document.addEventListener("touchend",u);const h=e=>{o=!1;const i=null!=e.target.x||null!=e.target.y,n=null!=e.target.parentElement.x||null!=e.target.parentElement.y;(i||n)&&(a={startElement:i?e.target:e.target.parentElement,selectOnMove:n},a.startX=parseInt(a.startElement.x),a.startY=parseInt(a.startElement.y),i&&(t(),a.selectOnMove||(this.selecting={startX:a.startX,startY:a.startY,endX:a.startX,endY:a.startY})),"number"!==e.target.type&&(o=!0)),document.addEventListener("touchmove",l),document.addEventListener("mousemove",s)};this.#L.addEventListener("mousedown",(e=>{2===e.button?(h(e),e.target.select?.(),u(),e.preventDefault()):0==e.button&&h(e)})),this.#L.addEventListener("contextmenu",(e=>{h(e),e.preventDefault()})),this.#N.addEventListener("mousedown",(e=>{i={startPageX:e.pageX,startXResolution:this.xResolution},n={startPageY:e.pageY,startYResolution:this.yResolution},document.addEventListener("mousemove",s)})),this.#O.addEventListener("mousedown",(e=>{i={startPageX:e.pageX,startXResolution:this.xResolution},document.addEventListener("mousemove",s)})),this.#D.addEventListener("mousedown",(e=>{n={startPageY:e.pageY,startYResolution:this.yResolution},document.addEventListener("mousemove",s)}))}#ve(){this.#P.addEventListener("keypress",(e=>{"+"===e.key&&(e.preventDefault(),this.#J.select(),this.#z.classList.add("selected")),!e.shiftKey||"-"!==e.key&&"_"!==e.key||(e.preventDefault(),this.#z.hidden=!0,this.#X.hidden=!1,this.#J.select(),this.#X.classList.add("selected")),"*"===e.key&&(e.preventDefault(),this.#J.select(),this.#H.classList.add("selected")),"/"===e.key&&(e.preventDefault(),this.#H.hidden=!0,this.#q.hidden=!1,this.#J.select(),this.#q.classList.add("selected")),"%"===e.key&&(e.preventDefault(),this.#H.hidden=!0,this.#$.hidden=!1,this.#J.select(),this.#$.classList.add("selected")),"="===e.key&&(e.preventDefault(),this.#J.select(),this.#Z.classList.add("selected"))}));const e=e=>{const t=parseFloat(this.#J.value);if(isNaN(t))return;let i=this._valueElement;null==this.#P.parentElement.x&&(i=this._yAxisElement),null==this.#P.parentElement.y&&(i=this._xAxisElement),i.querySelectorAll(".selected").forEach((i=>{switch(e){case"equal":i.value=t;break;case"add":i.value+=t;break;case"subtract":i.value-=t;break;case"multiply":i.value*=t;break;case"divide":i.value/=t;break;case"percent":i.value*=1+t/100;break;default:return}})),this._boundAxis(i),this.dispatchEvent(new Event("change",{bubbles:!0}))},t=()=>{this.#z.hidden=!1,this.#X.hidden=!0,this.#H.hidden=!1,this.#q.hidden=!0,this.#$.hidden=!0;for(let e=0;e<this.#Y.children.length;e++)this.#Y.children[e].classList.remove("selected")};this.#J.addEventListener("blur",t),this.#J.addEventListener("keypress",(e=>{"Enter"===e.key&&(this.#Y.querySelector(".selected")?.dispatchEvent(new Event("click")),t(),this.#P.select())})),this.#Z.addEventListener("click",(()=>{e("equal")})),this.#z.addEventListener("click",(()=>{e("add")})),this.#X.addEventListener("click",(()=>{e("subtract")})),this.#H.addEventListener("click",(()=>{e("multiply")})),this.#q.addEventListener("click",(()=>{e("divide")})),this.#$.addEventListener("click",(()=>{e("percent")}))}#fe(){const e=()=>{let e=this._valueElement.querySelectorAll(".selected");if(e.length<3&&(e=this._xAxisElement.querySelectorAll(".selected"),e.length<3))return;let t=18e18,i=-9e18;e.forEach((e=>{const n=parseInt(e.x);n<t&&(t=n),n>i&&(i=n)}));const n=this.xAxis,a=n[i]-n[t];if(isNaN(e[0].y)){const s=a/(i-t);e.forEach((e=>{const i=parseInt(e.x);e.value=n[t]+s*(i-t)}))}else{const s=this.xResolution,l=this.value;e.forEach((e=>{const r=parseInt(e.x),o=parseInt(e.y);if(!isNaN(r)&&!isNaN(o)){const u=l[t+o*s];let h=u+(l[i+o*s]-u)/a*(n[r]-n[t]);e.value=h}}))}this.dispatchEvent(new Event("change",{bubbles:!0}))},t=()=>{let e=this._valueElement.querySelectorAll(".selected");if(e.length<3&&(e=this._yAxisElement.querySelectorAll(".selected"),e.length<3))return;let t=18e18,i=-9e18;e.forEach((e=>{const n=parseInt(e.y);n<t&&(t=n),n>i&&(i=n)}));const n=this.yAxis,a=n[i]-n[t];if(isNaN(e[0].x)){const s=a/(i-t);e.forEach((e=>{const i=parseInt(e.y);e.value=n[t]+s*(i-t)}))}else{const s=this.xResolution,l=this.value;e.forEach((e=>{const r=parseInt(e.x),o=parseInt(e.y);if(!isNaN(r)&&!isNaN(o)){const u=l[r+t*s];let h=u+(l[r+i*s]-u)/a*(n[o]-n[t]);e.value=h}}))}this.dispatchEvent(new Event("change",{bubbles:!0}))};this.#te.addEventListener("click",(()=>{if(this._valueElement.querySelectorAll(".selected").length<5)return this._xAxisElement.querySelectorAll(".selected").length>2&&e(),void(this._yAxisElement.querySelectorAll(".selected").length>2&&t());e(),t()})),this.#Q.addEventListener("click",e),this.#ee.addEventListener("click",t)}}customElements.define("ui-table",UITable,{extends:"div"});class UITableWithUnit extends UITemplate{static template='<div data-element="displayValueElement">';get zLabel(){return this.#W}set zLabel(e){this.#W!==e&&(this.#W=e,this.#G.replaceChildren(e??""))}get measurement(){return this.displayUnitElement.measurement}set measurement(e){this.displayUnitElement.measurement=e}get displayUnit(){return this.displayUnitElement.value}set displayUnit(e){this.displayUnitElement.value=e??this._valueUnit}get displayValue(){return this.displayValueElement.value}set displayValue(e){this.displayValueElement.value=e}_valueUnit;get valueUnit(){return this._valueUnit??this.displayUnit}set valueUnit(e){if(this._valueUnit===e)return;let t=Se(this.value,this._valueUnit,e);this._valueUnit=e,this.displayUnit??=e,this.value=t}#e;get value(){return this.#e}set value(e){xe(this.#e,e)||(this.#e=e,this.displayValue=Se(e,this.valueUnit,this.displayUnit),this.UpdateDisplayValue())}get xResolutionModifiable(){return this.displayValueElement.xResolutionModifiable}set xResolutionModifiable(e){this.displayValueElement.xResolutionModifiable=e}get xResolution(){return this.displayValueElement.xResolution}set xResolution(e){this.displayValueElement.xResolution=e}get xLabel(){return this.#k}set xLabel(e){this.#k!==e&&(this.#k=e,this.#F.replaceChildren(e??""))}get xMeasurement(){return this.xDisplayUnitElement.measurement}set xMeasurement(e){this.xDisplayUnitElement.measurement=e}get xDisplayUnit(){return this.xDisplayUnitElement.value}set xDisplayUnit(e){this.xDisplayUnitElement.value=e}get xDisplayAxis(){return this.displayValueElement.xAxis}set xDisplayAxis(e){this.displayValueElement.xAxis=e}_xUnit;get xUnit(){return Array.isArray(this._xUnit)?this._xUnit.find((e=>Ce(e)===Ce(this.xDisplayUnit))):this._xUnit??this.xDisplayUnit}set xUnit(e){if(xe(this._xUnit,e))return;const t=Array.isArray(e)?e.find((e=>Ce(e)===Ce(this.xDisplayUnit))):e,i=Se(this.xAxis,this.xUnit,t);this._xUnit=e,this.xDisplayUnit??=Array.isArray(e)?e[0]:e,this.xAxis=i}#ye;get xAxis(){return this.#ye}set xAxis(e){xe(this.#ye,e)||(this.#ye=e,this.xDisplayAxis=Se(e,this.xUnit,this.xDisplayUnit),this.UpdateDisplayValue())}get yResolutionModifiable(){return this.displayValueElement.yResolutionModifiable}set yResolutionModifiable(e){this.displayValueElement.yResolutionModifiable=e}get yResolution(){return this.displayValueElement.yResolution}set yResolution(e){this.displayValueElement.yResolution=e}get yLabel(){return this.#B}set yLabel(e){this.#B!==e&&(this.#B=e,this.#j.replaceChildren(e??""))}get yMeasurement(){return this.yDisplayUnitElement.measurement}set yMeasurement(e){this.yDisplayUnitElement.measurement=e}get yDisplayUnit(){return this.yDisplayUnitElement.value}set yDisplayUnit(e){this.yDisplayUnitElement.value=e}get yDisplayAxis(){return this.displayValueElement.yAxis}set yDisplayAxis(e){this.displayValueElement.yAxis=e}_yUnit;get yUnit(){return Array.isArray(this._yUnit)?this._yUnit.find((e=>Ce(e)===Ce(this.yDisplayUnit))):this._yUnit??this.yDisplayUnit}set yUnit(e){if(xe(this._yUnit,e))return;const t=Array.isArray(e)?e.find((e=>Ce(e)===Ce(this.yDisplayUnit))):e,i=Se(this.yAxis,this.yUnit,t);this._yUnit=e,this.yDisplayUnit??=Array.isArray(e)?e[0]:e,this.yAxis=i}#be;get yAxis(){return this.#be}set yAxis(e){xe(this.#be,e)||(this.#be=e,this.yDisplayAxis=Se(e,this.yUnit,this.yDisplayUnit),this.UpdateDisplayValue())}get selecting(){return this.displayValueElement.selecting}set selecting(e){this.displayValueElement.selecting=e}#o;get min(){return this.#o}set min(e){this.#o!==e&&(this.#o=e,this.UpdateDisplayValue())}#u;get max(){return this.#u}set max(e){this.#u!==e&&(this.#u=e,this.UpdateDisplayValue())}#h;get step(){return this.#h}set step(e){this.#h!==e&&(this.#h=e,this.UpdateDisplayValue())}#xe=document.createElement("div");#F=document.createElement("span");#k="X";#Ee=document.createElement("div");#j=document.createElement("span");#B="Y";#Ue=document.createElement("div");#G=document.createElement("span");#W=void 0;constructor(e){super(),this.displayValueElement=new UITable,this.displayUnitElement=new UIUnit({measurement:e?.measurement,value:e?.displayUnit??e?.valueUnit});let t=this.displayUnit;this.displayUnitElement.addEventListener("change",(()=>{null!=this.displayValue&&(this.displayValue=Se(this.displayValue,t,this.displayUnit)),t=this.displayUnit})),this.xDisplayUnitElement=new UIUnit({measurement:e?.xMeasurement,value:e?.xDisplayUnit??e?.xUnit});let i=this.xDisplayUnit;this.xDisplayUnitElement.addEventListener("change",(()=>{null!=this.xDisplayAxis&&(this.xDisplayAxis=Se(this.xDisplayAxis,i,this.xDisplayUnit)),i=this.xDisplayUnit})),this.yDisplayUnitElement=new UIUnit({measurement:e?.yMeasurement,value:e?.yDisplayUnit??e?.yUnit});let n=this.yDisplayUnit;if(this.yDisplayUnitElement.addEventListener("change",(()=>{null!=this.yDisplayAxis&&(this.yDisplayAxis=Se(this.yDisplayAxis,n,this.yDisplayUnit)),n=this.yDisplayUnit})),this.displayValueElement.addEventListener("change",(()=>{null!=this.displayValue&&(this.value=Se(this.displayValue,this.displayUnit,this.valueUnit)),null!=this.xDisplayAxis&&(this.xAxis=Se(this.xDisplayAxis,this.xDisplayUnit,this.xUnit)),null!=this.yDisplayAxis&&(this.yAxis=Se(this.yDisplayAxis,this.yDisplayUnit,this.yUnit))})),this.#xe.append(this.#F),this.#xe.append(this.xDisplayUnitElement),this.displayValueElement.xLabel=this.#xe,this.#Ee.append(this.#j),this.#Ee.append(this.yDisplayUnitElement),this.displayValueElement.yLabel=this.#Ee,this.#Ue.append(this.#G),this.#Ue.append(this.displayUnitElement),this.displayValueElement.zLabel=this.#Ue,e){const t=e.value;delete e.value,Object.assign(this,e),this.value=t}this.Setup(e)}get saveValue(){return{...this.displayValueElement.saveValue,value:this.value,xAxis:this.xAxis,yAxis:this.yAxis,...null!=this.displayUnitElement.saveValue&&{displayUnit:this.displayUnitElement.saveValue},...null!=this.xDisplayUnitElement.saveValue&&{xDisplayUnit:this.xDisplayUnitElement.saveValue},...null!=this.yDisplayUnitElement.saveValue&&{yDisplayUnit:this.yDisplayUnitElement.saveValue}}}set saveValue(e){this.displayValueElement.saveValue={...e,value:void 0,xAxis:void 0,yAxis:void 0},null!=e.displayUnit&&(this.displayUnitElement.saveValue=e.displayUnit),null!=e.xDisplayUnit&&(this.xDisplayUnitElement.saveValue=e.xDisplayUnit),null!=e.yDisplayUnit&&(this.yDisplayUnitElement.saveValue=e.yDisplayUnit),null!=e.xAxis&&(this.xAxis=e.xAxis),null!=e.yAxis&&(this.yAxis=e.yAxis),this.value=e.value}UpdateDisplayValue(){const e=this.displayUnit,t=this.valueUnit;null!=this.value&&this.value.length===this.displayValue.length&&(this.displayValue=Se(this.value,t,e)),this.displayValueElement.min=Se(this.min,t,e)??this.displayValueElement.min,this.displayValueElement.max=Se(this.max,t,e)??this.displayValueElement.max,this.displayValueElement.step=Se(this.step,t,e)??this.displayValueElement.step,null!=this.xAxis&&this.xAxis.length===this.xDisplayAxis.length&&(this.xDisplayAxis=Se(this.xAxis,this.xUnit,this.xDisplayUnit)),null!=this.yAxis&&this.yAxis.length===this.yDisplayAxis.lengt&&(this.yDisplayAxis=Se(this.yAxis,this.yUnit,this.yDisplayUnit))}attachToTable(e){this.displayValueElement.attachToTable(e),e.attachToTable(this.displayValueElement)}trail(e,t,i){this.displayValueElement.trail(e,t,i)}}customElements.define("ui-tablewithunit",UITableWithUnit,{extends:"span"});class UIGraph3D extends UITableBase{get xAxis(){return super.xAxis}set xAxis(e){super.xAxis=e,this._valueElement.update(),this.#we.update(),this._xAxisElement.update(),this._yAxisElement.update()}get yAxis(){return super.yAxis}set yAxis(e){super.yAxis=e,this._valueElement.update(),this.#we.update(),this._xAxisElement.update(),this._yAxisElement.update()}get selecting(){return super.selecting}set selecting(e){if(!xe(this.selecting,e)){if(this.#we.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected")})),e&&null!=e.startX&&null!=e.endX&&null!=e.startY&&null!=e.endY)for(let t=0;t<this.#we.children.length;t++){let i=this.#we.children[t];Math.min(e.endX,e.startX)>parseInt(i.x1)||Math.max(e.endX,e.startX)<parseInt(i.x2)||Math.min(e.endY,e.startY)>parseInt(i.y1)||Math.max(e.endY,e.startY)<parseInt(i.y3)||i.classList.add("selected")}super.selecting=e}}get pitch(){return this.#Ve??0}set pitch(e){e=Math.max(-90,Math.min(90,parseFloat(e))),this.pitch!==e&&(this.#Ve=e,this.#Ae=UIGraph3D.transformPrecalc(this))}get yaw(){return this.#Ie??0}set yaw(e){e=parseFloat(e),this.yaw!==e&&(this.#Ie=e,this.#Ae=UIGraph3D.transformPrecalc(this))}get cameraX(){return this.#Te??0}set cameraX(e){e=parseFloat(e),this.cameraX!==e&&(this.#Te=e,this.#Ae=UIGraph3D.transformPrecalc(this))}get cameraY(){return this.#Ce??0}set cameraY(e){e=parseFloat(e),this.cameraY!==e&&(this.#Ce=e,this.#Ae=UIGraph3D.transformPrecalc(this))}get zoom(){return this.#Se??.75}set zoom(e){e=parseFloat(e),this.zoom!==e&&(this.#Se=e,this.#Ae=UIGraph3D.transformPrecalc(this))}get width(){return this.#_e.getAttribute("width")??this.offsetWidth??300}set width(e){this.#_e.setAttribute("width",parseFloat(e.toFixed(10))),this.#Ae=UIGraph3D.transformPrecalc(this)}get height(){return this.#_e.getAttribute("height")??this.offsetHeight??150}set height(e){this.#_e.setAttribute("height",parseFloat(e.toFixed(10))),this.#Ae=UIGraph3D.transformPrecalc(this)}#Le=document.createElementNS("http://www.w3.org/2000/svg","g");#Pe=document.createElementNS("http://www.w3.org/2000/svg","g");_xAxisElement=document.createElementNS("http://www.w3.org/2000/svg","g");_yAxisElement=document.createElementNS("http://www.w3.org/2000/svg","g");_valueElement=document.createElementNS("http://www.w3.org/2000/svg","g");#we=document.createElementNS("http://www.w3.org/2000/svg","g");#_e=document.createElementNS("http://www.w3.org/2000/svg","svg");#Oe;get#Ae(){return this.#Oe}set#Ae(e){if(xe(this.#Oe,e))return;this.#Oe=e;const t=e.zoom/(7.5*Math.max(this.xResolution,this.yResolution));[...this._valueElement.children].forEach((e=>{e.setAttribute("r",t.toFixed(10))})),this._valueElement.update(),this.#we.updateWithDepth(),this._xAxisElement.update(),this._yAxisElement.update(),this.#Pe.update(),this.#Le.update()}#Ie;#Ve;#Se;#Te;#Ce;trail(e,t=0,i){}get _valueMin(){return super._valueMin}set _valueMin(e){super._valueMin=e,this._valueElement.update(),this.#we.update(),this.#Pe.update()}get _valueMax(){return super._valueMax}set _valueMax(e){super._valueMax=e,this._valueElement.update(),this.#we.update(),this.#Pe.update()}constructor(e){function t(){[...this.children].forEach((e=>{e.update()}))}super(),this.class="ui graph3d",this.append(this.#_e),this.#_e.setAttribute("overflow","visible"),this.#_e.append(this._xAxisElement),this.#_e.append(this._yAxisElement),this.#_e.append(this.#Pe),this.#_e.append(this.#Le),this.#_e.append(this.#we),this.#_e.append(this._valueElement),this._xAxisElement.update=t,this._yAxisElement.update=t,this.#Pe.update=t,this._valueElement.update=t,this.#we.update=t,this.#we.updateWithDepth=function(){const e=[...this.children];e.forEach((e=>{e.update()})),e.sort(((e,t)=>t.depth-e.depth)).forEach((e=>this.append(e)))},this.#Le.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path")).classList.add("floor"),this.#Le.append(document.createElementNS("http://www.w3.org/2000/svg","line")),this.#Le.append(document.createElementNS("http://www.w3.org/2000/svg","line"));const i=this;this.#Le.update=function(){const e=i.#Ae.sinYaw>0?1:0,t=i.#Ae.cosYaw>0?0:1,n=i.#Ae.sinPitch>0?0:1;this.children[0].style.display=1===n?"none":null;let a=[[UIGraph3D.transformPoint([e-.5,-(n-.5)*Math.max(1,i.height)/Math.max(1,i.width),-.5],i.#Ae),UIGraph3D.transformPoint([e-.5,-(n-.5)*Math.max(1,i.height)/Math.max(1,i.width),.5],i.#Ae)],[UIGraph3D.transformPoint([-.5,-(n-.5)*Math.max(1,i.height)/Math.max(1,i.width),t-.5],i.#Ae),UIGraph3D.transformPoint([.5,-(n-.5)*Math.max(1,i.height)/Math.max(1,i.width),t-.5],i.#Ae)]];a[0]=a[0].sort(((e,t)=>e[0]-t[0])),a[0][2]=Math.abs(i.#Ae.sinYaw),a[1]=a[1].sort(((e,t)=>e[0]-t[0])),a[1][2]=Math.abs(i.#Ae.cosYaw),a=a.sort(((e,t)=>e[0][0]-t[0][0])),this.children[1].setAttribute("x1",a[0][0][0].toFixed(10)),this.children[1].setAttribute("y1",a[0][0][1].toFixed(10)),this.children[1].setAttribute("x2",a[0][1][0].toFixed(10)),this.children[1].setAttribute("y2",a[0][1][1].toFixed(10)),this.children[2].setAttribute("x1",a[1][0][0].toFixed(10)),this.children[2].setAttribute("y1",a[1][0][1].toFixed(10)),this.children[2].setAttribute("x2",a[1][1][0].toFixed(10)),this.children[2].setAttribute("y2",a[1][1][1].toFixed(10));const s=UIGraph3D.transformPoint([.5-e,-(n-.5)*Math.max(1,i.height)/Math.max(1,i.width),.5-t],i.#Ae);this.children[0].setAttribute("d",`M${s[0].toFixed(10)},${s[1].toFixed(10)}L${a[0][0][0].toFixed(10)},${a[0][0][1].toFixed(10)}L${a[0][1][0].toFixed(10)},${a[0][1][1].toFixed(10)}L${a[1][1][0].toFixed(10)},${a[1][1][1].toFixed(10)}Z`)};const n=e.value;delete e.value,Object.assign(this,e),this.#Me(),this.value=n,null==e?.pitch&&(this.pitch=17),null==e?.yaw&&(this.yaw=30)}static transformPrecalc({width:e=0,height:t=0,pitch:i=0,yaw:n=0,cameraX:a=0,cameraY:s=0,zoom:l=1}={}){let r=Math.cos(i*(Math.PI/180)),o=Math.sin(i*(Math.PI/180)),u=Math.cos(n*(Math.PI/180)),h=Math.sin(n*(Math.PI/180));return{cosPitch:r,sinPitch:o,cosYaw:u,sinYaw:h,sinPitchSinYaw:o*h,nSinPitchCosYaw:-o*u,nCosPitchSinYaw:-r*h,cosPitchcosYaw:r*u,offsetX:e/2-a,offsetY:t/2-s,zoom:.7*e*l}}static transformPoint(e,t){t||(t=UIGraph3D.transformPrecalc());let i=(t.cosYaw*e[0]+t.sinYaw*e[2])*t.zoom+t.offsetX;isNaN(i)&&(i=0);let n=(t.sinPitchSinYaw*e[0]+t.cosPitch*e[1]+t.nSinPitchCosYaw*e[2])*t.zoom+t.offsetY;isNaN(n)&&(n=0);let a=(t.nCosPitchSinYaw*e[0]+t.sinPitch*e[1])*t.zoom;return isNaN(a)&&(a=0),[i,n,a]}#Ne(e,t,i){const n=this._xAxisElement.children,a=n[0]?.value,s=n[n.length-1]?.value,l=n[e]?.value,r=this._yAxisElement.children,o=r[0]?.value,u=r[r.length-1]?.value,h=r[t]?.value;if(!isNaN(i))return t=this.yResolution-t-1,e=(l-a)/(s-a),isNaN(e)&&(e=0),t=(h-o)/(u-o),isNaN(t)&&(t=0),i=(i-this._valueMin)/(this._valueMax-this._valueMin),UIGraph3D.transformPoint([e-.5,-(i-.5)*Math.max(1,this.height)/Math.max(1,this.width),t-.5],this.#Ae)}#Re(e,t){const i=this._xAxisElement.children,n=i[0]?.value,a=i[i.length-1]?.value,s=i[e]?.value,l=this._yAxisElement.children,r=l[0]?.value,o=l[l.length-1]?.value,u=l[t]?.value;return t=this.yResolution-t-1,e=null==e||isNaN(e)?this.#Ae?.sinYaw>0?0:1:(s-n)/(a-n),isNaN(e)&&(e=0),t=null==t||isNaN(t)?this.#Ae?.cosYaw>0?1:0:(u-r)/(o-r),isNaN(t)&&(t=0),[UIGraph3D.transformPoint([e-.5,.5*Math.max(1,this.height)/Math.max(1,this.width),t-.5],this.#Ae),UIGraph3D.transformPoint([e-.5,-.5*Math.max(1,this.height)/Math.max(1,this.width),t-.5],this.#Ae)]}#De(e){const t=this.#Ae.sinYaw>0?0:1,i=this.#Ae.cosYaw>0?1:0;return e=(e-this._valueMin)/(this._valueMax-this._valueMin),[[UIGraph3D.transformPoint([t-.5,-(e-.5)*Math.max(1,this.height)/Math.max(1,this.width),-.5],this.#Ae),UIGraph3D.transformPoint([t-.5,-(e-.5)*Math.max(1,this.height)/Math.max(1,this.width),.5],this.#Ae)],[UIGraph3D.transformPoint([-.5,-(e-.5)*Math.max(1,this.height)/Math.max(1,this.width),i-.5],this.#Ae),UIGraph3D.transformPoint([.5,-(e-.5)*Math.max(1,this.height)/Math.max(1,this.width),i-.5],this.#Ae)]]}_resolutionChanged(e,t){const i=this,n=.45/Math.max(this.xResolution,this.yResolution,t);for(;t<e.children.length;)e.removeChild(e.lastChild);for(let n=0;n<t;n++){let a=e.children[n];if(!a){a=e.appendChild(document.createElementNS("http://www.w3.org/2000/svg","g")),a.append(document.createElementNS("http://www.w3.org/2000/svg","line"));const t=a.appendChild(document.createElementNS("http://www.w3.org/2000/svg","text"));t.setAttribute("alignment-baseline","middle"),t.setAttribute("text-anchor","end");const i=a.appendChild(document.createElementNS("http://www.w3.org/2000/svg","text"));i.setAttribute("alignment-baseline","middle"),i.setAttribute("text-anchor","start");const s=e.children[n-1]?.value,l=e.children[n-2]?.value;let r=0;null!=s&&null!=l&&(r=s+(s-l)),a.value=r,e===this._xAxisElement?a.x=n:a.y=n}a.update=function(){if(!i.#Ae)return;const e=i.#Re(this.x,this.y);this.children[0].setAttribute("x1",e[0][0].toFixed(10)),this.children[0].setAttribute("y1",e[0][1].toFixed(10)),this.children[0].setAttribute("x2",e[1][0].toFixed(10)),this.children[0].setAttribute("y2",e[1][1].toFixed(10));const n=this.textSize*i.#Ae.zoom,a=Math.abs(null!=this.x?i.#Ae.cosYaw:i.#Ae.sinYaw),s=Math.abs(i.#Ae.cosPitch);let l=0;0===this.x&&(l=i.#Ae.sinYaw<0?0:i.#Ae.cosYaw*n/2),this.x===t-1&&(l=i.#Ae.sinYaw>0?0:-i.#Ae.cosYaw*n/2),0===this.y&&(l=i.#Ae.cosYaw>0?0:i.#Ae.sinYaw*n/2),this.y===t-1&&(l=i.#Ae.cosYaw<0?0:-i.#Ae.sinYaw*n/2),e[0][0]+=l,e[1][0]+=l,this.children[1].setAttribute("x",e[0][0].toFixed(10)),this.children[1].setAttribute("y",e[0][1].toFixed(10)),this.children[1].setAttribute("transform-origin",`${e[0][0].toFixed(10)} ${e[0][1].toFixed(10)}`),this.children[1].setAttribute("transform",`scale(${a.toFixed(10)} ${s.toFixed(10)}) rotate(-90)`),this.children[1].setAttribute("font-size",n.toFixed(10)),this.children[2].setAttribute("x",e[1][0].toFixed(10)),this.children[2].setAttribute("y",e[1][1].toFixed(10)),this.children[2].setAttribute("transform-origin",`${e[1][0].toFixed(10)} ${e[1][1].toFixed(10)}`),this.children[2].setAttribute("transform",`scale(${a.toFixed(10)} ${s.toFixed(10)}) rotate(-90)`),this.children[2].setAttribute("font-size",n.toFixed(10)),this.children[1].textContent=this.children[2].textContent=ye(this.value)}}for(let e=0;e<this._xAxisElement.children.length;e++)this._xAxisElement.children[e].textSize=n;for(let e=0;e<this._yAxisElement.children.length;e++)this._yAxisElement.children[e].textSize=n;const a=parseInt(1.5+Math.max(this.xResolution,this.yResolution));for(;a<this.#Pe.children.length;)this.#Pe.removeChild(this.#Pe.lastChild);for(let e=0;e<a;e++){let t=this.#Pe.children[e];if(!t){t=this.#Pe.appendChild(document.createElementNS("http://www.w3.org/2000/svg","g")),t.append(document.createElementNS("http://www.w3.org/2000/svg","line")),t.append(document.createElementNS("http://www.w3.org/2000/svg","line"));const e=t.appendChild(document.createElementNS("http://www.w3.org/2000/svg","text"));e.setAttribute("alignment-baseline","middle"),e.setAttribute("text-anchor","end");const n=t.appendChild(document.createElementNS("http://www.w3.org/2000/svg","text"));n.setAttribute("alignment-baseline","middle"),n.setAttribute("text-anchor","start"),t.update=function(){if(!i.#Ae)return;let e=(i._valueMax-i._valueMin)/(this.zResolution-1)*this.z+i._valueMin;this.z===this.zResolution-1&&(e=i._valueMax);let n=i.#De(e);n[0]=n[0].sort(((e,t)=>e[0]-t[0])),n[0][2]=Math.abs(i.#Ae.sinYaw),n[1]=n[1].sort(((e,t)=>e[0]-t[0])),n[1][2]=Math.abs(i.#Ae.cosYaw),n=n.sort(((e,t)=>e[0][0]-t[0][0])),this.children[0].setAttribute("x1",n[0][0][0].toFixed(10)),this.children[0].setAttribute("y1",n[0][0][1].toFixed(10)),this.children[0].setAttribute("x2",n[0][1][0].toFixed(10)),this.children[0].setAttribute("y2",n[0][1][1].toFixed(10)),this.children[1].setAttribute("x1",n[1][0][0].toFixed(10)),this.children[1].setAttribute("y1",n[1][0][1].toFixed(10)),this.children[1].setAttribute("x2",n[1][1][0].toFixed(10)),this.children[1].setAttribute("y2",n[1][1][1].toFixed(10)),this.children[2].textContent=this.children[3].textContent=ye(e);const a=this.textSize*i.#Ae.zoom,s=Math.abs(i.#Ae.cosPitch),l=180*Math.atan((n[0][1][1]-n[0][0][1])/(n[0][1][0]-n[0][0][0]))/Math.PI,r=180*Math.atan((n[1][0][1]-n[1][1][1])/(n[1][0][0]-n[1][1][0]))/Math.PI;let o=0;0===this.z&&(o=-a/2),this.z===this.zResolution-1&&(o=a/2),this.children[2].setAttribute("x",n[0][0][0].toFixed(10)),this.children[2].setAttribute("y",(n[0][0][1]+o).toFixed(10)),this.children[2].setAttribute("transform-origin",`${n[0][0][0].toFixed(10)} ${n[0][0][1].toFixed(10)}`),this.children[2].setAttribute("transform",`skewY(${l.toFixed(10)}) scale(${n[0][2].toFixed(10)} ${s})`),t.children[2].setAttribute("font-size",a.toFixed(10)),this.children[3].setAttribute("x",n[1][1][0].toFixed(10)),this.children[3].setAttribute("y",(n[1][1][1]+o).toFixed(10)),this.children[3].setAttribute("transform-origin",`${n[1][1][0]} ${n[1][1][1].toFixed(10)}`),this.children[3].setAttribute("transform",`skewY(${r.toFixed(10)}) scale(${n[1][2].toFixed(10)} ${s})`),t.children[3].setAttribute("font-size",a.toFixed(10))}}t.zResolution=a,t.textSize=n,t.z=e}function s(e){let t=`_v${e}`;return{get:function(){return this[t]},set:function(e){e=parseFloat(e),this[t]!==e&&(this[t]=e,this.value=(parseFloat(this.v1)+parseFloat(this.v2)+parseFloat(this.v3)+parseFloat(this.v4))/4)}}}for(this.style.setProperty("--xresolution",this.xResolution),this.style.setProperty("--yresolution",this.yResolution);Math.max(0,(this.xResolution-1)*(this.yResolution-1))<this.#we.children.length;)this.#we.removeChild(this.#we.lastChild);for(let e=0;e<(this.xResolution-1)*(this.yResolution-1);e++){let t=this.#we.children[e];t||(t=this.#we.appendChild(document.createElementNS("http://www.w3.org/2000/svg","path")),Object.defineProperty(t,"value",{get:function(){return this._value},set:function(e){e=parseFloat(e),this._value!==e&&(this._value=e,this.style.setProperty("--data-value",e))}}),t.update=function(){this.p1&&this.p2&&this.p3&&this.p4&&(this.depth=(this.p1[2]+this.p2[2]+this.p3[2]+this.p4[2])/4,isNaN(this.depth)||this.setAttribute("d",`M${this.p1[0].toFixed(10)},${this.p1[1].toFixed(10)}L${this.p2[0].toFixed(10)},${this.p2[1].toFixed(10)}L${this.p3[0].toFixed(10)},${this.p3[1].toFixed(10)}L${this.p4[0].toFixed(10)},${this.p4[1].toFixed(10)}Z`))},Object.defineProperty(t,"v1",s(1)),Object.defineProperty(t,"v2",s(2)),Object.defineProperty(t,"v3",s(3)),Object.defineProperty(t,"v4",s(4))),t.x1=t.x4=e%(this.xResolution-1),t.y1=t.y2=Math.trunc(e/(this.xResolution-1)),t.x2=t.x3=t.x1+1,t.y3=t.y4=t.y1+1}const l=[...this.#we.children];for(;this.xResolution*this.yResolution<this._valueElement.children.length;)this._valueElement.removeChild(this._valueElement.lastChild);for(let e=0;e<this.xResolution*this.yResolution;e++){let t=this._valueElement.children[e];t||(t=this._valueElement.appendChild(document.createElementNS("http://www.w3.org/2000/svg","circle")),Object.defineProperty(t,"value",{get:function(){return this._value},set:function(e){e=parseFloat(e),this._value!==e&&(this._value=e,this.style.setProperty("--data-value",e),e<i._valueMin&&(i._valueMin=e),e>i._valueMax&&(i._valueMax=e),this.update(),this.vp1&&(this.vp1.v1=e),this.vp2&&(this.vp2.v2=e),this.vp3&&(this.vp3.v3=e),this.vp4&&(this.vp4.v4=e))}}),Object.defineProperty(t,"p",{get:function(){return this.pp},set:function(e){e&&(null!=this.pp&&this.pp[0]===e[0]&&this.pp[1]===e[1]||(this.vp1&&(this.vp1.p1=e,this.vp1.v1=this.value),this.vp2&&(this.vp2.p2=e,this.vp2.v2=this.value),this.vp3&&(this.vp3.p3=e,this.vp3.v3=this.value),this.vp4&&(this.vp4.p4=e,this.vp4.v4=this.value)),this.pp=e,this.depth=e[2])}})),t.update=function(){if(!(this.p=i.#Ne(this.x,this.y,this.value)))return;const e=this.p;this.setAttribute("cx",e[0].toFixed(10)),this.setAttribute("cy",e[1].toFixed(10))},t.x=e%this.xResolution,t.y=Math.trunc(e/this.xResolution),t.vp1=l.find((e=>e.x1===t.x&&e.y1===t.y)),t.vp2=l.find((e=>e.x2===t.x&&e.y2===t.y)),t.vp3=l.find((e=>e.x3===t.x&&e.y3===t.y)),t.vp4=l.find((e=>e.x4===t.x&&e.y4===t.y))}}#Me(){const e=()=>{const e=be(this.value);this._valueMin=e[0],this._valueMax=e[1]};this.addEventListener("change",e),e(),this.#_e.addEventListener("wheel",(e=>(e.wheelDelta/120>0?this.zoom*=1.1:this.zoom*=.9,e.preventDefault(),e.stopPropagation(),!1)),{passive:!1}),this.#_e.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.#_e.addEventListener("mousedown",(e=>{var t=this.#_e.getBoundingClientRect(),i=e.pageX-t.left,n=e.pageY-t.top;let a,s,l,r;if([...this._valueElement.children].sort(((e,t)=>e.depth-t.depth)).forEach(((e,t)=>{let s=e.p[0]-i,l=e.p[1]-n;e.dist=Math.sqrt(s*s+l*l),(null==a||e.dist<a.dist)&&(a=e)})),a&&0===e.button){const t=a.x,i=a.y;this.selecting={startX:t,startY:i,endX:t,endY:i},r={pageY:e.pageY,closestCircle:a,value:a.value,mag:(this._valueMax-this._valueMin)/this.height}}else 1===e.button?(l={pageX:e.pageX,pageY:e.pageY,cameraX:this.cameraX,cameraY:this.cameraY},e.preventDefault()):2===e.button&&(s={pageX:e.pageX,pageY:e.pageY,yaw:this.yaw,pitch:this.pitch},e.preventDefault());if(r){const e=e=>{r.closestCircle.value=r.value+(r.pageY-e.pageY)*r.mag,this.dispatchEvent(new Event("change",{bubbles:!0}))},t=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)}if(l){const e=e=>{this.cameraX=l.cameraX+l.pageX-e.pageX,this.cameraY=l.cameraY+l.pageY-e.pageY},t=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)}if(s){const e=e=>{let t=s.yaw+s.pageX-e.pageX,i=Math.max(-90,Math.min(90,s.pitch+e.pageY-s.pageY));t===this.yaw&&i===this.pitch||(this.#Ie=t,this.#Ve=i,this.#Ae=UIGraph3D.transformPrecalc(this))},t=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)}}))}}customElements.define("ui-graph-3d",UIGraph3D,{extends:"div"});const Ne=[];class Calculation_2AxisTable extends UITemplate{static displayName="2 Axis Table";static outputTypes=["float"];static inputTypes=["float","float"];static template='<div data-element="dialog"></div>';GUID=Le();dialog=new UIDialog({buttonLabel:"Edit Table"});table=new UITableWithUnit({xAxis:[1,2,3,4,5,6,7,8],yAxis:[1,2,3,4,5,6,7,8]});graph=new UIGraph3D({width:800,height:450});constructor(e){super(),this.graph.addEventListener("change",(()=>{this.graph.width=Math.min(Math.max(600,75*this.graph.xResolution),1e3)})),this.table.addEventListener("change",(()=>{this.XSelection&&(this.XSelection.displayUnit=this.table.xDisplayUnit),this.YSelection&&(this.YSelection.displayUnit=this.table.yDisplayUnit)})),this.table.attachToTable(this.graph),this.dialog.content.append(this.graph),this.dialog.content.append(document.createElement("br")),this.dialog.content.append(this.table),this.noParameterSelection=!1,this.label="Value",this.Setup(e)}get label(){return this.table.zLabel}set label(e){this.table.zLabel=e,this.dialog.title=e}get xResolutionModifiable(){return this.table.xResolutionModifiable}set xResolutionModifiable(e){this.table.xResolutionModifiable=e}get xResolution(){return this.table.xResolution}set xResolution(e){this.table.xResolution=e}_xLabel="X";get xLabel(){return this._xLabel}set xLabel(e){this._xLabel!==e&&(this._xLabel=e,this.XSelection||(this.table.xLabel=e))}get xMeasurement(){return this.table.xMeasurement}set xMeasurement(e){this.table.xMeasurement=e}get xDisplayUnit(){return this.table.xDisplayUnit}set xDisplayUnit(e){this.table.xDisplayUnit=e}get xDisplayAxis(){return this.table.xDisplayAxis}set xDisplayAxis(e){this.table.xDisplayAxis=e}get xUnit(){return this.table.xUnit}set xUnit(e){this.table.xUnit=e}get xAxis(){return this.table.xAxis}set xAxis(e){this.table.xAxis=e}get yResolutionModifiable(){return this.table.yResolutionModifiable}set yResolutionModifiable(e){this.table.yResolutionModifiable=e}get yResolution(){return this.table.yResolution}set yResolution(e){this.table.yResolution=e}_yLabel="Y";get yLabel(){return this._yLabel}set yLabel(e){this._yLabel!==e&&(this._yLabel=e,this.YSelection||(this.table.yLabel=e))}get yMeasurement(){return this.table.yMeasurement}set yMeasurement(e){this.table.yMeasurement=e}get yDisplayUnit(){return this.table.yDisplayUnit}set yDisplayUnit(e){this.table.yDisplayUnit=e}get yDisplayAxis(){return this.table.yDisplayAxis}set yDisplayAxis(e){this.table.yDisplayAxis=e}get yUnit(){return this.table.yUnit}set yUnit(e){this.table.yUnit=e}get yAxis(){return this.table.yAxis}set yAxis(e){this.table.yAxis=e}get xOptions(){return this.XSelection?.options}set xOptions(e){if(!this.XSelection)return;this.XSelection.options=e;const t=this.XSelection.units;this.xMeasurement=Ce(t),this.xUnit=t}get yOptions(){return this.YSelection?.options}set yOptions(e){if(!this.YSelection)return;this.YSelection.options=e;const t=this.YSelection.units;this.yMeasurement=Ce(t),this.yUnit=t}get noParameterSelection(){return!this.XSelection&&!this.YSelection}set noParameterSelection(e){if(e)return this.XSelection=void 0,this.YSelection=void 0,this.table.xLabel=this.xLabel,void(this.table.yLabel=this.yLabel);this.XSelection?null==this._inputUnits?.[0]&&(this.xMeasurement=void 0):(this.XSelection=new UIParameterWithUnit({options:VariableRegister.GetSelections(void 0,h(this._inputUnits?.[0],["float"])),selectHidden:!0}),this.XSelection.unitHidden=!0,this.XSelection.addEventListener("change",(()=>{if(null==this._inputUnits?.[0]){const e=this.XSelection.units;this.xMeasurement=Ce(e),this.xUnit=e}})),this.table.xLabel=this.XSelection),this.YSelection?null==this._inputUnits?.[1]&&(this.yMeasurement=void 0):(this.YSelection=new UIParameterWithUnit({options:VariableRegister.GetSelections(void 0,h(this._inputUnits?.[1],["float"])),selectHidden:!0}),this.YSelection.unitHidden=!0,this.YSelection.addEventListener("change",(()=>{if(null==this._inputUnits?.[1]){const e=this.YSelection.units;this.yMeasurement=Ce(e),this.yUnit=e}})),this.table.yLabel=this.YSelection)}get min(){return this.table.min}set min(e){this.table.min=e}get max(){return this.table.max}set max(e){this.table.max=e}get step(){return this.table.step}set step(e){this.table.step=e}get displayUnit(){return this.table.displayUnit}set displayUnit(e){this.table.displayUnit=e}get displayValue(){return this.table.displayValue}set displayValue(e){this.table.displayValue=e}get measurement(){return this.table.measurement}set measurement(e){this.table.measurement=e}get valueUnit(){return this.table.valueUnit}set valueUnit(e){this.table.valueUnit=e}get value(){return{...super.value,table:this.table.saveValue,graph:void 0}}set value(e){const t=(e={...e}).table;delete e.table,null!=e.XSelection?.unit&&(this.xUnit=e.XSelection?.unit),null!=e.YSelection?.unit&&(this.yUnit=e.YSelection?.unit),super.value=e,this.table.saveValue=t}get saveValue(){let e=super.saveValue;return delete e.graph,e}set saveValue(e){const t=(e={...e}).table;delete e.table,null!=e.XSelection?.unit&&(this.xUnit=e.XSelection?.unit),null!=e.YSelection?.unit&&(this.yUnit=e.YSelection?.unit),super.saveValue=e,void 0!==t&&(this.table.saveValue=t)}_inputUnits;get inputUnits(){return[this.xUnit,this.yUnit]}set inputUnits(e){this._inputUnits=e?.[0],this.xOptions=VariableRegister.GetSelections(void 0,h(this._inputUnits?.[0],["float"])),this.yOptions=VariableRegister.GetSelections(void 0,h(this._inputUnits?.[1],["float"])),this.xUnit=e?.[0],this.yUnit=e?.[1],null!=e?.[0]&&(this.xMeasurement=Ce(e?.[0])),null!=e?.[1]&&(this.yMeasurement=Ce(e?.[1]))}_outputUnits;get outputUnits(){return this._outputUnits??[this.valueUnit]}set outputUnits(e){this._outputUnits=e,this.valueUnit=e?.[0],null!=e?.[0]&&(this.measurement=Ce(e?.[0]))}get displayUnits(){return[this.displayUnit]}set displayUnits(e){this.displayUnit=e?.[0]}RegisterVariables(){this.xOptions=VariableRegister.GetSelections(void 0,h(this._inputUnits?.[0],["float"])),this.yOptions=VariableRegister.GetSelections(void 0,h(this._inputUnits?.[0],["float"])),-1===Oe.variablesToPoll.indexOf(this.XSelection?.value)&&Oe.variablesToPoll.push(this.XSelection?.value),-1===Oe.variablesToPoll.indexOf(this.YSelection?.value)&&Oe.variablesToPoll.push(this.YSelection?.value),Oe.liveUpdateEvents[this.GUID]=(e,t)=>{if(this.XSelection?.value&&this.YSelection?.value){const i=e?.GetVariableId(this.XSelection?.value),n=e?.GetVariableId(this.YSelection?.value);null!=t?.[i]&&null!=t[n]&&this.table.trail(t[i],t[n])}}}}Ne.push(Calculation_2AxisTable),customElements.define("calculation-2axistable",Calculation_2AxisTable,{extends:"span"});class UIText extends HTMLInputElement{#e="";get value(){return this.#e}set value(e){this.#e!==e&&(super.value=this.#e=e,super.dispatchEvent(new Event("change",{bubbles:!0})))}get saveValue(){return this.value}set saveValue(e){this.value=e}constructor(e){super(),this.class="ui text",this.addEventListener("change",(()=>{this.#e=super.value})),Object.assign(this,e)}}customElements.define("ui-text",UIText,{extends:"input"});class CalculationOrVariableSelection_CalculationOrVariableSelection extends UITemplate{static template='<label><span data-element="labelElement"></span>:</label><div data-element="selection"></div><div data-element="liveUpdate"></div><span data-element="calculationContent"></span>';calculationContent=document.createElement("span");calculationValues=[];calculationSaveValueCache=[];get required(){return this.selection.selectDisabled}set required(e){this.selection.selectHidden=this.selection.selectDisabled=e}get selectName(){return this.selection.selectName}set selectName(e){this.selection.selectName=e}labelElement=document.createElement("span");get label(){return this.labelElement.textContent}set label(e){this.label!==e&&(this.labelElement.textContent=e,Object.keys(this.calculationValues).map((e=>this.calculationValues[e])).forEach((t=>{t.label=e})))}_xlabel="X";get xLabel(){return this._xlabel}set xLabel(e){this._xlabel!==e&&(this._xlabel=e,Object.keys(this.calculationValues).map((e=>this.calculationValues[e])).forEach((t=>{t.xLabel=e})))}_ylabel="Y";get yLabel(){return this._xlabel}set yLabel(e){this._ylabel!==e&&(this._ylabel=e,Object.keys(this.calculationValues).map((e=>this.calculationValues[e])).forEach((t=>{t.yLabel=e})))}selectionFilter=h;get outputTypes(){return this._outputUnits?void 0:this._outputTypes??this.GetSubConfigProperty("outputTypes")??(void 0!==this.selection.value?.unit||null==this.selection.value?.type?void 0:[this.selection.value?.type])}set outputTypes(e){this._outputTypes=e,Object.keys(this.calculationValues).map((e=>this.calculationValues[e])).forEach((t=>{"outputTypes"in t&&(t.outputTypes=e)})),this.options=VariableRegister.GetSelections(this.calculations,this.selectionFilter(this._outputUnits,this._outputTypes,this._inputTypes,this._inputUnits))}get outputUnits(){return this._outputUnits??this.GetSubConfigProperty("outputUnits")??(null!=this.selection.displayUnit?[this.selection.displayUnit]:void 0)}set outputUnits(e){this._outputUnits=e,Object.keys(this.calculationValues).map((e=>this.calculationValues[e])).forEach((t=>{"outputUnits"in t&&(t.outputUnits=e)})),this.options=VariableRegister.GetSelections(this.calculations,this.selectionFilter(this._outputUnits,this._outputTypes,this._inputTypes,this._inputUnits))}get inputTypes(){return this._inputUnits?void 0:this._inputTypes??this.GetSubConfigProperty("inputTypes")}set inputTypes(e){this._inputTypes=e,Object.keys(this.calculationValues).map((e=>this.calculationValues[e])).forEach((t=>{"inputTypes"in t&&(t.inputTypes=e)})),this.options=VariableRegister.GetSelections(this.calculations,this.selectionFilter(this._outputUnits,this._outputTypes,this._inputTypes,this._inputUnits))}get inputUnits(){return this._inputUnits??this.GetSubConfigProperty("inputUnits")}set inputUnits(e){this._inputUnits=e,Object.keys(this.calculationValues).map((e=>this.calculationValues[e])).forEach((t=>{"inputUnits"in t&&(t.inputUnits=e)})),this.options=VariableRegister.GetSelections(this.calculations,this.selectionFilter(this._outputUnits,this._outputTypes,this._inputTypes,this._inputUnits))}get options(){return this.selection.options}set options(e){this.selection.options=e,void 0===this.selection.selectedOption&&(this.selection.value=this.selection.selectValue)}selection=new UIParameterWithUnit({selectDisabled:!1,selectName:"None"});constructor(e){super(),e??={},this.liveUpdate=new UIDisplayLiveUpdate({valueUnit:e.outputUnits?.[0],displayUnit:e.displayUnits?.[0]}),this.liveUpdate.style.float="right",this.selection.addEventListener("change",(()=>{this.calculationContent.replaceChildren(this.SubConfig??""),this.liveUpdate.measurement=Ce(this.outputUnits?.[0]),null==this._outputUnits?.[0]?this.selection.unitHidden=!1:this.selection.unitHidden=!0})),this.style.display="block",this.Setup(e)}Setup(...e){super.Setup(...e),this.options=VariableRegister.GetSelections(this.calculations,this.selectionFilter(this._outputUnits,this._outputTypes,this._inputTypes,this._inputUnits))}static SaveOnlyActive=!1;get saveValue(){let e=super.saveValue??{};if(e.calculationValues={},CalculationOrVariableSelection_CalculationOrVariableSelection.SaveOnlyActive){let t=subConfig?.saveValue;null!=t&&(e.calculationValues[this.selection.value]=t)}else{for(const t in this.calculationValues)e.calculationValues[t]=this.calculationValues[t].saveValue;for(const t in this.calculationSaveValueCache)e.calculationValues[t]=this.calculationSaveValueCache[t]}return Object.keys(e.calculationValues).length<1&&delete e.calculationValues,"string"!=typeof this.selection.value&&(e.displayUnit=this.selection.displayUnit),e}set saveValue(e){if(e??={},Array.isArray(e.calculationValues))for(const t in e.calculationValues){const i=e.calculationValues[t]?.className;null!=i&&(this.calculationValues[i]?this.calculationValues[i].saveValue=e.calculationValues[t]:this.calculationSaveValueCache[i]=e.calculationValues[t])}else if(e.calculationValues)for(const t in e.calculationValues)this.calculationValues[t]?this.calculationValues[t].saveValue=e.calculationValues[t]:this.calculationSaveValueCache[t]=e.calculationValues[t];super.saveValue=e,this.selection.displayUnit=e.displayUnit}get value(){const e=this.SubConfig;return{...super.value,...void 0!==this.outputTypes&&this.outputTypes?.length>0&&{outputTypes:this.outputTypes},...void 0!==this.outputUnits&&this.outputUnits?.length>0&&{outputUnits:this.outputUnits},...void 0!==this.inputTypes&&this.inputTypes?.length>0&&{inputTypes:this.inputTypes},...void 0!==this.inputUnits&&this.inputUnits?.length>0&&{inputUnits:this.inputUnits},...null!=e&&{calculation:e.value}}}set value(e){this.selection.value=e?.selection;const t=this.SubConfig;t&&(t.value=e?.calculation),this.selection.displayUnit=e?.outputUnits?.[0]}RegisterVariables(e){if(e={...e},this.options=VariableRegister.GetSelections(this.calculations,this.selectionFilter(this._outputUnits,this._outputTypes,this._inputTypes,this._inputUnits)),!this.selection.value||!e)return;e.unit=this.outputUnits?.[0]??e.unit,e.unit?delete e.type:(delete e.unit,e.type=this.outputTypes?.[0]??e.type);const t=this.SubConfig;if(null!=t){const i=this.GetSubConfigProperty("outputUnits")??this.GetSubConfigProperty("outputTypes");void 0!==i&&i.length>0&&VariableRegister.RegisterVariable(e),t.RegisterVariables?.(e)}else e={...this.selection.value,name:e.name,id:this.selection.value.name},VariableRegister.RegisterVariable(e);this.liveUpdate.RegisterVariables(e)}get SubConfig(){if("string"!=typeof this.selection.value||!this.calculations)return;if(this.calculationValues[this.selection.value])return this.calculationValues[this.selection.value];let e=this.calculations;this.calculations[0]?.group||this.calculations[0]?.calculations||(e=[{group:"Calculations",calculations:this.calculations}]);for(const t in e){const i=e[t].calculations;for(const e in i)if(null!=i[e]&&i[e].name===this.selection.value)return this.calculationValues[this.selection.value]=new i[e],this.calculationValues[this.selection.value].Setup({noParameterSelection:this.noParameterSelection,label:this.label,xLabel:this.xLabel,yLabel:this.yLabel,...this._outputUnits&&{outputUnits:this._outputUnits},displayUnits:this.displayUnits,calculations:this.calculations}),null!=this.calculationSaveValueCache[this.selection.value]&&(this.calculationValues[this.selection.value].saveValue=this.calculationSaveValueCache[this.selection.value]),delete this.calculationSaveValueCache[this.selection.value],this.calculationValues[this.selection.value]}}GetSubConfigProperty(e){const t=this.SubConfig;return t?.[e]??t?.constructor?.[e]}}customElements.define("calculation-orvariableselection",CalculationOrVariableSelection_CalculationOrVariableSelection,{extends:"span"});class Calculation_Formula extends UITemplate{static displayName="Formula";static outputTypes=["bool|float"];static template='<div data-element="editFormula"></div><div data-element="editFormulaContent"><div style="display: flex; width: 100%"><div style="margin: auto; margin-right: 1em; width: fit-content; white-space: nowrap;"><div data-element="labelElement"></div> <div data-element="formulaUnit"></div> = </div><div data-element="formula"></div></div><div data-element="parameterElements"></div></div><div data-element="parameterValueElements"></div>';get outputUnits(){return[this.formulaUnit.textContent]}set outputUnits(e){this.formulaUnit.textContent=e?.[0]}labelElement=document.createElement("span");formulaUnit=document.createElement("span");editFormula=new UIDialog({buttonLabel:"Edit Formula"});formula=new UIText({class:"formula"});parameterElements=document.createElement("div");parameterValueElements=document.createElement("div");parameterValues={};parameterSaveValueCache={};parameterUnits={};get parameters(){return[...this.parameterValueElements.children].map((e=>e.name))}set parameters(e){for(let t in e)""===e[t]&&e.splice(t,1);for(;e.length<this.parameterValueElements.children.length;)this.parameterValueElements.removeChild(this.parameterValueElements.lastChild);for(;e.length<this.parameterElements.children.length;)this.parameterElements.removeChild(this.parameterElements.lastChild);for(let t=0;t<e.length;t++){let i=this.parameterValues[e[t]];i||(i=this.parameterValues[e[t]]=new CalculationOrVariableSelection_CalculationOrVariableSelection({label:e[t],calculations:this.calculations,outputTypes:["bool|float"],displayUnits:this.outputUnits}),i.style.display="inline");let n=this.parameterUnits[e[t]];n||(n=this.parameterUnits[e[t]]=new UIUnit({value:this.outputUnits?.[0]}),n.addEventListener("change",(()=>{const e=i.SubConfig;e&&(e.displayUnits=e.outputUnits=[n.value])})),i.selection.addEventListener("change",(()=>{const e=i.SubConfig;e&&(e.outputUnits=[n.value??this.outputUnits?.[0]])})),i.addEventListener("change",(()=>{const e=i.SubConfig;e?(null!=e.outputUnits?.[0]&&(n.value=e.outputUnits?.[0]),n.hidden=!1):n.hidden=!0})),i.SubConfig||(n.hidden=!0));let a=this.parameterElements.children[t];a||(a=this.parameterElements.appendChild(document.createElement("div"))),a.replaceChildren(i),a.appendChild(n);let s=this.parameterValueElements.children[t];if(!s){s=this.parameterValueElements.appendChild(document.createElement("span")),s.style.display="block";let e=s.appendChild(document.createElement("label"));e.append(document.createElement("span")),Object.defineProperty(s,"name",{get:function(){return this._name},set:function(e){this._name=e,this.firstChild.firstChild.innerText=e}}),e.append(":"),s.append(document.createElement("span"))}s.name=e[t],s.lastChild.replaceChildren(i.liveUpdate,i.calculationContent),""===i.calculationContent.innerHTML?s.hidden=!0:s.hidden=!1,i.selection.addEventListener("change",(()=>{""===i.calculationContent.innerHTML?s.hidden=!0:s.hidden=!1,0===[...this.parameterValueElements.children].filter((e=>!e.hidden)).length?(this.parameterValueElements.classList.remove("configContainer"),this.parameterValueElementshidden=!0):(this.parameterValueElements.classList.add("configContainer"),this.parameterValueElements.hidden=!1)}))}0===[...this.parameterValueElements.children].filter((e=>!e.hidden)).length?(this.parameterValueElements.classList.remove("configContainer"),this.parameterValueElementshidden=!0):(this.parameterValueElements.classList.add("configContainer"),this.parameterValueElements.hidden=!1)}get label(){return this.labelElement.textContent}set label(e){this.labelElement.textContent=e,this.editFormula.title=e+" Formula"}get value(){let e=super.value;e.parameterValues={};let t=this.parameters;for(let i in t)e.parameterValues[t[i]]=this.parameterValues[t[i]]?.value;return e}set value(e){e??={},super.value=e,Object.keys(this.parameterValues).filter((t=>null==e.parameterValues[t])).forEach((e=>{delete this.parameterValues[e]}));for(let t in e.parameterValues){let i=this.parameterValues[t]??=new CalculationOrVariableSelection_CalculationOrVariableSelection({label:t,calculations:this.calculations,outputTypes:["bool|float"],displayUnits:this.outputUnits});i.style.display="inline",i.value=e.parameterValues[t],this.parameterUnits[t]?this.parameterUnits[t].value=e.parameterValues[t].outputUnits?.[0]:saveValue.parameterUnits?.[t]&&i.SubConfig&&(i.SubConfig.outputUnits=e.parameterValues[t].outputUnits),i.value=e.parameterValues[t]}}get saveValue(){let e=super.saveValue??{};e.parameterValues={},e.parameterUnits={};for(let t in this.parameterValues)e.parameterValues[t]=this.parameterValues[t]?.saveValue,e.parameterUnits[t]=this.parameterUnits[t]?.value;return e}set saveValue(e){e??={},super.saveValue=e,Object.keys(this.parameterValues).filter((t=>null==e.parameterValues[t])).forEach((e=>{delete this.parameterValues[e]}));for(let t in e.parameterValues){let i=this.parameterValues[t]??=new CalculationOrVariableSelection_CalculationOrVariableSelection({label:t,calculations:this.calculations,outputTypes:["bool|float"],displayUnits:this.outputUnits});i.style.display="inline",i.saveValue=e.parameterValues[t],null!=e.parameterUnits?.[t]&&(this.parameterUnits[t]?this.parameterUnits[t].value=e.parameterUnits[t]:i.SubConfig&&(i.SubConfig.outputUnits=[e.parameterUnits[t]])),i.saveValue=e.parameterValues[t]}}constructor(e){super(),this.parameterElements.class="configContainer",this.parameterElements.style.display="block",this.parameterElements.style.minHeight="200px",this.parameterValueElements.hidden=!0,this.formula.addEventListener("change",(()=>{let e=["!","*","/","+","-",">=","<=",">","<","=","&","|"],t=this.formula.value.replaceAll(" ","");for(let i in e){let n=e[i];t=t.split(n).join(",")}let i=t.split(","),n=this.formula.value.replaceAll(" ","");for(let e=0;e<i.length;e++){let t=n.indexOf(i[e]);n=n.substring(0,t)+","+n.substring(t+i[e].length)}n=n.split(","),t="";for(let e=0;e<i.length;e++)if(""!==t&&(t+=","),t+=i[e],i[e].match(/[^,][(]/)&&")"!==i[e][i[e].length-1])for(;++e<i.length&&(t+=n[e]+i[e],")"!==i[e][i[e].length-1]););t=t.split(","),t=t.map((e=>"("===e[0]?e.substring(1):e)),t=t.map((e=>{for(;")"===e[e.length-1]&&e.split(")").length>e.split("(").length;)e=e.substring(0,e.length-1);return e})),t=t.filter((e=>!e.match(/^[0-9]*$/))),t=t.filter((e=>0!==e.length)),t=t.filter((e=>"self"!==e)),this.parameters=t})),this.Setup(e)}Setup(e){super.Setup(e),this.editFormula.content.innerHTML="",this.editFormula.content.append(this.querySelector('[data-element="editFormulaContent"]'))}RegisterVariables(e){if(e={...e}){e.unit=this.outputUnits?.[0]??e.unit,e.unit?delete e.type:(delete e.unit,e.type=this.outputTypes?.[0]??e.type),["*","/","+","-",">=","<=",">","<","=","&","|"].some((e=>this.formula.value.indexOf(e)>-1))?(this.parameters.forEach((t=>{this.parameterValues[t]?.RegisterVariables({name:`${e.name}_${this.parameterValues[t].label}`,unit:this.parameterValues[t].unit})})),VariableRegister.RegisterVariable(e)):this.parameterValues[this.parameters[0]]?.RegisterVariables(e)}}}Ne.push(Calculation_Formula),customElements.define("calculation-formula",Calculation_Formula,{extends:"span"});class UIGraph2D extends UITableBase{get xAxis(){return super.xAxis}set xAxis(e){super.xAxis=e,this._valueElement.update(),this.#ke.update(),this._xAxisElement.update(),this._yAxisElement.update()}get yAxis(){return super.yAxis}set yAxis(e){super.yAxis=e,this._valueElement.update(),this.#ke.update(),this._xAxisElement.update(),this._yAxisElement.update()}get axis(){return this.xResolution<2?this.yAxis:this.xAxis}set axis(e){this.xResolution<2?this.yAxis=e:this.xAxis=e}get selecting(){return super.selecting}set selecting(e){if(!xe(this.selecting,e)){if(this.#ke.querySelectorAll(".selected").forEach((e=>{e.classList.remove("selected")})),e&&null!=e.startX&&null!=e.endX&&null!=e.startY&&null!=e.endY)for(let t=0;t<this.#ke.children.length;t++){let i=this.#ke.children[t];Math.min(e.endX,e.startX)>parseInt(i.x1)||Math.max(e.endX,e.startX)<parseInt(i.x2)||Math.min(e.endY,e.startY)>parseInt(i.y1)||Math.max(e.endY,e.startY)<parseInt(i.y3)||i.classList.add("selected")}super.selecting=e}}get width(){return this.#_e.getAttribute("width")??this.offsetWidth??300}set width(e){this.#_e.setAttribute("width",e);const t=e/(7.5*Math.max(this.xResolution,this.yResolution)),i=t/2;this.#Fe=5*t,this.#Be=i+t,this.#je=i,this.#We=i,[...this._valueElement.children].forEach((e=>{e.textSize=t,e.setAttribute("r",i.toFixed(10)),e.update()})),[...this._xAxisElement.children].forEach((e=>{e.textSize=t,e.r=i,e.update()})),[...this._yAxisElement.children].forEach((e=>{e.textSize=t,e.r=i,e.update()})),[...this.#Pe.children].forEach((e=>{e.textSize=t,e.r=i,e.update()}))}get height(){return this.#_e.getAttribute("height")??this.offsetHeight??150}set height(e){this.#_e.setAttribute("height",e),[...this._valueElement.children].forEach((e=>{e.update()})),[...this._xAxisElement.children].forEach((e=>{e.update()})),[...this._yAxisElement.children].forEach((e=>{e.update()})),[...this.#Pe.children].forEach((e=>{e.update()}))}#Pe=document.createElementNS("http://www.w3.org/2000/svg","g");_xAxisElement=document.createElementNS("http://www.w3.org/2000/svg","g");_yAxisElement=document.createElementNS("http://www.w3.org/2000/svg","g");_valueElement=document.createElementNS("http://www.w3.org/2000/svg","g");#ke=document.createElementNS("http://www.w3.org/2000/svg","g");#_e=document.createElementNS("http://www.w3.org/2000/svg","svg");trail(e,t=0,i){}get _valueMin(){return super._valueMin}set _valueMin(e){super._valueMin=e,this._valueElement.update(),this.#ke.update(),this.#Pe.update()}get _valueMax(){return super._valueMax}set _valueMax(e){super._valueMax=e,this._valueElement.update(),this.#ke.update(),this.#Pe.update()}constructor(e){function t(){[...this.children].forEach((e=>{e.update()}))}super(),this.class="ui graph2d",this.append(this.#_e),this.#_e.setAttribute("overflow","visible"),this.#_e.append(this._xAxisElement),this.#_e.append(this._yAxisElement),this.#_e.append(this.#Pe),this.#_e.append(this.#ke),this.#_e.append(this._valueElement),this._xAxisElement.update=t,this._yAxisElement.update=t,this.#Pe.update=t,this._valueElement.update=t,this.#ke.update=t;const i=e.value;delete e.value,Object.assign(this,e),this.#Me(),this.value=i}#Fe=75;#Be=25;#We=25;#je=25;#Ne(e,t,i){if(isNaN(i))return;const n=this.axis,a=this.xResolution<2?t:e,s=n[n.length-1],l=n[0];let r=this.#Fe+(this.width-this.#Fe-this.#We)*(n[a]-l)/(s-l);isNaN(r)&&(r=0);let o=this.height-(this.#Be+(this.height-this.#Be-this.#je)*(i-this._valueMin)/(this._valueMax-this._valueMin));return isNaN(o)&&(o=0),[r,o]}#Re(e,t){const i=null==e?this.yAxis:this.xAxis,n=null==e?t:e,a=i[i.length-1],s=i[0];let l=this.#Fe+(this.width-this.#Fe-this.#We)*(i[n]-s)/(a-s);isNaN(l)&&(l=0);return[[l,this.height-this.#Be],[l,this.#je]]}#Ge(e){const t=this.#Fe,i=this.width-this.#We,n=this.height-(this.#Be+(this.height-this.#Be-this.#je)*(e-this._valueMin)/(this._valueMax-this._valueMin));return[[t,n],[i,n]]}_resolutionChanged(e,t){const i=this,n=this.width/(7.5*Math.max(this.xResolution,this.yResolution,t)),a=n/2;for(this.#Fe=5*n,this.#Be=a+n,this.#je=a,this.#We=a;t<e.children.length;)e.removeChild(e.lastChild);for(let n=e.children.length;n<t;n++){const t=e.appendChild(document.createElementNS("http://www.w3.org/2000/svg","g"));t.append(document.createElementNS("http://www.w3.org/2000/svg","line"));t.appendChild(document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("alignment-baseline","hanging"),t.update=function(){const e=i.#Re(this.x,this.y);this.children[0].setAttribute("x1",e[0][0]),this.children[0].setAttribute("y1",e[0][1]),this.children[0].setAttribute("x2",e[1][0]),this.children[0].setAttribute("y2",e[1][1]),this.children[1].setAttribute("x",e[0][0]),this.children[1].setAttribute("y",e[0][1]+this.r),this.children[1].setAttribute("font-size",this.textSize.toFixed(10)),this.children[1].textContent=ye(this.value)};const a=e.children[n-1]?.value,s=e.children[n-2]?.value;let l=0;null!=a&&null!=s&&(l=a+(a-s)),t.value=l,e===this._xAxisElement?t.x=n:t.y=n}for(let e=0;e<this._xAxisElement.children.length;e++){const t=this._xAxisElement.children[e];t.textSize=n,t.children[1]?.setAttribute("text-anchor","middle"),t.r=a}for(let e=0;e<this._yAxisElement.children.length;e++){const t=this._yAxisElement.children[e];t.textSize=n,t.children[1]?.setAttribute("text-anchor","middle"),t.r=a}this._xAxisElement.lastChild?.children[1]?.setAttribute("text-anchor","end"),this._yAxisElement.lastChild?.children[1]?.setAttribute("text-anchor","end"),this._xAxisElement.firstChild?.children[1]?.setAttribute("text-anchor","start"),this._yAxisElement.firstChild?.children[1]?.setAttribute("text-anchor","start"),this.xResolution<2?(this._xAxisElement.hidden=!0,this._yAxisElement.hidden=!1):(this._yAxisElement.hidden=!0,this._xAxisElement.hidden=!1);const s=parseInt(1.5+Math.max(this.xResolution,this.yResolution));for(;s<this.#Pe.children.length;)this.#Pe.removeChild(this.#Pe.lastChild);for(let e=0;e<s;e++){let t=this.#Pe.children[e];if(!t){t=this.#Pe.appendChild(document.createElementNS("http://www.w3.org/2000/svg","g")),t.append(document.createElementNS("http://www.w3.org/2000/svg","line"));t.appendChild(document.createElementNS("http://www.w3.org/2000/svg","text")).setAttribute("text-anchor","end"),t.update=function(){let e=(i._valueMax-i._valueMin)/(this.zResolution-1)*this.z+i._valueMin;this.z===this.zResolution-1&&(e=i._valueMax);let t=i.#Ge(e);this.children[0].setAttribute("x1",t[0][0]),this.children[0].setAttribute("y1",t[0][1]),this.children[0].setAttribute("x2",t[1][0]),this.children[0].setAttribute("y2",t[1][1]),this.children[1].setAttribute("x",t[0][0]-this.r),this.children[1].setAttribute("y",t[0][1]),this.children[1].setAttribute("font-size",this.textSize.toFixed(10)),this.children[1].textContent=ye(e)}}0===e?t.children[1].setAttribute("alignment-baseline","normal"):e===s-1?t.children[1].setAttribute("alignment-baseline","hanging"):t.children[1].setAttribute("alignment-baseline","middle"),t.textSize=n,t.zResolution=s,t.r=a,t.z=e}function l(e){let t=`v${e}`;return{get:function(){return parseFloat(this.dataset[t])},set:function(e){e=parseFloat(e),this[t]!==e&&(this.dataset[t]=e,this.value=(parseFloat(this.v1)+parseFloat(this.v2))/2)}}}for(this.style.setProperty("--xresolution",this.xResolution),this.style.setProperty("--yresolution",this.yResolution);Math.max(0,(this.xResolution-1)*this.yResolution)<this.#ke.children.length;)this.#ke.removeChild(this.#ke.lastChild);for(let e=0;e<(this.xResolution-1)*this.yResolution;e++){let t=this.#ke.children[e];t||(t=this.#ke.appendChild(document.createElementNS("http://www.w3.org/2000/svg","line")),Object.defineProperty(t,"value",{get:function(){return this._value},set:function(e){e=parseFloat(e),this._value!==e&&(this._value=e,this.style.setProperty("--data-value",e))}}),t.update=function(){this.p1&&this.p2&&(this.setAttribute("x1",this.p1[0]),this.setAttribute("y1",this.p1[1]),this.setAttribute("x2",this.p2[0]),this.setAttribute("y2",this.p2[1]))},Object.defineProperty(t,"v1",l(1)),Object.defineProperty(t,"v2",l(2))),t.xp1=t.xp2=e%(this.xResolution-1),t.xp1+1<this.xResolution&&t.xp2++,t.yp1=t.yp2=Math.trunc(e/(this.xResolution-1))}const r=[...this.#ke.children];for(;this.xResolution*this.yResolution<this._valueElement.children.length;)this._valueElement.removeChild(this._valueElement.lastChild);for(let e=0;e<this.xResolution*this.yResolution;e++){let t=this._valueElement.children[e];t||(t=this._valueElement.appendChild(document.createElementNS("http://www.w3.org/2000/svg","circle")),Object.defineProperty(t,"value",{get:function(){return this._value},set:function(e){e=parseFloat(e),this._value!==e&&(this._value=e,e<i._valueMin&&(i._valueMin=e),e>i._valueMax&&(i._valueMax=e),this.style.setProperty("--data-value",e),this.update(),this.vl1&&(this.vl1.v1=e),this.vl2&&(this.vl2.v2=e))}}),Object.defineProperty(t,"p",{get:function(){return this.dataset.p?JSON.parse(this.dataset.p):void 0},set:function(e){if(!e)return;const t=JSON.stringify(e);t!==this.dataset.p&&(this.dataset.p=t,e[0]=e[0].toFixed(10),e[1]=e[1].toFixed(10),this.vl1&&(this.vl1.p1=e,this.vl1.v1=this.value),this.vl2&&(this.vl2.p2=e,this.vl2.v2=this.value))}}),t.update=function(){if(!(this.p=i.#Ne(this.x,this.y,this.value)))return;const e=this.p;this.setAttribute("cx",e[0]),this.setAttribute("cy",e[1])}),t.x=e%this.xResolution,t.y=Math.trunc(e/this.xResolution),t.vl1=r.find((e=>e.xp1===t.x&&e.yp1===t.y)),t.vl2=r.find((e=>e.xp2===t.x&&e.yp2===t.y)),t.setAttribute("r",a.toFixed(10))}}#Me(){const e=()=>{const e=be(this.value);this._valueMin=e[0],this._valueMax=e[1]};this.addEventListener("change",e),e(),this.#_e.addEventListener("mousedown",(e=>{var t=this.#_e.getBoundingClientRect(),i=e.pageX-t.left,n=e.pageY-t.top;let a,s;if([...this._valueElement.children].sort(((e,t)=>e.depth-t.depth)).forEach(((e,t)=>{let s=e.p[0]-i,l=e.p[1]-n;e.dist=Math.sqrt(s*s+l*l),(null==a||e.dist<a.dist)&&(a=e)})),a&&0===e.button){const t=a.x,i=a.y;this.selecting={startX:t,startY:i,endX:t,endY:i};const n=this.axis,l=this.xResolution<2?this._yAxisElement.children[a.y]:this._xAxisElement.children[a.x];s={pageX:e.pageX,pageY:e.pageY,closestCircle:a,value:a.value,mag:(this._valueMax-this._valueMin)/(this.height-this.#je-this.#Be),axisElement:l,axisValue:l.value,axisMag:(n[n.length-1]-n[0])/(this.width-this.#Fe-this.#We)}}if(s){const e=e=>{s.closestCircle.value=s.value+(s.pageY-e.pageY)*s.mag,s.axisElement.value=s.axisValue+(e.pageX-s.pageX)*s.axisMag,this._boundAxis(s.axisElement.parentElement),this.dispatchEvent(new Event("change",{bubbles:!0}))},t=()=>{document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",t)}}))}}customElements.define("ui-graph-2d",UIGraph2D,{extends:"div"});class Calculation_LookupTable extends UITemplate{static displayName="Lookup Table";static outputTypes=["float"];static inputTypes=["float"];static template='<div data-element="dialog"></div>';GUID=Le();dialog=new UIDialog({buttonLabel:"Edit Table"});table=new UITableWithUnit({xAxis:[1,2,3,4,5,6,7,8],yResolution:1,yResolutionModifiable:!1});graph=new UIGraph2D({width:Math.min(Math.max(600,100*this.table.xResolution),1e3),height:450});constructor(e){super(),this.graph.addEventListener("change",(()=>{this.graph.width=Math.min(Math.max(600,75*this.graph.xResolution),1e3)})),this.table.addEventListener("change",(()=>{this.parameterSelection&&(this.parameterSelection.displayUnit=this.table.xDisplayUnit)})),this.table.attachToTable(this.graph),this.dialog.content.append(this.graph),this.dialog.content.append(document.createElement("br")),this.dialog.content.append(this.table),this.noParameterSelection=!1,this.label="Value",this.Setup(e)}get label(){return this.table.zLabel}set label(e){this.table.zLabel=e,this.dialog.title=e}get xResolutionModifiable(){return this.table.xResolutionModifiable}set xResolutionModifiable(e){this.table.xResolutionModifiable=e}get xResolution(){return this.table.xResolution}set xResolution(e){this.table.xResolution=e}_xLabel="X";get xLabel(){return this._xLabel}set xLabel(e){this._xLabel!==e&&(this._xLabel=e,this.parameterSelection||(this.table.xLabel=e))}get xMeasurement(){return this.table.xMeasurement}set xMeasurement(e){this.table.xMeasurement=e}get xDisplayUnit(){return this.table.xDisplayUnit}set xDisplayUnit(e){this.table.xDisplayUnit=e}get xDisplayAxis(){return this.table.xDisplayAxis}set xDisplayAxis(e){this.table.xDisplayAxis=e}get xUnit(){return this.table.xUnit}set xUnit(e){this.table.xUnit=e}get xAxis(){return this.table.xAxis}set xAxis(e){this.table.xAxis=e}get xOptions(){return this.parameterSelection?.options}set xOptions(e){if(!this.parameterSelection)return;this.parameterSelection.options=e;const t=this.parameterSelection.units;this.xMeasurement=Ce(t),this.xUnit=t}get noParameterSelection(){return!this.parameterSelection}set noParameterSelection(e){if(e)return this.parameterSelection=void 0,void(this.table.xLabel=this.xLabel);this.parameterSelection?null==this._inputUnits?.[0]&&(this.xMeasurement=void 0):(this.parameterSelection=new UIParameterWithUnit({options:VariableRegister.GetSelections(void 0,h(this._inputUnits?.[0],["float"])),selectHidden:!0}),this.parameterSelection.unitHidden=!0,this.parameterSelection.addEventListener("change",(()=>{if(null==this._inputUnits?.[0]){const e=this.parameterSelection.units;this.xMeasurement=Ce(e),this.xUnit=e}})),this.table.xLabel=this.parameterSelection)}get min(){return this.table.min}set min(e){this.table.min=e}get max(){return this.table.max}set max(e){this.table.max=e}get step(){return this.table.step}set step(e){this.table.step=e}get displayUnit(){return this.table.displayUnit}set displayUnit(e){this.table.displayUnit=e}get displayValue(){return this.table.displayValue}set displayValue(e){this.table.displayValue=e}get measurement(){return this.table.measurement}set measurement(e){this.table.measurement=e}get valueUnit(){return this.table.valueUnit}set valueUnit(e){this.table.valueUnit=e}get value(){return{...super.value,table:this.table.saveValue,graph:void 0}}set value(e){const t=(e={...e}).table;delete e.table,null!=e.parameterSelection?.unit&&(this.xUnit=e.parameterSelection?.unit),super.value=e,this.table.saveValue=t}get saveValue(){let e=super.saveValue;return delete e.graph,e}set saveValue(e){const t=e.table;delete(e={...e}).table,null!=e.parameterSelection?.unit&&(this.xUnit=e.parameterSelection?.unit),super.saveValue=e,void 0!==t&&(this.table.saveValue=t)}_inputUnits;get inputUnits(){return[this.xUnit]}set inputUnits(e){this._inputUnits=e?.[0],this.xOptions=VariableRegister.GetSelections(void 0,h(this._inputUnits?.[0],["float"])),this.xUnit=e?.[0],null!=e?.[0]&&(this.xMeasurement=Ce(e?.[0]))}get outputUnits(){return[this.valueUnit]}set outputUnits(e){this.valueUnit=e?.[0],null!=e?.[0]&&(this.measurement=Ce(e?.[0]))}get displayUnits(){return[this.displayUnit]}set displayUnits(e){this.displayUnit=e?.[0]}RegisterVariables(){this.xOptions=VariableRegister.GetSelections(void 0,h(this._inputUnits?.[0],["float"])),-1===Oe.variablesToPoll.indexOf(this.parameterSelection?.value)&&Oe.variablesToPoll.push(this.parameterSelection?.value),Oe.liveUpdateEvents[this.GUID]=(e,t)=>{if(this.parameterSelection?.value){const i=e?.GetVariableId(this.parameterSelection?.value);null!=t?.[i]&&this.table.trail(t[i])}}}}Ne.push(Calculation_LookupTable),customElements.define("calculation-lookuptable",Calculation_LookupTable,{extends:"span"});class Calculation_Polynomial extends HTMLDivElement{static displayName="Polynomial";static outputTypes=["float"];static inputTypes=["float"];#Ye=document.createElement("div");#ze=new UINumberWithUnit({value:0});#Xe=new UINumberWithUnit({value:1});#He=new UINumber({min:2,max:100,step:1,value:0});constructor(e){super(),this.class="configContainer";const t=document.createElement("label");t.textContent="Minimum Value:",this.append(t),this.#ze.displayUnitElement.hidden=!0,this.append(this.#ze),this.append(document.createElement("br"));const i=document.createElement("label");this.append(i),this.#Xe.displayUnitElement.hidden=!0,i.textContent="Maximum Value:",this.append(this.#Xe),this.append(document.createElement("br"));const n=document.createElement("label");n.textContent="Degree:",this.append(n),this.append(this.#He),this.append(document.createElement("br")),this.#He.addEventListener("change",(()=>{for(;this.#Ye.children.length>this.degree;)this.#Ye.removeChild(this.#Ye.lastChild);for(let e=this.#Ye.children.length;e<this.degree;e++){let t=this.#Ye.appendChild(document.createElement("div"));t.appendChild(0===e?new UINumberWithUnit({value:0}):new UINumber({value:0}));if(0!==e){t.appendChild(document.createElement("span")).innerHTML=`x<sup>${e}</sup> +`}t.style.display="inline",Object.defineProperty(t,"value",{get:function(){return this.firstChild.value},set:function(e){this.firstChild.value=e}})}})),this.degree=2,this.append(this.#Ye),this.#Ye.style.display="flex",this.#Ye.style.flexDirection="row-reverse",this.#Ye.style.alignItems="flex-start",this.#Ye.style.justifyContent="flex-end",this.#Ye.firstChild.addEventListener("change",(()=>{this.displayUnits=this.displayUnits})),this.Setup(e)}Setup(e){Object.assign(this,e)}get coeffecients(){return[...this.#Ye.children].map(((e,t)=>e.value))}set coeffecients(e){this.degree=e.length;for(let t=0;t<this.#Ye.children.length;t++)this.#Ye.children[t].value=e[t]}get minValue(){return this.#ze.value}set minValue(e){this.#ze.value=e}get maxValue(){return this.#Xe.value}set maxValue(e){this.#Xe.value=e}get degree(){return this.#He.value}set degree(e){this.#He.value=e}get displayUnit(){return this.#Ye.firstChild.firstChild.displayUnit}set displayUnit(e){this.#Ye.firstChild.firstChild.displayUnit=this.#Ye.firstChild.firstChild.valueUnit=e,this.#ze.displayUnit=this.#Xe.valueUnit=e,this.#Xe.displayUnit=this.#Xe.valueUnit=e,this.#Ye.firstChild.firstChild.displayUnit=e}get measurement(){return this.#Ye.firstChild.firstChild.measurement}set measurement(e){this.#Ye.firstChild.firstChild.measurement=e}get valueUnit(){return this.#Ye.firstChild.firstChild.valueUnit}set valueUnit(e){this.#Ye.firstChild.firstChild.displayUnit=this.#Ye.firstChild.firstChild.valueUnit=e,this.#ze.displayUnit=this.#Xe.valueUnit=e,this.#Xe.displayUnit=this.#Xe.valueUnit=e,this.#Ye.firstChild.firstChild.displayUnit=e}get value(){return{minValue:this.minValue,maxValue:this.maxValue,coeffecients:this.coeffecients,unit:this.valueUnit}}set value(e){e&&(this.minValue=e.minValue,this.maxValue=e.maxValue,this.coeffecients=e.coeffecients,this._outputUnits||(this.numberElement.displayUnit=e.unit))}get saveValue(){return{minValue:this.#ze.saveValue,maxValue:this.#Xe.saveValue,coeffecients:this.coeffecients,unit:this.displayUnit}}set saveValue(e){e&&(this.#ze.saveValue=e.minValue,this.#Xe.saveValue=e.maxValue,this.coeffecients=e.coeffecients,this.displayUnit=e.unit)}_outputUnits;get outputUnits(){return this._outputUnits??[this.valueUnit]}set outputUnits(e){this._outputUnits=e,this.valueUnit=e?.[0],null!=this.valueUnit&&(this.measurement=Ce(this.valueUnit))}get displayUnits(){return[this.displayUnit]}set displayUnits(e){this.displayUnit=e?.[0]}}Ne.push(Calculation_Polynomial),customElements.define("ui-polynomial",Calculation_Polynomial,{extends:"div"});class Calculation_Static extends UITemplate{static displayName="Static";static outputTypes=["float"];static template='<div data-element="numberElement"></div>';constructor(e){super(),this.numberElement=new UINumberWithUnit({valueUnit:e?.outputUnits?.[0],displayUnit:e?.displayUnits?.[0]}),this.Setup(e)}set class(e){this.numberElement.class=e}get min(){return this.numberElement.min}set min(e){this.numberElement.min=e}get max(){return this.numberElement.max}set max(e){this.numberElement.max=e}get step(){return this.numberElement.step}set step(e){this.numberElement.step=e}get displayUnit(){return this.numberElement.displayUnit}set displayUnit(e){this.numberElement.displayUnit=e}get displayValue(){return this.numberElement.displayValue}set displayValue(e){this.numberElement.displayValue=e}get measurement(){return this.numberElement.measurement}set measurement(e){this.numberElement.measurement=e}get valueUnit(){return this.numberElement.valueUnit}set valueUnit(e){this.numberElement.valueUnit=e}get value(){return this.numberElement.value}set value(e){this.numberElement.value=e}get saveValue(){return this.numberElement.saveValue}set saveValue(e){this.numberElement.saveValue=e}get outputUnits(){return[this.valueUnit]}set outputUnits(e){this.valueUnit=e?.[0],null!=e?.[0]&&(this.measurement=Ce(e?.[0]))}get displayUnits(){return[this.displayUnit]}set displayUnits(e){this.displayUnit=e?.[0]}}Ne.push(Calculation_Static),customElements.define("calculation-static",Calculation_Static,{extends:"span"});class GenericCalculation extends CalculationOrVariableSelection_CalculationOrVariableSelection{name=new UIText({class:"genericCalculationName"});get nameEditable(){return!this.name.disabled}set nameEditable(e){this.name.disabled=!e}constructor(e){const t=(e={calculations:Ne,selectionFilter:u,...e}).name??"Name";delete e.name,super(),super.Setup(e),this.labelElement.replaceWith(this.name),this.name.addEventListener("change",(()=>{this.label=this.name.value,this.name.parentElement.setAttribute("label",this.label)})),this.name.value=t}RegisterVariables(e){e={...e,name:void 0===e?.name?this.name.value:`${e.name}.${this.name.value}`},super.RegisterVariables(e)}get saveValue(){const e=super.saveValue;return{...e,name:this.nameEditable?e.name:void 0}}set saveValue(e){super.saveValue={...e,name:this.nameEditable?e.name:void 0}}}customElements.define("top-generic-calculation",GenericCalculation,{extends:"span"});class CAN_PackData extends UITemplate{static displayName="CAN Pack";static outputTypes=["CANData"];static inputTypes=[];static template='Offset:<div data-element="bitLocation"></div>Length:<div data-element="bitLength"></div><div data-element="multiplierLabel"></div><div data-element="multiplier"></div><div data-element="adderLabel"></div><div data-element="adder"></div><div data-element="variable"></div>';bitLocation=new UINumber({min:0,max:63,step:1,value:0,class:"canBitOffset"});bitLength=new UINumber({min:1,max:64,step:1,value:1,class:"canBitLength"});multiplierLabel=document.createElement("span");multiplier=new UINumber({value:1,class:"canMultiplier"});adderLabel=document.createElement("span");adder=new UINumber({value:0,class:"canAdder"});variable=new CalculationOrVariableSelection_CalculationOrVariableSelection({outputTypes:["bool"],calculations:Ne,template:'<div data-element="selection"></div><div data-element="liveUpdate"></div><span data-element="calculationContent"></span>'});constructor(e){super(),this.variable.style.display="inline",this.multiplierLabel.innerText="Multiplier:",this.adderLabel.innerText="Adder:",this.multiplier.hidden=this.multiplierLabel.hidden=this.adder.hidden=this.adderLabel.hidden=!0,this.bitLocation.addEventListener("change",(()=>{this.bitLength.max=64-this.bitLocation.value})),this.bitLength.addEventListener("change",(()=>{this.multiplier.hidden=this.multiplierLabel.hidden=this.adder.hidden=this.adderLabel.hidden=this.bitLength.value<2,this.variable.outputTypes=[this.bitLength.value<2?"bool":"float"]})),this.Setup(e)}RegisterVariables(e){}}customElements.define("can-pack-data",CAN_PackData,{extends:"span"});class CAN_ParseData extends UITemplate{static displayName="CAN Parse";static outputTypes=["bool|float"];static inputTypes=["CANData"];static template='<div data-element="name"></div>: Offset:<div data-element="bitLocation"></div>Length:<div data-element="bitLength"></div><div data-element="multiplierLabel"></div><div data-element="multiplier"></div><div data-element="adderLabel"></div><div data-element="adder"></div><div data-element="unit"></div><div data-element="liveUpdate"></div>';name=new UIText({class:"canParseDataName"});bitLocation=new UINumber({min:0,max:63,step:1,value:0,class:"canBitOffset"});bitLength=new UINumber({min:1,max:64,step:1,value:1,class:"canBitLength"});multiplierLabel=document.createElement("span");multiplier=new UINumber({value:1,class:"canMultiplier"});adderLabel=document.createElement("span");adder=new UINumber({value:0,class:"canAdder"});unit=new UIUnit;liveUpdate=new UIDisplayLiveUpdate;constructor(e){super(),this.multiplierLabel.innerText="Multiplier:",this.adderLabel.innerText="Adder:",this.multiplier.hidden=this.multiplierLabel.hidden=this.adder.hidden=this.adderLabel.hidden=this.unit.hidden=!0,this.liveUpdate.style.float="right",this.bitLocation.addEventListener("change",(()=>{this.bitLength.max=64-this.bitLocation.value})),this.bitLength.addEventListener("change",(()=>{this.multiplier.hidden=this.multiplierLabel.hidden=this.adder.hidden=this.adderLabel.hidden=this.unit.hidden=this.bitLength.value<2})),this.unit.addEventListener("change",(()=>{this.liveUpdate.valueUnit=this.bitLength.value<2?void 0:this.unit.value})),this.Setup(e)}RegisterVariables(e){(e={...e,name:`${e.name}.${this.name.value}`}).unit=this.unit.value??e.unit,e.unit&&this.bitLength.value>1?delete e.type:(delete e.unit,e.type=this.bitLength.value<2?"bool":"float"),VariableRegister.RegisterVariable(e),this.liveUpdate.RegisterVariables(e)}}customElements.define("can-parse-data",CAN_ParseData,{extends:"span"});class ConfigList extends HTMLDivElement{#qe=[];get staticItems(){return this.#qe}set staticItems(e){xe(this.#qe,e)||(this.#qe=e,this.#$e())}#$e(){this.staticItems.forEach(((e,t)=>{if(void 0!==[...this.children].find((t=>t.item===e.item)))return;const i=this.staticItems[t-1]?.item;if(void 0===i||void 0===[...this.children].find((e=>e.item===i))){let i=1,n=this.staticItems[t+i]?.item;for(;void 0!==n&&void 0===[...this.children].find((e=>e.item===n));)n=this.staticItems[++i]?.item;return void 0===n?this.appendNewItem(e.item):this.appendNewItem(e.item,[...this.children].find((e=>e.item===n)))}return this.appendNewItem(e.item,[...this.children].find((e=>e.item===i)).nextSibling)}))}constructor(e){super(),this.class="itemList",this.newItemElement=new UIButton({className:"controlnew"}),this.newItemElement.addEventListener("click",(()=>{this.appendNewItem(this.newItem())})),e??={};const t=e.saveValue??[],i=e.value;delete e.saveValue,delete e.value,Object.assign(this,e),null!=t&&(this.saveValue=t),null!=i&&(this.value=i)}updateControls(){for(let e=0;e<this.children.length;e++){const t=this.children[e].controlElement.children[1],i=this.children[e].controlElement.children[3],n=this.children[e].controlElement.children[5],a=void 0!==this.staticItems.find((t=>t.item===this.children[e].item));0===e||a&&void 0!==this.staticItems.find((t=>t.item===this.children[e-1].item))?(t.className="controldummy",t.disabled=!0):(t.className="controlup",t.disabled=!1),a?(i.className="controldummy",i.disabled=!0):(i.className="controldelete",i.disabled=!1),e===this.children.length-1||a&&void 0!==this.staticItems.find((t=>t.item===this.children[e+1].item))?(n.className="controldummy",n.disabled=!0):(n.className="controldown",n.disabled=!1)}this.lastChild?this.lastChild.controlElement.append(this.newItemElement):this.parentElement?.insertBefore?.(this.newItemElement,this),this.dispatchEvent(new Event("change",{bubbles:!0}))}appendNewItem(e,t){e=e??this.newItem();let i=document.createElement("div");i.classList.add("itemContainer"),i.style.display="flex",i.item=i.appendChild(e),i.item.classList.add("item"),i.controlElement=i.appendChild(document.createElement("span")),i.controlElement.classList.add("controlcontainer");let n=i.controlElement.appendChild(document.createElement("span"));n.className="controladd";const a=this;n.addEventListener("click",(function(){a.appendNewItem(a.newItem(),this.parentElement.parentElement)}));let s=i.controlElement.appendChild(document.createElement("span"));s.className="controlup",s.addEventListener("click",(function(){this.disabled||(this.parentElement.parentElement.previousSibling.before(this.parentElement.parentElement),a.updateControls())})),i.controlElement.appendChild(document.createElement("span")).className="controldummyfill";let l=i.controlElement.appendChild(document.createElement("span"));l.className="controldelete",l.addEventListener("click",(function(){this.disabled||(this.parentElement.parentElement.parentElement.removeChild(this.parentElement.parentElement),a.updateControls())})),i.controlElement.appendChild(document.createElement("span")).className="controldummyfill";let r=i.controlElement.appendChild(document.createElement("span"));r.className="controldown",r.addEventListener("click",(function(){this.disabled||(this.parentElement.parentElement.nextSibling.after(this.parentElement.parentElement),a.updateControls())})),i.RegisterVariables=function(e){this.item.RegisterVariables?.(e)},Object.entries(i.item).forEach((function([e,t]){void 0===i[e]&&Object.defineProperty(i,e,{get:function(){return this.item[e]},set:function(t){this.item[e]=t}})})),void 0===t?this.append(i):this.insertBefore(i,t),this.updateControls()}newItem(){return new(this.itemConstructor??this.constructor.itemConstructor)}get saveValue(){return[...this.children].map((e=>void 0!==this.staticItems.find((t=>t.item===e.item))?{[this.staticItems.find((t=>t.item===e.item))?.name]:e.item.saveValue}:e.item.saveValue))}set saveValue(e){for([...this.children].forEach((e=>{void 0!==this.staticItems.find((t=>t.item===e.item))&&this.removeChild(e)}));this.children.length>e.length;)this.removeChild(this.lastChild);for(let t=0;t<e.length;t++){const i=this.staticItems.find((i=>1===Object.keys(e[t]).length&&i.name===Object.keys(e[t])[0]))?.item;if(!this.children[t]||void 0!==i){const e=i??this.newItem();this.appendNewItem(e,this.children[t])}this.children[t].item.saveValue=i?e[t][Object.keys(e[t])[0]]:e[t]}this.#$e(),this.updateControls()}get value(){return[...this.children].map((e=>void 0!==this.staticItems.find((t=>t.item===e.item))?{[this.staticItems.find((t=>t.item===e.item))?.name]:e.item.value}:e.item.value))}set value(e){for([...this.children].forEach((e=>{void 0!==this.staticItems.find((t=>t.item===e.item))&&this.removeChild(e)}));this.children.length>e.length;)this.removeChild(this.lastChild);for(let t=0;t<e.length;t++){const i=this.staticItems.find((i=>1===Object.keys(e[t]).length&&i.name===Object.keys(e[t])[0]))?.item;if(!this.children[t]||void 0!==i){const e=i??this.newItem();this.appendNewItem(e,this.children[t])}this.children[t].item.value=i?e[t][Object.keys(e[t])[0]]:e[t]}this.#$e()}RegisterVariables(e){for(var t=0;t<this.children.length;t++)this.children[t].RegisterVariables(e)}}customElements.define("top-config-list",ConfigList,{extends:"div"});const Re=[];class CAN_ReadData extends UITemplate{static displayName="CAN Read";static template='<div data-element="canBusLabel"></div><div data-element="canBus"></div><div data-element="canIDLabel"></div><div data-element="canID"></div><div data-element="parseData"></div>';canIDLabel=document.createElement("span");canID=new UINumber({min:0,max:536870911,step:1,value:0});canBusLabel=document.createElement("span");canBus=new UISelection({value:0,selectHidden:!0,class:"can-bus-selection"});parseData=new ConfigList({itemConstructor:CAN_ParseData,saveValue:[{}],class:"configContainer"});constructor(e){super(),this.canBusLabel.innerText="Bus:",this.canIDLabel.innerText="Identifier:",document.addEventListener("change",(e=>{e.target instanceof UIPinOverlay&&this.updateOptions(e.target.pinOut)})),this.updateOptions(document.querySelectorAll(".pinoverlay")[0]?.pinOut),this.Setup(e)}updateOptions(e){var t=[];if(e){for(var i=0;i<e.CANBusCount;i++)t.push({name:i,value:i});this.canBus.options=t,t.length<2&&(this.canBusLabel.hidden=!0,this.canBus.hidden=!0)}}RegisterVariables(e){this.parseData.RegisterVariables(e)}}Re.push(CAN_ReadData),customElements.define("can-read-data",CAN_ReadData,{extends:"span"});class CAN_WriteData extends UITemplate{static displayName="CAN Write";static template='<div data-element="canBusLabel"></div><div data-element="canBus"></div><div data-element="canIDLabel"></div><div data-element="canID"></div>Interval:<div data-element="interval"></div><div data-element="packData"></div>';canIDLabel=document.createElement("span");canID=new UINumber({min:0,max:536870911,step:1,value:0});canBusLabel=document.createElement("span");canBus=new UISelection({value:0,selectHidden:!0,class:"can-bus-selection"});interval=new UISelection({value:100,options:[{name:"100Hz",value:100},{name:"33Hz",value:33},{name:"25Hz",value:25},{name:"20Hz",value:20},{name:"10Hz",value:10},{name:"5Hz",value:5},{name:"4Hz",value:4},{name:"3Hz",value:3},{name:"2Hz",value:2},{name:"1Hz",value:1}],selectHidden:!0,class:"can-write-interval"});packData=new ConfigList({itemConstructor:CAN_PackData,saveValue:[{}],class:"configContainer"});constructor(e){super(),this.canBusLabel.innerText="Bus:",this.canIDLabel.innerText="Identifier:",document.addEventListener("change",(e=>{e.target instanceof UIPinOverlay&&this.updateOptions(e.target.pinOut)})),this.updateOptions(document.querySelectorAll(".pinoverlay")[0]?.pinOut),this.Setup(e)}updateOptions(e){var t=[];if(e){for(var i=0;i<e.CANBusCount;i++)t.push({name:i,value:i});this.canBus.options=t,t.length<2&&(this.canBusLabel.hidden=!0,this.canBus.hidden=!0)}}RegisterVariables(e){this.packData.RegisterVariables(e)}}Re.push(CAN_WriteData),customElements.define("can-write-data",CAN_WriteData,{extends:"span"});const De=[];let ke=[];ke.push(Calculation_Static),ke.push(Calculation_LookupTable),ke.push(Calculation_2AxisTable),ke.push(Calculation_Formula);const Fe=ke;class CylinderAirmass_AlphaN extends UITemplate{static displayName="Alpha N";static outputUnits=["g"];static Requirements=["Throttle Position"];static template='<div data-element="Airmass"></div>';Airmass=new CalculationOrVariableSelection({calculations:Fe,label:"Airnass",outputUnits:["g"],displayUnits:["g"]});constructor(e){super(),this.style.display="block",this.Setup(e)}}De.push(CylinderAirmass_AlphaN),customElements.define("cylinderairmass-alphan",CylinderAirmass_AlphaN,{extends:"span"});class CylinderAirmass_SpeedDensity extends UITemplate{static displayName="Speed Density";static outputUnits=["g"];static Requirements=["Cylinder Air Temperature","Manifold Absolute Pressure","Volumetric Efficiency"];static template='<label>Cylinder Volume:</label><div data-element="CylinderVolume"></div>';constructor(e){super(),this.CylinderVolume=new UINumberWithUnit({value:.66594,step:.001,min:.001,measurement:"Volume",valueUnit:"L",displayUnit:"mL"}),this.style.display="block",this.Setup(e)}}De.push(CylinderAirmass_SpeedDensity),customElements.define("cylinderairmass-speeddensity",CylinderAirmass_SpeedDensity,{extends:"span"});let Be=[];Be.push(Calculation_Static);const je=Be;class InjectorPulseWidth_DeadTime extends UITemplate{static displayName="Dead Time";static outputUnits=["s"];static template='<div data-element="FlowRate"></div><div data-element="DeadTime"></div><label>Min Injector Fuel Mass:</label><div data-element="MinInjectorFuelMass"></div>';FlowRate=new CalculationOrVariableSelection({calculations:GenericConfigs,label:"Injector Flow Rate",outputUnits:["g/s"]});DeadTime=new CalculationOrVariableSelection({calculations:GenericConfigs,label:"Injector Dead Time",outputUnits:["s"],displayUnits:["ms"]});MinInjectorFuelMass=new UINumberWithUnit({value:.005,step:.001,measurement:"Mass",valueUnit:"g",displayUnit:"mg"});constructor(e){super(),this.style.display="block",this.Setup(e)}RegisterVariables(){this.DeadTime.RegisterVariables({name:"FuelParameters.Injector Dead Time"}),this.FlowRate.RegisterVariables({name:"FuelParameters.Injector Flow Rate"})}}je.push(InjectorPulseWidth_DeadTime),customElements.define("injectorpulsewidth-deadtime",InjectorPulseWidth_DeadTime,{extends:"span"});const We=[];class Input_Analog extends UITemplate{static displayName="Analog Pin";static outputUnits=["V"];static template='<label>Pin:</label><div data-element="pin"></div>';pin=new UIPinSelection({value:65535,pinType:"analog"});constructor(e){super(),this.style.display="block",this.Setup(e)}}We.push(Input_Analog),customElements.define("input-analog",Input_Analog,{extends:"span"});class Input_AnalogPolynomial extends UITemplate{static outputTypes=["float"];static template='<div data-element="voltageLiveUpdate"></div><div data-element="analogInput"></div><div data-element="polynomial"></div>';get displayUnit(){return this.polynomial.displayUnit}set displayUnit(e){this.polynomial.displayUnit=e}get measurement(){return this.polynomial.measurement}set measurement(e){this.polynomial.measurement=e}get valueUnit(){return this.polynomial.valueUnit}set valueUnit(e){this.polynomial.valueUnit=e}get outputUnits(){return this.polynomial.outputUnits}set outputUnits(e){this.polynomial.outputUnits=e}get displayUnits(){return this.polynomial.displayUnits}set displayUnits(e){this.polynomial.displayUnits=e}analogInput=new Input_Analog;polynomial=new Calculation_Polynomial;voltageLiveUpdate=new UIDisplayLiveUpdate({valueUnit:Input_Analog.outputUnits[0]});constructor(e){super(),this.voltageLiveUpdate.style.float="right",this.Setup(e),this.style.display="block"}RegisterVariables(e){delete(e={...e}).unit,delete e.type,delete e.id,VariableRegister.RegisterVariable({...e,unit:"V"}),this.voltageLiveUpdate.RegisterVariables({...e,unit:"V"})}}customElements.define("input-analogpolynomial",Input_AnalogPolynomial,{extends:"span"});class UICheckBox extends HTMLInputElement{#e=!1;get value(){return this.#e}set value(e){this.#e!==e&&(this.checked=this.#e=e,super.dispatchEvent(new Event("change",{bubbles:!0})))}get saveValue(){return this.value}set saveValue(e){this.value=e}constructor(e){super(),this.type="checkbox",this.class="ui checkbox",Object.assign(this,e)}}customElements.define("ui-checkbox",UICheckBox,{extends:"input"});class Input_Digital extends UITemplate{static displayName="Digital Pin";static outputTypes=["bool"];static template='<label>Pin:</label><div data-element="pin"></div><div data-element="inverted"></div>Inverted';inverted=new UICheckBox;pin=new UIPinSelection({value:65535,pinType:"digitalin"});constructor(e){super(),this.style.display="block",this.Setup(e)}}We.push(Input_Digital),customElements.define("input-digital",Input_Digital,{extends:"span"});class Input_DigitalRecord extends UITemplate{static displayName="Digital Pin (Record)";static outputTypes=["Record"];static template='<label>Pin:</label><div data-element="pin"></div><div data-element="inverted"></div>Inverted<br/><label>Length:</label><div data-element="length"></div>';inverted=new UICheckBox;pin=new UIPinSelection({value:65535,pinType:"digitalinterrupt"});length=new UINumber({value:2,step:1,min:1,max:1e3});constructor(e){super(),this.style.display="block",this.Setup(e)}}We.push(Input_DigitalRecord),customElements.define("input-digitalrecord",Input_DigitalRecord,{extends:"span"});class Input_DutyCycle extends UITemplate{static displayName="Duty Cycle Pin Pin";static outputUnits=["[0.0-1.0]"];static template='<label>Pin:</label><div data-element="pin"></div><br/><label>Minimum Frequency:</label><div data-element="minFrequency"></div>';pin=new UIPinSelection({value:65535,pinType:"pwm"});minFrequency=new UINumberWithUnit({value:1e3,step:1,min:0,max:65535,measurement:"Frequency",valueUnit:"Hz"});constructor(e){super(),this.style.display="block",this.Setup(e)}}We.push(Input_DutyCycle),customElements.define("input-dutycycle",Input_DutyCycle,{extends:"span"});class Input_Frequency extends UITemplate{static displayName="Frequency Pin";static outputUnits=["Hz"];static template='<label>Pin:</label><div data-element="pin"></div><br/><label>Minimum Frequency:</label><div data-element="minFrequency"></div>';pin=new UIPinSelection({value:65535,pinType:"pwm"});minFrequency=new UINumberWithUnit({value:1e3,step:1,min:0,max:65535,measurement:"Frequency",valueUnit:"Hz"});constructor(e){super(),this.style.display="block",this.Setup(e)}}We.push(Input_Frequency),customElements.define("input-frequency",Input_Frequency,{extends:"span"});class Input_PulseWidth extends UITemplate{static displayName="Pulse Width Pin";static outputUnits=["s"];static template='<label>Pin:</label><div data-element="pin"></div><br/><label>Minimum Frequency:</label><div data-element="minFrequency"></div>';pin=new UIPinSelection({value:65535,pinType:"pwm"});minFrequency=new UINumberWithUnit({value:1e3,step:1,min:0,max:65535,measurement:"Frequency",valueUnit:"Hz"});constructor(e){super(),this.style.display="block",this.Setup(e)}}We.push(Input_PulseWidth),customElements.define("input-pulsewidth",Input_PulseWidth,{extends:"span"});const Ge=[{group:"Generic Pin Input",calculations:We},{group:"Custom Input",calculations:[Calculation_Static,Calculation_LookupTable,Calculation_Polynomial]}];class Input extends UITemplate{static template='<div style="float: right;"></div><div data-element="translationConfig"></div><div data-element="hr"></div><div data-element="rawConfig"></div>';get outputTypes(){return this.translationConfig.outputTypes}set outputTypes(e){this.translationConfig.outputTypes=e}get outputUnits(){return this.translationConfig.outputUnits}set outputUnits(e){this.translationConfig.outputUnits=e}hr=document.createElement("hr");name=new UIText({class:"pinselectname inputName"});translationConfig=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Ge,selectionFilter:function(){return function(e){return!e.type&&!e.unit}},noParameterSelection:!0});rawConfig=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Ge,selectionFilter:u,label:"Source",inputTypes:[],noParameterSelection:!0,hidden:!0});constructor(e){super(),this.style.display="block",this.name.addEventListener("change",(()=>{this.translationConfig.label=this.name.value})),this.translationConfig.addEventListener("change",(()=>{this.translationConfig.inputUnits=this.translationConfig.inputTypes=void 0,0===(this.translationConfig.inputUnits?.length??this.translationConfig.inputTypes?.length??0)?(this.hr.hidden=!0,this.rawConfig.hidden=!0,this.rawConfig.selection.value=void 0):(this.hr.hidden=!1,this.rawConfig.hidden=!1)})),this.translationConfig.labelElement.replaceWith(this.name),this.rawConfig.addEventListener("change",(()=>{this.rawConfig.outputUnits?.[0]&&(this.translationConfig.inputUnits=this.rawConfig.outputUnits,this.translationConfig.xLabel=Ce(this.rawConfig.outputUnits?.[0]))})),this.hr.hidden=!0,this.hr.style.margin="2px",e??={},this.name.value=e.name??"Name",delete e.name,this.Setup(e)}RegisterVariables(){const e={name:`Inputs.${this.name.value}`};this.translationConfig.RegisterVariables?.(e),0!==(this.translationConfig.inputUnits?.length??this.translationConfig.inputTypes?.length??0)&&this.rawConfig.RegisterVariables?.(e)}}customElements.define("config-input",Input,{extends:"span"});let Ye=[];Ge.unshift({group:"MAP Sensors",calculations:Ye});const ze=Ye;class MAP_GM1Bar extends Input_AnalogPolynomial{static displayName="GM 1 Bar MAP";static outputUnits=["Bar"];get saveValue(){return this.analogInput.saveValue}set saveValue(e){return this.analogInput.saveValue=e}constructor(e){super(e),this.outputUnits=this.constructor.outputUnits,this.polynomial.hidden=!0,this.polynomial.minValue=.1,this.polynomial.maxValue=1.05;let t=[];t[0]=.101515151515152,t[1]=.18987012987013,this.polynomial.coeffecients=t}}ze.push(MAP_GM1Bar),customElements.define("map-gm1bar",MAP_GM1Bar,{extends:"span"});class MAP_GM2Bar extends Input_AnalogPolynomial{static displayName="GM 2 Bar MAP";static outputUnits=["Bar"];get saveValue(){return this.analogInput.saveValue}set saveValue(e){return this.analogInput.saveValue=e}constructor(e){super(e),this.outputUnits=this.constructor.outputUnits,this.polynomial.hidden=!0,this.polynomial.minValue=.088,this.polynomial.maxValue=2.08;let t=[];t[0]=.082718614718615,t[1]=.398493506493506,this.polynomial.coeffecients=t}}ze.push(MAP_GM2Bar),customElements.define("map-gm2bar",MAP_GM2Bar,{extends:"span"});class MAP_GM3Bar extends Input_AnalogPolynomial{static displayName="GM 3 Bar MAP";static outputUnits=["Bar"];get saveValue(){return this.analogInput.saveValue}set saveValue(e){return this.analogInput.saveValue=e}constructor(e){super(e),this.outputUnits=this.constructor.outputUnits,this.polynomial.hidden=!0,this.polynomial.minValue=.036,this.polynomial.maxValue=3.15;let t=[];t[0]=.016952380952381,t[1]=.628,this.polynomial.coeffecients=t}}ze.push(MAP_GM3Bar),customElements.define("map-gm3bar",MAP_GM3Bar,{extends:"span"});const Xe=[];class Output_Digital extends UITemplate{static displayName="Digital Pin";static inputTypes=["bool"];static template='<label>Pin:</label><div data-element="pin"></div><div data-element="inverted"></div>Inverted <div data-element="highZ"></div>High Z';pin=new UIPinSelection({value:65535,pinType:"digitalout"});constructor(e){super(),this.inverted=new UICheckBox,this.highZ=new UICheckBox,this.style.display="block",this.Setup(e)}}Xe.push(Output_Digital),customElements.define("output-digital",Output_Digital,{extends:"span"});class Output_TDC extends CalculationOrVariableSelection_CalculationOrVariableSelection{static inputTypes=["bool"];TDC=new UINumber({value:0,step:1,min:0,max:720});constructor(e){super(),this.inputTypes=["bool"],this.required=!0,this.calculations=Xe;let t=document.createElement("span");t.append("      TDC:"),t.append(this.TDC),t.append("°"),this.Setup(e),this.labelElement.parentElement.append(t),this.labelElement.class="pinselectname",this.selection.addEventListener("change",(()=>{this.options.map((e=>e.options?.length??1)).reduce(((e,t)=>e+t),0)<2&&this.SubConfig?.querySelectorAll("label").length<2?(this.selection.hidden=!0,void 0===this.subConfigLabel&&(this.subConfigLabel=this.SubConfig.firstChild,this.SubConfig.firstChild.remove(),this.SubConfig.style.display="")):void 0!==this.subConfigLabel&&void 0!==this.SubConfig&&(this.SubConfig.insertBefore(this.subConfigLabel,this.SubConfig.firstChild),this.SubConfig.style.display="block")})),this.selection.dispatchEvent(new Event("change",{bubbles:!0}))}}customElements.define("output-tdc",Output_TDC,{extends:"span"});class ConfigContainer extends UITemplate{labelElement=document.createElement("span");get label(){return this.labelElement.textContent}set label(e){this.labelElement.textContent=e}Setup(e){super.Setup({...e,template:`<span data-element="labelElement"></span><div class="configContainer">${e?.template??this.setup??this.constructor.template}</div>`})}}customElements.define("top-config-container",ConfigContainer,{extends:"span"});class OutputList extends ConfigContainer{static template='<div data-element="Outputs"></div>';OutputCount=new UINumber({value:8});labelAndCountElement=document.createElement("div");Outputs=document.createElement("div");constructor(e){super(),this.OutputCount.addEventListener("change",(()=>{const e=this.OutputCount.value;let t=this.saveValue;t.splice(e);for(let i=t.length;i<e;i++)t[i]={};this.saveValue=t})),this.Setup(e),void 0===e.value&&(this.value=new Array(8))}get saveValue(){return[...this.Outputs.children].map((e=>e.saveValue))}set saveValue(e){for(this.OutputCount.value=e.length;this.Outputs.children.length>e.length;)this.Outputs.removeChild(this.Outputs.lastChild);for(let t=0;t<e.length;t++)this.Outputs.children[t]||this.Outputs.append(output),this.Outputs.children[t].saveValue=e[t]}get value(){return[...this.Outputs.children].map((e=>e.value))}set value(e){for(this.OutputCount.value=e.length;this.Outputs.children.length>e.length;)this.Outputs.removeChild(this.Outputs.lastChild);for(let t=0;t<e.length;t++){if(!this.Outputs.children[t]){const e=this.newOutput(t);this.Outputs.append(e)}this.Outputs.children[t].value=e[t]}}Setup(e){super.Setup(e),this.labelElement.replaceWith(this.labelAndCountElement),this.labelAndCountElement.append(this.labelElement),this.labelAndCountElement.append(this.OutputCount)}RegisterVariables(){for(let e=0;e<this.Outputs.children.length;e++)this.Outputs.children[e].RegisterVariables()}}customElements.define("top-injector-outputs",OutputList,{extends:"span"});class Reluctor_Template extends Input_DigitalRecord{static outputTypes=["ReluctorResult"];static template=Input_DigitalRecord.template.substring(0,Input_DigitalRecord.template.lastIndexOf("Inverted")+8);RegisterVariables(e){delete(e={...e}).unit,delete e.id,e.type="Record",VariableRegister.RegisterVariable(e)}}customElements.define("reluctor-template",Reluctor_Template,{extends:"span"});let He=[];Ge.unshift({group:"Reluctor Decoders",calculations:He});const qe=He;class Reluctor_GM24x extends Reluctor_Template{static displayName="Reluctor GM 24X";constructor(e){super(e),this.length.value=100}}qe.push(Reluctor_GM24x),customElements.define("reluctor-gm24x",Reluctor_GM24x,{extends:"span"});class Reluctor_Universal1x extends Reluctor_Template{static displayName="Reluctor Universal 1X";static template=Reluctor_Template.template+'<br/><label>Capture On:</label><div data-element="mode"></div><span data-element="rising"><br/><label>Rising Edge Position:</label><div data-element="risingPosition"></div></span><span data-element="falling"><br/><label>Falling Edge Position:</label><div data-element="fallingPosition"></div></span>';mode=new UISelection({options:[{name:"Both Edges",value:0},{name:"Rising Edge",value:1},{name:"Falling Edge",value:2}],value:0,selectHidden:!0});risingPosition=new UINumberWithUnit({value:0,step:.1,min:0,max:360,measurement:"Angle",valueUnit:"°"});fallingPosition=new UINumberWithUnit({value:180,step:.1,min:0,max:360,measurement:"Angle",valueUnit:"°"});constructor(e){super(),this.mode.addEventListener("change",(e=>{this.querySelectorAll('[data-element="rising"]')[0].hidden=!(0===this.mode.value||1===this.mode.value),this.querySelectorAll('[data-element="falling"]')[0].hidden=!(0===this.mode.value||2===this.mode.value)})),this.Setup(e),this.length.value=8}}qe.push(Reluctor_Universal1x),customElements.define("reluctor-universal1x",Reluctor_Universal1x,{extends:"span"});class Reluctor_UniversalMissingTeeth extends Reluctor_Template{static displayName="Reluctor Universal Missing Teeth";static template=Reluctor_Template.template+'<br/><label>First Tooth Position:</label><div data-element="firstToothPosition"></div>(Falling Edge)<br/><label>Tooth Width:</label><div data-element="toothWidth"></div><br/><label>Number of Teeth:</label><div data-element="numberOfTeeth"></div><br/><label>Number of Teeth Missing:</label><div data-element="numberOfTeethMissing"></div>';firstToothPosition=new UINumberWithUnit({value:0,step:.1,min:0,max:360,measurement:"Angle",valueUnit:"°"});toothWidth=new UINumberWithUnit({value:5,step:.1,min:0,max:360,measurement:"Angle",valueUnit:"°"});numberOfTeeth=new UINumber({value:36,min:2});constructor(e){super(),this.length.value=72,this.numberOfTeeth.addEventListener("change",(()=>{this.length.value=2*this.numberOfTeeth.value})),this.numberOfTeethMissing=new UINumber({value:1,min:1}),this.Setup(e)}}qe.push(Reluctor_UniversalMissingTeeth),customElements.define("reluctor-universalmissingteeth",Reluctor_UniversalMissingTeeth,{extends:"span"});let $e=[];$e.push(Calculation_Static),$e.push(Calculation_LookupTable),$e.push(Calculation_2AxisTable),$e.push(Calculation_Formula);let Ze=[];Ze.push(Calculation_Static),Ze.push(Calculation_Formula);let Je=[];Je.push(Calculation_Static),Je.push(Calculation_Formula);let Ke=[];Ke.push(Calculation_Static),Ke.push(Calculation_LookupTable),Ke.push(Calculation_2AxisTable);let Qe=[];Qe.push(Calculation_Static),Qe.push(Calculation_LookupTable),Qe.push(Calculation_2AxisTable);let et=[];et.push(Calculation_Static);let tt=[];tt.push(Calculation_Static);let it=[];it.push(Calculation_Static);let nt=[];nt.push(Calculation_Static),nt.push(Calculation_LookupTable),nt.push(Calculation_2AxisTable),nt.push(Calculation_Formula);var at=[];class EngineSensors extends ConfigContainer{static template='<div data-element="CrankPosition"></div><div data-element="CamPosition"></div><div data-element="CylinderAirTemperature"></div><div data-element="ManifoldAbsolutePressure"></div><div data-element="ThrottlePosition"></div>';CrankPosition=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:void 0,label:"Crank Position",outputTypes:["ReluctorResult"]});CamPosition=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:void 0,label:"Cam Position",outputTypes:["ReluctorResult"]});CylinderAirTemperature=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:et,label:"Cylinder Air Temperature",outputUnits:["°C"]});ManifoldAbsolutePressure=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:tt,label:"Manifold Absolute Pressure",outputUnits:["Bar"]});ThrottlePosition=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:it,label:"Throttle Position",outputUnits:["%"]});constructor(e){super(),this.label="Engine Sensor Selection",this.Setup(e)}get value(){let e=super.value;return e.CrankPriority=1,this.ManifoldAbsolutePressure.hidden&&delete e.ManifoldAbsolutePressure,this.ThrottlePosition.hidden&&delete e.ThrottlePosition,this.CylinderAirTemperature.hidden&&delete e.CylinderAirTemperature,e}set value(e){super.value=e}RegisterVariables(){this.CrankPosition.RegisterVariables({name:"EngineParameters.Crank Position"}),this.CamPosition.RegisterVariables({name:"EngineParameters.Cam Position"}),this.ManifoldAbsolutePressure.hidden=-1===(at?.indexOf("Manifold Absolute Pressure")??-1),this.ManifoldAbsolutePressure.hidden||this.ManifoldAbsolutePressure.RegisterVariables({name:"EngineParameters.Manifold Absolute Pressure"}),this.ThrottlePosition.hidden=-1===(at?.indexOf("Throttle Position")??-1),this.ThrottlePosition.hidden||this.ThrottlePosition.RegisterVariables({name:"EngineParameters.Throttle Position"}),this.CylinderAirTemperature.hidden=-1===(at?.indexOf("Cylinder Air Temperature")??-1),this.CylinderAirTemperature.hidden||this.CylinderAirTemperature.RegisterVariables({name:"EngineParameters.Cylinder Air Temperature"})}}customElements.define("top-engine-sensors",EngineSensors,{extends:"span"});class EngineCalculations extends ConfigContainer{static template='<div data-element="CylinderAirmass"></div><div data-element="VolumetricEfficiency"></div>';CylinderAirmass=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:De,label:"Cylinder Air Mass",selectName:"No Calculation",outputUnits:["g"],value:{selection:"CylinderAirmass_SpeedDensity"}});VolumetricEfficiency=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:nt,label:"Volumetric Efficiency",outputUnits:["[0.0-1.0]"],displayUnits:["%"]});constructor(e){super(),this.label="Engine Calculations",this.Setup(e)}get value(){let e=super.value;return this.VolumetricEfficiency.hidden&&delete e.VolumetricEfficiency,e}set value(e){super.value=e}RegisterVariables(){this.CylinderAirmass.RegisterVariables({name:"EngineParameters.Cylinder Air Mass"}),at=this.CylinderAirmass.GetSubConfigProperty("Requirements"),this.VolumetricEfficiency.hidden=-1===(at?.indexOf("Volumetric Efficiency")??-1),this.VolumetricEfficiency.hidden||this.VolumetricEfficiency.RegisterVariables({name:"EngineParameters.Volumetric Efficiency"})}}customElements.define("top-engine-calculations",EngineCalculations,{extends:"span"});class Engine extends ConfigList{constructor(e){super(e={...e,staticItems:[{name:"EngineSensors",item:new EngineSensors},{name:"EngineCalculations",item:new EngineCalculations}],itemConstructor:GenericCalculation})}RegisterVariables(){VariableRegister.RegisterVariable({name:"EngineParameters.Engine Speed",unit:"RPM"}),super.RegisterVariables({name:"EngineParameters"}),super.RegisterVariables({name:"EngineParameters"})}}customElements.define("top-engine",Engine,{extends:"div"});class InjectorProperties extends ConfigContainer{static template='<div data-element="InjectorEnable"></div><div data-element="InjectorPulseWidth"></div><div data-element="InjectorEndPosition"></div>';InjectorEnable=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Ze,label:"Injector Enable",outputTypes:["bool"]});InjectorPulseWidth=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:je,label:"Injector Pulse Width",outputUnits:["s"],displayUnits:["ms"]});InjectorEndPosition=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Ne,label:"Injector End Position",outputUnits:["°"]});constructor(e){super(),this.label="Injector Properties",this.Setup(e)}RegisterVariables(){this.InjectorEnable.RegisterVariables({name:"FuelParameters.Injector Enable"}),this.InjectorPulseWidth.RegisterVariables({name:"FuelParameters.Injector Pulse Width"}),this.InjectorEndPosition.RegisterVariables({name:"FuelParameters.Injector End Position"})}}customElements.define("top-injector-properties",InjectorProperties,{extends:"span"});class Fuel extends ConfigList{constructor(e){super(e={...e,staticItems:[{name:"AFR",item:new GenericCalculation({calculations:$e,name:"Air Fuel Ratio",nameEditable:!1,outputUnits:[":1"]})},{name:"InjectorProperties",item:new InjectorProperties},{name:"InjectorOutputs",item:new OutputList({label:"Injector Outputs",newOutput:e=>new Output_TDC({label:`Injector ${e+1}`})})}],itemConstructor:GenericCalculation})}RegisterVariables(){VariableRegister.RegisterVariable({name:"FuelParameters.Cylinder Fuel Mass",unit:"g"}),super.RegisterVariables({name:"FuelParameters"})}}customElements.define("top-fuel",Fuel,{extends:"div"});class IgnitionProperties extends ConfigContainer{static template='<div data-element="IgnitionEnable"></div><div data-element="IgnitionAdvance"></div><div data-element="IgnitionDwell"></div><div data-element="IgnitionDwellDeviation"></div>';IgnitionEnable=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Je,label:"Ignition Enable",outputTypes:["bool"]});IgnitionAdvance=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Ke,label:"Ignition Advance",outputUnits:["°"]});IgnitionDwell=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Qe,label:"Ignition Dwell",outputUnits:["s"],displayUnits:["ms"]});IgnitionDwellDeviation=new CalculationOrVariableSelection_CalculationOrVariableSelection({calculations:Qe,label:"Ignition Dwell Deviation",outputUnits:["s"],displayUnits:["ms"]});constructor(e){super(),this.label="Ignition Properties",this.Setup(e)}RegisterVariables(){this.IgnitionEnable.RegisterVariables({name:"IgnitionParameters.Ignition Enable"}),this.IgnitionAdvance.RegisterVariables({name:"IgnitionParameters.Ignition Advance"}),this.IgnitionDwell.RegisterVariables({name:"IgnitionParameters.Ignition Dwell"}),this.IgnitionDwellDeviation.RegisterVariables({name:"IgnitionParameters.Ignition Dwell Deviation"})}}customElements.define("top-ignition-properties",IgnitionProperties,{extends:"span"});class Ignition extends ConfigList{constructor(e){super(e={...e,staticItems:[{name:"IgnitionProperties",item:new IgnitionProperties},{name:"IgnitionOutputs",item:new OutputList({label:"Ignition Outputs",newOutput:e=>new Output_TDC({label:`Ignition ${e+1}`})})}],itemConstructor:GenericCalculation})}RegisterVariables(){super.RegisterVariables({name:"IgnitionParameters"})}}customElements.define("top-ignition",Ignition,{extends:"div"});class Inputs extends ConfigList{inputListElement=document.createElement("div");constructor(e){super({...e,itemConstructor:Input,saveValue:[{}]}),this.inputListNewElement=document.createElement("div"),this.inputListNewElement.class="w3-bar-subitem w3-button",this.inputListNewElement.textContent="+ New",this.inputListNewElement.addEventListener("click",(()=>{this.appendNewItem()})),this.addEventListener("change",(()=>{for(;[...this.children].filter((e=>e.item.constructor===Input)).length<this.inputListElement.children.length||this.inputListElement?.firstChild?.firstChild===this.inputListNewElement;)this.inputListElement.removeChild(this.inputListElement.lastChild);for(let e=0,t=0;e<this.children.length;e++){if(this.children[e].item.constructor!==Input)continue;let i=this.inputListElement.children[t++];if(!i){i=this.inputListElement.appendChild(document.createElement("div")),i.appendChild(new UIDisplayLiveUpdate).style.float="right",i.append(document.createElement("div")),i.class="w3-bar-subitem w3-button";const e=this;i.addEventListener("click",(function(){e.children[this.inputIndex].scrollIntoView({behavior:"auto",block:"center",inline:"center"})})),i.RegisterVariables=function(){const t=e.children[this.inputIndex];this.firstChild.RegisterVariables({name:`Inputs.${t.name.value}`,unit:t.translationConfig.outputUnits?.[0]??t.rawConfig.outputUnits?.[0]})}}i.inputIndex=e,i.lastChild.textContent=this.children[e].name.value,i.class="w3-bar-subitem w3-button"}if(0===this.inputListElement.children.length){this.inputListElement.appendChild(document.createElement("div")).appendChild(this.inputListNewElement)}})),this.dispatchEvent(new Event("change",{bubbles:!0}))}RegisterVariables(){VariableRegister.CurrentTick={name:"CurrentTick",type:"tick",id:VariableRegister.GenerateVariableId()},super.RegisterVariables();for(var e=0;e<this.inputListElement.children.length;e++)this.inputListElement.children[e].RegisterVariables?.()}}customElements.define("config-inputs",Inputs,{extends:"div"});class CAN extends ConfigList{canListElement=document.createElement("div");constructor(e){super({...e,newItem:()=>new GenericCalculation({calculations:[{group:"CAN",calculations:Re},{group:"Generic",calculations:Ne}]})}),this.canListNewElement=document.createElement("div"),this.canListNewElement.class="w3-bar-subitem w3-button",this.canListNewElement.textContent="+ New",this.canListNewElement.addEventListener("click",(()=>{this.appendNewItem()})),this.addEventListener("change",(()=>{for(;[...this.children].filter((e=>e?.item?.constructor===GenericCalculation)).length<this.canListElement.children.length||this.canListElement?.firstChild?.firstChild===this.canListNewElement;)this.canListElement.removeChild(this.canListElement.lastChild);for(let e=0,t=0;e<this.children.length;e++){if(this.children[e].item.constructor!==GenericCalculation)continue;let i=this.canListElement.children[t++];if(!i){i=this.canListElement.appendChild(document.createElement("div")),i.append(document.createElement("div")),i.class="w3-bar-subitem w3-button";const e=this;i.addEventListener("click",(function(){e.children[this.canIndex].scrollIntoView({behavior:"auto",block:"center",inline:"center"})}))}i.canIndex=e,i.lastChild.textContent=this.children[e].name.value,i.class="w3-bar-subitem w3-button"}if(0===this.canListElement.children.length){this.canListElement.appendChild(document.createElement("div")).appendChild(this.canListNewElement)}})),this.dispatchEvent(new Event("change",{bubbles:!0}))}}customElements.define("config-can",CAN,{extends:"div"});class Top extends UITemplate{static template='<div class="w3-sidebar" style="display: none;">\n    <div class="w3-bar">\n        <div class="w3-bar-item w3-padding-16">EFIGenie</div>\n        <div data-element="sidebarClose"></div>\n    </div>\n    <div class="w3-bar-block sidebarSelection">\n        <div data-element="dashboardTab"></div>\n        <div data-element="pinOverlayTab"></div>\n        <div data-element="inputsTab"></div>\n        <div data-element="inputsTabList"></div>\n        <div data-element="canTab"></div>\n        <div data-element="canTabList"></div>\n        <div data-element="engineTab"></div>\n        <div data-element="fuelTab"></div>\n        <div data-element="ignitionTab"></div>\n    </div>\n</div>\n<div class="w3-container w3-display-container">\n    <span>\n        <div data-element="sidebarOpen"></div>\n        <div data-element="title"></div>\n    </span>\n    <hr style="margin: 0px 0px 5px 0px;">\n    <div data-element="Dashboard"></div>\n    <div data-element="pinOverlayWorkspace"></div>\n    <div data-element="inputsWorkspace"></div>\n    <div data-element="canWorkspace"></div>\n    <div data-element="Engine"></div>\n    <div data-element="Fuel"></div>\n    <div data-element="Ignition"></div>\n</div>';title=document.createElement("div");dashboardTab=document.createElement("div");pinOverlayTab=document.createElement("div");inputsTabExpend=document.createElement("span");inputsTab=document.createElement("div");canTabExpend=document.createElement("span");canTab=document.createElement("div");engineTab=document.createElement("div");fuelTab=document.createElement("div");ignitionTab=document.createElement("div");pinOverlayWorkspace=document.createElement("span");inputsWorkspace=document.createElement("span");canWorkspace=document.createElement("div");Dashboard=new Dashboard;PinOverlay=new UIPinOverlay;TargetDevice=new UISelection({options:Object.entries(l).map((([e,t])=>({name:t.name,value:e}))),value:"ESP32C6_Expander"});Inputs=new Inputs;CAN=new CAN;Engine=new Engine;Fuel=new Fuel;Ignition=new Ignition;sidebarClose=new UIButton({className:"sidebaropenclose w3-button w3-padding-16 w3-right"});sidebarOpen=new UIButton({className:"sidebaropenclose w3-button w3-padding-16"});constructor(e){super(),this.inputsWorkspace.append(this.Inputs),this.canWorkspace.append(this.CAN.newItemElement),this.canWorkspace.append(this.CAN),this.pinOverlayWorkspace.append(this.PinOverlay),this.TargetDevice.addEventListener("change",(()=>{this.PinOverlay.pinOut=l[this.TargetDevice.value]})),this.PinOverlay.pinOut=l[this.TargetDevice.value],this.class="top",this.sidebarOpen.addEventListener("click",(()=>{window.localStorage.setItem("expanded","true");var e=this.firstChild,t=this.lastChild;e.hidden=!1;var i=e.offsetWidth,n=.005*i/.1,a=parseFloat(t.style.left);isNaN(a)&&(a=0),e.style.left=a-i+"px";var s=setInterval((()=>{a>=i?clearInterval(s):(a+=n,t.style.marginRight=t.style.left=`${a}px`,e.style.left=a-i+"px",e.style.opacity=a/i)}),5);this.sidebarOpen.hidden=!0})),this.sidebarClose.addEventListener("click",(()=>{window.localStorage.setItem("expanded","false");var e=this.firstChild,t=this.lastChild,i=e.offsetWidth,n=.005*i/.1,a=parseFloat(t.style.left);isNaN(a)&&(a=0),e.style.left=a-i+"px";var s=setInterval((()=>{a<=0?(clearInterval(s),e.hidden=!0):(a-=n,t.style.marginRight=t.style.left=`${a}px`,e.style.left=a-i+"px",e.style.opacity=a/i)}),5);this.sidebarOpen.hidden=!1})),this.title.class="w3-padding-16",this.title.style.display="inline-block",this.title.style.margin="3px",this.activeTab=window.localStorage.getItem("lastTab")??"Inputs",this.dashboardTab.class="w3-bar-item w3-button dashboard-tab",this.dashboardTab.addEventListener("click",(()=>{this.activeTab="Dashboard"})),this.pinOverlayTab.class="w3-bar-item w3-button pinoverlay-tab",this.pinOverlayTab.addEventListener("click",(()=>{this.activeTab="Pin Mapping"})),this.inputsTabList=this.Inputs.inputListElement,this.inputsTabList.addEventListener("click",(()=>{this.activeTab="Inputs"})),this.inputsTabExpend.className="despand",this.inputsTabExpend.addEventListener("click",(e=>(this.inputsTabList.hidden=!this.inputsTabList.hidden,this.inputsTabList.hidden?(window.localStorage.setItem("inputExpanded","false"),this.inputsTabExpend.className="expand"):(window.localStorage.setItem("inputExpanded","true"),this.inputsTabExpend.className="despand"),e.preventDefault(),e.stopPropagation(),!1))),this.inputsTab.append(this.inputsTabExpend),this.inputsTab.class="w3-bar-item w3-button input-tab",this.inputsTab.addEventListener("click",(()=>{this.activeTab="Inputs"})),this.canTabList=this.CAN.canListElement,this.canTabList.addEventListener("click",(()=>{this.activeTab="CAN"})),this.canTabExpend.className="despand",this.canTabExpend.addEventListener("click",(e=>(this.canTabList.hidden=!this.canTabList.hidden,this.canTabList.hidden?(window.localStorage.setItem("canExpanded","false"),this.canTabExpend.className="expand"):(window.localStorage.setItem("canExpanded","true"),this.canTabExpend.className="despand"),e.preventDefault(),e.stopPropagation(),!1))),this.canTab.append(this.canTabExpend),this.canTab.class="w3-bar-item w3-button can-tab",this.canTab.addEventListener("click",(()=>{this.activeTab="CAN"})),this.engineTab.class="w3-bar-item w3-button engine-tab",this.engineTab.addEventListener("click",(()=>{this.activeTab="Engine"})),this.fuelTab.class="w3-bar-item w3-button fuel-tab",this.fuelTab.addEventListener("click",(()=>{this.fuelTab.classList.contains("disabled")||(this.activeTab="Fuel")})),this.ignitionTab.class="w3-bar-item w3-button ignition-tab",this.ignitionTab.addEventListener("click",(()=>{this.activeTab="Ignition"})),this.Setup(e);let t=!1;this.querySelector(".sidebarSelection").addEventListener("touchstart",(()=>{t=!0})),this.addEventListener("click",(()=>{t&&(t=!1,this.sidebarClose.dispatchEvent(new Event("click")))})),window.setTimeout((()=>{"false"===(window.localStorage.getItem("inputExpanded")??"true")&&this.inputsTabExpend.dispatchEvent(new Event("click")),"false"===(window.localStorage.getItem("canExpanded")??"true")&&this.canTabExpend.dispatchEvent(new Event("click")),"true"===(window.localStorage.getItem("expanded")??"false")&&this.sidebarOpen.dispatchEvent(new Event("click"))}),50)}get activeTab(){return this.title.textContent}set activeTab(e){switch(window.localStorage.setItem("lastTab",e),this.title.textContent=e,this.Dashboard.hidden=!0,this.PinOverlay.hidden=!0,this.inputsWorkspace.hidden=!0,this.canWorkspace.hidden=!0,this.Engine.hidden=!0,this.Fuel.hidden=!0,this.Ignition.hidden=!0,this.dashboardTab.classList.remove("active"),this.pinOverlayTab.classList.remove("active"),this.inputsTab.classList.remove("active"),this.canTab.classList.remove("active"),this.engineTab.classList.remove("active"),this.fuelTab.classList.remove("active"),this.ignitionTab.classList.remove("active"),e){case"Dashboard":this.Dashboard.hidden=!1,this.dashboardTab.classList.add("active");break;case"Pin Mapping":this.PinOverlay.hidden=!1,this.pinOverlayTab.classList.add("active");break;case"Inputs":this.inputsWorkspace.hidden=!1,this.inputsTab.classList.add("active");break;case"CAN":this.canWorkspace.hidden=!1,this.canTab.classList.add("active");break;case"Engine":this.Engine.hidden=!1,this.engineTab.classList.add("active");break;case"Fuel":this.Fuel.hidden=!1,this.fuelTab.classList.add("active");break;case"Ignition":this.Ignition.hidden=!1,this.ignitionTab.classList.add("active")}}get saveValue(){return super.saveValue}set saveValue(e){super.saveValue=e,this.RegisterVariables()}RegisterVariables(){VariableRegister.Clear(),Oe.liveUpdateEvents=[],Oe.variablesToPoll=[],this.Inputs.RegisterVariables(),this.CAN.RegisterVariables({name:"CANParameters"}),this.Engine.RegisterVariables(),this.Fuel.RegisterVariables(),this.Ignition.RegisterVariables(),this.Dashboard.RegisterVariables(),this.PinOverlay.update()}}customElements.define("top-top",Top,{extends:"span"});let st=[];Ge.unshift({group:"TPS Sensors",calculations:st});const lt=st;class TPS_Linear extends Input_AnalogPolynomial{static displayName="Linear TPS";static outputUnits=["[0.0-1.0]"];static template=`${Input_AnalogPolynomial.template}<div style="display: flex;"><div style="display: inline-block;"><div><label>0% Voltage:</label><div data-element="voltage0"></div></div><div><label>100% Voltage:</label><div data-element="voltage100"></div></div></div><div style="display: flex; align-items: center;"><div data-element="swap"></div><div data-element="calibrate"></div></div></div>`;voltage0=new UINumberWithUnit({value:.1,step:.001,min:.001,measurement:"Voltage",valueUnit:"V"});voltage100=new UINumberWithUnit({value:4.9,step:.001,min:.001,measurement:"Voltage",valueUnit:"V"});calibrate=new UIButton({label:"Calibrate",hidden:!0});swap=new UIButton({label:"⤸"});get saveValue(){let e=super.saveValue;return delete e.polynomial,e}set saveValue(e){super.saveValue=e}constructor(e){super(),this.polynomial.hidden=!0,this.updatePolynomial(),this.polynomial.addEventListener("change",(()=>{this.updatePolynomial()})),this.voltage0.addEventListener("change",(()=>{this.updatePolynomial()})),this.voltage100.addEventListener("change",(()=>{this.updatePolynomial()})),this.calibrate.addEventListener("click",(()=>{"Stop"==this.calibrate.label?this.calibrate.label="Calibrate":(this.polarity=this.voltage100.value<this.voltage0.value?-1:1,this.voltage0.value=this.voltage100.value=this.voltageLiveUpdate.value,this.calibrate.label="Stop")})),this.swap.addEventListener("click",(()=>{this.polarity=-this.polarity;const e=this.voltage0.value;this.voltage0.value=this.voltage100.value,this.voltage100.value=e})),this.Setup(e),this.outputUnits=this.constructor.outputUnits}RegisterVariables(e){super.RegisterVariables(e);const t=Oe.liveUpdateEvents[this.voltageLiveUpdate.GUID];Oe.liveUpdateEvents[this.voltageLiveUpdate.GUID]=(e,i)=>{t(e,i);const n=this.voltageLiveUpdate.value,a="Stop"==this.calibrate.label;this.calibrate.hidden=null==n,null!=n?(this.calibrate.hidden=!1,this.polarity>0?(a&&n<this.voltage0.value&&(this.voltage0.value=n),a&&n>this.voltage100.value&&(this.voltage100.value=n)):(a&&n<this.voltage100.value&&(this.voltage100.value=n),a&&n>this.voltage0.value&&(this.voltage0.value=n))):this.calibrate.hidden=!0}}updatePolynomial(){const e=this.voltage0.value,t=this.voltage100.value;let i=[];i[1]=1/(t-e),i[0]=-e*i[1],this.polynomial.minValue=0,this.polynomial.maxValue=1,this.polynomial.coeffecients=i}}lt.push(TPS_Linear),customElements.define("tps-linear",TPS_Linear,{extends:"span"});let rt={enumerable:!0,get:function(){return"none"===this.style.display},set:function(e){e&&"none"!==this.style.display?(this.style.display&&(this._previousDisplayValue=this.style.display),this.style.display="none"):e||"none"!==this.style.display||(this._previousDisplayValue?this.style.display=this._previousDisplayValue:this.style.display=null,delete this._previousDisplayValue)}};Object.defineProperty(HTMLElement.prototype,"hidden",rt),Object.defineProperty(SVGElement.prototype,"hidden",rt),Object.defineProperty(HTMLElement.prototype,"class",{enumerable:!0,set:function(e){e.split(" ").forEach((e=>{this.classList.add(e)}))}}),window.VariableRegister=new class VariableRegistry_VariableRegistry{constructor(e){Object.assign(this,e),this.CreateIfNotFound=!0}Clear(){Object.entries(this).forEach((([e,t])=>{"CreateIfNotFound"!==e&&delete this[e]}))}GenerateVariableId(){return this.VariableIncrement??=0,++this.VariableIncrement}GetVariableByReference(e){if(!e||"object"!=typeof e)return;let t;const i=e.name?.indexOf(".");if(-1!==(i??-1)){const n=e.name.substring(0,i);if(!this[n])return;t={name:e.name.substring(i+1)},t=this[n].find((i=>i.name===t.name&&(null==e.unit||i.unit===e.unit||null==i.unit&&"string"==typeof i.id)&&(null==e.type||null!=i.unit&&-1!==e.type.split("|").indexOf("float")||i.type?.split("|").some((t=>-1!==e.type.split("|").indexOf(t)))||null==i.type&&"string"==typeof i.id)))}else"object"==typeof this[e.name]?t=this[e.name]:(this[e.name],"number"==typeof this[e.name]&&(t={name:e.name,id:this[e.name]}));if(t){if("string"==typeof t.id){const i=this.GetVariableByReference({name:t.id,unit:e.unit??t.unit,type:e.type??t.type});if(i)return{...i,name:t.name}}return t}}GetVariableId(e){let t=this.GetVariableByReference(e);if(t)return t.id;if(!this.CreateIfNotFound)return;if(null==e||null==e.name)return;t={...e},t.id??=this.GenerateVariableId();const i=t.name.indexOf(".");if(-1!==i){const e=t.name.substring(0,i);this[e]??=[],t.name=t.name.substring(i+1),this[e].push(t)}else this[t.name]=t;return this.GetVariableId(e)}RegisterVariable(e){if(!e||"object"!=typeof e||!e.name)return;const t=(e={...e}).name.indexOf(".");if(-1!==t){const i=e.name.substring(0,t);this[i]??=[],e.name=e.name.substring(t+1);const n=this[i].findIndex((t=>t.name===e.name&&(null==e.unit||t.unit===e.unit||null==t.unit&&"string"==typeof t.id)&&(null==e.type||null!=t.unit&&-1!==e.type.split("|").indexOf("float")||null==t.type&&"string"==typeof t.id||t.type?.split("|").some((t=>-1!==e.type.split("|").indexOf(t))))));-1!==n&&(e.id??=this[i][n].id,this[i].splice(n,1)),e.id??=this.GenerateVariableId(),this[i].push(e)}else e.id??=this.GenerateVariableId(),this[e.name]=e}GetVariableReferenceList(){var e={};for(var t in this)if(null!=this[t]&&"VariableIncrement"!==t&&"CreateIfNotFound"!==t&&0!==t.toLowerCase().indexOf("temp"))if(Array.isArray(this[t])){e[t]??=[];this[t];for(var i=0;i<this[t].length;i++){let n={...this[t][i]};n.name=`${t}.${n.name}`,e[t].push(this.GetVariableByReference(n))}}else e[t]=this.GetVariableByReference(this[t]);return e}GetSelections(e,t){var i=[];if(e?.length>0){var n=e;e[0].group||e[0].calculations||(n=[{group:"Calculations",calculations:e}]);for(var a=0;a<n.length;a++){var s={group:n[a].group,options:[]};e=n[a].calculations;for(var l=0;l<e.length;l++)t&&!t(e[l])||s.options.push({name:e[l].displayName,value:e[l].name});s.options.length>0&&i.push(s)}}for(var r in this)if(Array.isArray(this[r])){var o=this[r],u={group:r,options:[]};for(l=0;l<o.length;l++)t&&!t(o[l])||u.options.push({name:o[l].name,info:o[l].unit?`[${GetMeasurementNameFromUnitName(o[l].unit)}]`:"",value:{name:`${r}.${o[l].name}`,...null==o[l].type?void 0:{type:o[l].type},...null==o[l].unit?void 0:{unit:o[l].unit}}});u.options.length>0&&i.push(u)}return 1===i.length?i[0].options:i}},window.GetMeasurementNameFromUnitName=Ce,window.addEventListener("load",(function(){window.buildConfig=c;let e=new Top,i=document.querySelector("#workspace");i.innerHtml="",i.append(e),e.addEventListener("change",(t=>{e.RegisterVariables()}));const s=window.localStorage.getItem("config"),l=i=>{try{e.saveValue=0===(n=i).indexOf("lzjson")?JSON.parse(t().decompress(n.substring(6))):JSON.parse(n),document.querySelector("#btnLoad").value=""}catch{}var n};s?l(s):e.RegisterVariables();let r="tune.json";document.querySelector("#btnSave").addEventListener("click",(function(){var t=e.saveValue;window.localStorage.setItem("config",n(t))})),document.querySelector("#btnDownload").addEventListener("click",(function(){var t,i=e.saveValue;t=r,a(n(i),t)})),document.querySelector("#btnLoad").addEventListener("change",(function(e){var t=new FileReader;t.onload=function(e){if(2!=e.target.readyState)return;if(e.target.error)return void alert("Error while reading file");const t=e.target.result;window.localStorage.setItem("config",t),l(t)},t.readAsText(e.target.files[0]),r=e.target.files[0].name}))}))})()})();
//# sourceMappingURL=main.js.map